var gc=Object.defineProperty;var Wx=n=>{throw TypeError(n)};var Ac=(n,e,t)=>e in n?gc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var q=(n,e,t)=>Ac(n,typeof e!="symbol"?e+"":e,t),Hr=(n,e,t)=>e.has(n)||Wx("Cannot "+t);var jr=(n,e,t)=>(Hr(n,e,"read from private field"),t?t.call(n):e.get(n)),qs=(n,e,t)=>e.has(n)?Wx("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Yx=(n,e,t,s)=>(Hr(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),qr=(n,e,t)=>(Hr(n,e,"access private method"),t);import{w as Je,S as Fc,p as us,q as Ds,t as Vr,u as vc,v as Ge,n as Ke,g as Ar,x as tx,i as Mt,c as Bi,f as yc,y as Dc,z as Oe,A as it,B as U,C as Q,D as Be,E as ds,F as Ce,G as c,H as L,I as b,J as M,K as He,L as Ie,M as ge,N as $,O as mt,P as _e,Q as $e,R as T,T as ee,U as k,V as T0,W as Tt,X as V,Y as wt,Z as fs,_ as t0,$ as M0,a0 as Qt,a1 as Fr,a2 as Ci,a3 as as,a4 as Qx,a5 as pi,a6 as mc,a7 as wc,a8 as bc,a9 as kc,aa as _c}from"./vendor-DP19vGRW.js";import{N as vr,a as Sc,b as Pc,c as Tc,d as Mc,e as gi}from"./ndk-C30x7CX5.js";import{D as yr,g as Ai}from"./dexie-CoGj-NRt.js";import{a as Gr,D as Ic,E as Rc,S as Uc,P as Lc,C as Nc,e as zc}from"./editor-Bg0hSP_k.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const x of r)if(x.type==="childList")for(const o of x.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const x={};return r.integrity&&(x.integrity=r.integrity),r.referrerPolicy&&(x.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?x.credentials="include":r.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function s(r){if(r.ep)return;r.ep=!0;const x=t(r);fetch(r.href,x)}})();function Fi(){if(typeof window>"u")return"/";const n=window.location.hash.slice(1),e=n.indexOf("?");return e!==-1?n.slice(0,e)||"/":n||"/"}function vi(){return typeof window>"u"?"/":window.location.hash.slice(1)||"/"}const sx=Je(Fi()),yi=Je(vi()),Kc={subscribe:sx.subscribe};yi.subscribe;const Jx="__routerInitialized",Xx=typeof globalThis<"u"?globalThis:window;function $c(){Xx[Jx]||typeof window>"u"||(Xx[Jx]=!0,window.addEventListener("hashchange",()=>{sx.set(Fi()),yi.set(vi())}))}function I0(n){const e=n.startsWith("/")?n:"/"+n;window.location.hash=e,sx.set(e)}function Oc(n,e){var o;const t=n.split("/").filter(Boolean),s=e.split("/").filter(Boolean),r=(o=s[s.length-1])==null?void 0:o.indexOf("?");if(r!==-1&&s.length>0&&(s[s.length-1]=s[s.length-1].substring(0,r)),t.length!==s.length){if(t[t.length-1]==="*"&&s.length>=t.length-1){const i={};for(let a=0;a<t.length-1;a++)if(t[a].startsWith(":"))i[t[a].slice(1)]=decodeURIComponent(s[a]);else if(t[a]!==s[a])return{matched:!1,params:{}};return i.wild=s.slice(t.length-1).join("/"),{matched:!0,params:i}}return{matched:!1,params:{}}}const x={};for(let i=0;i<t.length;i++){if(t[i]==="*")return x.wild=s.slice(i).join("/"),{matched:!0,params:x};if(t[i].startsWith(":"))x[t[i].slice(1)]=decodeURIComponent(s[i]);else if(t[i]!==s[i])return{matched:!1,params:{}}}return{matched:!0,params:x}}const Hc="modulepreload",jc=function(n){return"/"+n},Zx={},i0=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let o=function(d){return Promise.all(d.map(l=>Promise.resolve(l).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=o(t.map(d=>{if(d=jc(d),d in Zx)return;Zx[d]=!0;const l=d.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":Hc,l||(f.as="script"),f.crossOrigin="",f.href=d,a&&f.setAttribute("nonce",a),document.head.appendChild(f),l)return new Promise((h,B)=>{f.addEventListener("load",h),f.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${d}`)))})}))}function x(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return r.then(o=>{for(const i of o||[])i.status==="rejected"&&x(i.reason);return e().catch(x)})};function Qe(n,e){return e?{hash:n,key:e}:{hash:n}}var te=(n=>(n[n.Blob=0]="Blob",n[n.File=1]="File",n[n.Dir=2]="Dir",n))(te||{});function se(n){return Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join("")}function we(n){const e=new Uint8Array(n.length/2);for(let t=0;t<e.length;t++)e[t]=parseInt(n.substr(t*2,2),16);return e}async function ot(n){const e=new ArrayBuffer(n.length);new Uint8Array(e).set(n);const t=await crypto.subtle.digest("SHA-256",e);return new Uint8Array(t)}const Di=12,qc=16,Vc=qc,Gc=new TextEncoder().encode("hashtree-chk"),Wc=new TextEncoder().encode("encryption-key");async function mi(n){const e=new ArrayBuffer(n.length);new Uint8Array(e).set(n);const t=await crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"HKDF",salt:Gc,info:Wc,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function wi(n){return ot(n)}async function o0(n){const e=await wi(n),t=await mi(e),s=new Uint8Array(Di),r=new ArrayBuffer(n.length);new Uint8Array(r).set(n);const x=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},t,r);return{ciphertext:new Uint8Array(x),key:e}}async function k0(n,e){if(e.length!==32)throw new Error("CHK key must be 32 bytes");if(n.length<Vc)throw new Error("CHK encrypted data too short");const t=await mi(e),s=new Uint8Array(Di),r=new ArrayBuffer(n.length);new Uint8Array(r).set(n);const x=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},t,r);return new Uint8Array(x)}function Yc(n){const e=n.length;let t=0,s=0;for(;s<e;){let r=n.charCodeAt(s++);if((r&4294967168)===0){t++;continue}else if((r&4294965248)===0)t+=2;else{if(r>=55296&&r<=56319&&s<e){const x=n.charCodeAt(s);(x&64512)===56320&&(++s,r=((r&1023)<<10)+(x&1023)+65536)}(r&4294901760)===0?t+=3:t+=4}}return t}function Qc(n,e,t){const s=n.length;let r=t,x=0;for(;x<s;){let o=n.charCodeAt(x++);if((o&4294967168)===0){e[r++]=o;continue}else if((o&4294965248)===0)e[r++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&x<s){const i=n.charCodeAt(x);(i&64512)===56320&&(++x,o=((o&1023)<<10)+(i&1023)+65536)}(o&4294901760)===0?(e[r++]=o>>12&15|224,e[r++]=o>>6&63|128):(e[r++]=o>>18&7|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128)}e[r++]=o&63|128}}const Jc=new TextEncoder,Xc=50;function Zc(n,e,t){Jc.encodeInto(n,e.subarray(t))}function el(n,e,t){n.length>Xc?Zc(n,e,t):Qc(n,e,t)}const tl=4096;function bi(n,e,t){let s=e;const r=s+t,x=[];let o="";for(;s<r;){const i=n[s++];if((i&128)===0)x.push(i);else if((i&224)===192){const a=n[s++]&63;x.push((i&31)<<6|a)}else if((i&240)===224){const a=n[s++]&63,d=n[s++]&63;x.push((i&31)<<12|a<<6|d)}else if((i&248)===240){const a=n[s++]&63,d=n[s++]&63,l=n[s++]&63;let u=(i&7)<<18|a<<12|d<<6|l;u>65535&&(u-=65536,x.push(u>>>10&1023|55296),u=56320|u&1023),x.push(u)}else x.push(i);x.length>=tl&&(o+=String.fromCharCode(...x),x.length=0)}return x.length>0&&(o+=String.fromCharCode(...x)),o}const sl=new TextDecoder,rl=200;function nl(n,e,t){const s=n.subarray(e,e+t);return sl.decode(s)}function xl(n,e,t){return t>rl?nl(n,e,t):bi(n,e,t)}class Vs{constructor(e,t){this.type=e,this.data=t}}class Wt extends Error{constructor(e){super(e);const t=Object.create(Wt.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:Wt.name})}}const gs=4294967295;function ol(n,e,t){const s=t/4294967296,r=t;n.setUint32(e,s),n.setUint32(e+4,r)}function ki(n,e,t){const s=Math.floor(t/4294967296),r=t;n.setUint32(e,s),n.setUint32(e+4,r)}function _i(n,e){const t=n.getInt32(e),s=n.getUint32(e+4);return t*4294967296+s}function il(n,e){const t=n.getUint32(e),s=n.getUint32(e+4);return t*4294967296+s}const al=-1,cl=4294967296-1,ll=17179869184-1;function ul({sec:n,nsec:e}){if(n>=0&&e>=0&&n<=ll)if(e===0&&n<=cl){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,n),t}else{const t=n/4294967296,s=n&4294967295,r=new Uint8Array(8),x=new DataView(r.buffer);return x.setUint32(0,e<<2|t&3),x.setUint32(4,s),r}else{const t=new Uint8Array(12),s=new DataView(t.buffer);return s.setUint32(0,e),ki(s,4,n),t}}function dl(n){const e=n.getTime(),t=Math.floor(e/1e3),s=(e-t*1e3)*1e6,r=Math.floor(s/1e9);return{sec:t+r,nsec:s-r*1e9}}function fl(n){if(n instanceof Date){const e=dl(n);return ul(e)}else return null}function hl(n){const e=new DataView(n.buffer,n.byteOffset,n.byteLength);switch(n.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0),s=e.getUint32(4),r=(t&3)*4294967296+s,x=t>>>2;return{sec:r,nsec:x}}case 12:{const t=_i(e,4),s=e.getUint32(0);return{sec:t,nsec:s}}default:throw new Wt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${n.length}`)}}function El(n){const e=hl(n);return new Date(e.sec*1e3+e.nsec/1e6)}const Bl={type:al,encode:fl,decode:El};class or{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Bl)}register({type:e,encode:t,decode:s}){if(e>=0)this.encoders[e]=t,this.decoders[e]=s;else{const r=-1-e;this.builtInEncoders[r]=t,this.builtInDecoders[r]=s}}tryToEncode(e,t){for(let s=0;s<this.builtInEncoders.length;s++){const r=this.builtInEncoders[s];if(r!=null){const x=r(e,t);if(x!=null){const o=-1-s;return new Vs(o,x)}}}for(let s=0;s<this.encoders.length;s++){const r=this.encoders[s];if(r!=null){const x=r(e,t);if(x!=null){const o=s;return new Vs(o,x)}}}return e instanceof Vs?e:null}decode(e,t,s){const r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,s):new Vs(t,e)}}or.defaultCodec=new or;function Cl(n){return n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}function In(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):Cl(n)?new Uint8Array(n):Uint8Array.from(n)}const pl=100,gl=2048;class rx{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??or.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??pl,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??gl,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new rx({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){const t=new ArrayBuffer(e),s=new Uint8Array(t),r=new DataView(t);s.set(this.bytes),this.view=r,this.bytes=s}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const s=Yc(e);this.ensureBufferSizeToWrite(5+s),this.writeStringHeader(s),el(e,this.bytes,this.pos),this.pos+=s}encodeObject(e,t){const s=this.extensionCodec.tryToEncode(e,this.context);if(s!=null)this.encodeExtension(s);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);const s=In(e);this.writeU8a(s)}encodeArray(e,t){const s=e.length;if(s<16)this.writeU8(144+s);else if(s<65536)this.writeU8(220),this.writeU16(s);else if(s<4294967296)this.writeU8(221),this.writeU32(s);else throw new Error(`Too large array: ${s}`);for(const r of e)this.doEncode(r,t+1)}countWithoutUndefined(e,t){let s=0;for(const r of t)e[r]!==void 0&&s++;return s}encodeMap(e,t){const s=Object.keys(e);this.sortKeys&&s.sort();const r=this.ignoreUndefined?this.countWithoutUndefined(e,s):s.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw new Error(`Too large map object: ${r}`);for(const x of s){const o=e[x];this.ignoreUndefined&&o===void 0||(this.encodeString(x),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){const s=e.data(this.pos+6),r=s.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);this.writeU8(201),this.writeU32(r),this.writeI8(e.type),this.writeU8a(s);return}const t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),ol(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),ki(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function nx(n,e){return new rx(e).encodeSharedRef(n)}function Wr(n){return`${n<0?"-":""}0x${Math.abs(n).toString(16).padStart(2,"0")}`}const Al=16,Fl=16;class vl{constructor(e=Al,t=Fl){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let s=0;s<this.maxKeyLength;s++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,s){const r=this.caches[s-1];e:for(const x of r){const o=x.bytes;for(let i=0;i<s;i++)if(o[i]!==e[t+i])continue e;return x.str}return null}store(e,t){const s=this.caches[e.length-1],r={bytes:e,str:t};s.length>=this.maxLengthPerKey?s[Math.random()*s.length|0]=r:s.push(r)}decode(e,t,s){const r=this.find(e,t,s);if(r!=null)return this.hit++,r;this.miss++;const x=bi(e,t,s),o=Uint8Array.prototype.slice.call(e,t,t+s);return this.store(o,x),x}}const Rn="array",ms="map_key",Si="map_value",yl=n=>{if(typeof n=="string"||typeof n=="number")return n;throw new Wt("The type of key must be string or number but "+typeof n)};class Dl{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=Rn,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=ms,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Rn){const s=e;s.size=0,s.array=void 0,s.position=0,s.type=void 0}if(e.type===ms||e.type===Si){const s=e;s.size=0,s.map=void 0,s.readCount=0,s.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const As=-1,xx=new DataView(new ArrayBuffer(0)),ml=new Uint8Array(xx.buffer);try{xx.getInt8(0)}catch(n){if(!(n instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const eo=new RangeError("Insufficient data"),wl=new vl;class ox{constructor(e){this.totalPos=0,this.pos=0,this.view=xx,this.bytes=ml,this.headByte=As,this.stack=new Dl,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??or.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??gs,this.maxBinLength=(e==null?void 0:e.maxBinLength)??gs,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??gs,this.maxMapLength=(e==null?void 0:e.maxMapLength)??gs,this.maxExtLength=(e==null?void 0:e.maxExtLength)??gs,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:wl,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??yl}clone(){return new ox({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=As,this.stack.reset()}setBuffer(e){const t=In(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===As&&!this.hasRemaining(1))this.setBuffer(e);else{const t=this.bytes.subarray(this.pos),s=In(e),r=new Uint8Array(t.length+s.length);r.set(t),r.set(s,t.length),this.setBuffer(r)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:s}=this;return new RangeError(`Extra ${t.byteLength-s} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,s;for await(const i of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(i);try{s=this.doDecodeSync(),t=!0}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return s}const{headByte:r,pos:x,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Wr(r)} at ${o} (${x} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let s=t,r=-1;for await(const x of e){if(t&&r===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(x),s&&(r=this.readArraySize(),s=!1,this.complete());try{for(;yield this.doDecodeSync(),--r!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e<160){const r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else{const r=e-160;t=this.decodeString(r,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){const r=this.lookU8();t=this.decodeString(r,1)}else if(e===218){const r=this.lookU16();t=this.decodeString(r,2)}else if(e===219){const r=this.lookU32();t=this.decodeString(r,4)}else if(e===220){const r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===221){const r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===222){const r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===223){const r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===196){const r=this.lookU8();t=this.decodeBinary(r,1)}else if(e===197){const r=this.lookU16();t=this.decodeBinary(r,2)}else if(e===198){const r=this.lookU32();t=this.decodeBinary(r,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){const r=this.lookU8();t=this.decodeExtension(r,1)}else if(e===200){const r=this.lookU16();t=this.decodeExtension(r,2)}else if(e===201){const r=this.lookU32();t=this.decodeExtension(r,4)}else throw new Wt(`Unrecognized type byte: ${Wr(e)}`);this.complete();const s=this.stack;for(;s.length>0;){const r=s.top();if(r.type===Rn)if(r.array[r.position]=t,r.position++,r.position===r.size)t=r.array,s.release(r);else continue e;else if(r.type===ms){if(t==="__proto__")throw new Wt("The key __proto__ is not allowed");r.key=this.mapKeyConverter(t),r.type=Si;continue e}else if(r.map[r.key]=t,r.readCount++,r.readCount===r.size)t=r.map,s.release(r);else{r.key=null,r.type=ms;continue e}}return t}}readHeadByte(){return this.headByte===As&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=As}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Wt(`Unrecognized array type byte: ${Wr(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Wt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Wt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){var x;if(e>this.maxStrLength)throw new Wt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw eo;const s=this.pos+t;let r;return this.stateIsMapKey()&&((x=this.keyDecoder)!=null&&x.canBeCached(e))?r=this.keyDecoder.decode(this.bytes,s,e):r=xl(this.bytes,s,e),this.pos+=t+e,r}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===ms:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new Wt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw eo;const s=this.pos+t,r=this.bytes.subarray(s,s+e);return this.pos+=t+e,r}decodeExtension(e,t){if(e>this.maxExtLength)throw new Wt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const s=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,s,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=il(this.view,this.pos);return this.pos+=8,e}readI64(){const e=_i(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function Un(n,e){return new ox(e).decode(n)}function bl(n){const e={};for(const t of Object.keys(n).sort())e[t]=n[t];return e}function Pi(n){const e={l:n.links.map(t=>{const s={h:t.hash,k:t.key,m:t.meta!==void 0?bl(t.meta):void 0,n:t.name,s:t.size,t:t.type};return s.k===void 0&&delete s.k,s.m===void 0&&delete s.m,s.n===void 0&&delete s.n,s}),t:n.type};return nx(e)}function dt(n){try{const e=Un(n);return e.t!==te.File&&e.t!==te.Dir?null:{type:e.t,links:e.l.map(s=>{const r={hash:s.h,size:s.s??0,type:s.t??te.Blob};return s.n!==void 0&&(r.name=s.n),s.k!==void 0&&(r.key=s.k),s.m!==void 0&&(r.meta=s.m),r})}}catch{return null}}function J0(n){const e=dt(n);if(!e)throw new Error("Data is not a valid tree node");return e}async function y0(n){const e=Pi(n),t=await ot(e);return{data:e,hash:t}}function Ti(n){const e=dt(n);return(e==null?void 0:e.type)??te.Blob}const Yr="hashtree";class Mi{constructor(e=Yr){q(this,"dirName");q(this,"rootDir",null);q(this,"storeDir",null);q(this,"initPromise",null);typeof e=="string"?this.dirName=e:this.dirName=e.dirName??Yr}async getStoreDir(){return this.storeDir?this.storeDir:this.initPromise?this.initPromise:(this.initPromise=(async()=>(this.rootDir=await navigator.storage.getDirectory(),this.storeDir=await this.rootDir.getDirectoryHandle(this.dirName,{create:!0}),this.storeDir))(),this.initPromise)}async getShardDir(e,t){const s=await this.getStoreDir(),r=e.slice(0,2);try{return await s.getDirectoryHandle(r,{create:t})}catch{return null}}async put(e,t){const s=se(e);try{const r=await this.getShardDir(s,!0);if(!r)return!1;try{return await r.getFileHandle(`${s}.bin`,{create:!1}),!1}catch{}const o=await(await r.getFileHandle(`${s}.bin`,{create:!0})).createWritable();return await o.write(t),await o.close(),!0}catch(r){return console.error(`OPFS write failed for ${s}:`,r),!1}}async get(e){if(!e)return null;const t=se(e),s=await this.getShardDir(t,!1);if(!s)return null;try{const o=await(await(await s.getFileHandle(`${t}.bin`,{create:!1})).getFile()).arrayBuffer();return new Uint8Array(o)}catch{return null}}async has(e){const t=se(e),s=await this.getShardDir(t,!1);if(!s)return!1;try{return await s.getFileHandle(`${t}.bin`,{create:!1}),!0}catch{return!1}}async delete(e){const t=se(e),s=await this.getShardDir(t,!1);if(!s)return!1;try{return await s.removeEntry(`${t}.bin`),!0}catch{return!1}}async keys(){const e=await this.getStoreDir(),t=[];for await(const[,s]of e.entries())if(s.kind==="directory"){for await(const[r]of s.entries())if(r.endsWith(".bin")){const x=r.slice(0,-4);t.push(we(x))}}return t}async clear(){const e=await this.getStoreDir();for await(const[t,s]of e.entries())s.kind==="directory"&&await e.removeEntry(t,{recursive:!0})}async count(){return(await this.keys()).length}async totalBytes(){const e=await this.getStoreDir();let t=0;for await(const[,s]of e.entries())if(s.kind==="directory"){for await(const[,r]of s.entries())if(r.kind==="file"){const x=await r.getFile();t+=x.size}}return t}async close(){this.rootDir=null,this.storeDir=null,this.initPromise=null}static async deleteStore(e=Yr){const t=await navigator.storage.getDirectory();try{await t.removeEntry(e,{recursive:!0})}catch{}}}const kl=1e3,_l=6e4;class ix{constructor(e){q(this,"servers");q(this,"signer");q(this,"logger");q(this,"serverHealth",new Map);q(this,"writeQueue",Promise.resolve(!0));this.servers=e.servers.map(t=>typeof t=="string"?{url:t,write:!1}:t),this.signer=e.signer,this.logger=e.logger}isServerInBackoff(e){const t=this.serverHealth.get(e);if(!t||t.consecutiveErrors===0)return!1;const s=Math.min(kl*Math.pow(2,t.consecutiveErrors-1),_l);return Date.now()-t.lastErrorTime<s}recordError(e){const t=this.serverHealth.get(e)||{lastErrorTime:0,consecutiveErrors:0};t.lastErrorTime=Date.now(),t.consecutiveErrors++,this.serverHealth.set(e,t)}recordSuccess(e){this.serverHealth.delete(e)}log(e){var t;(t=this.logger)==null||t.call(this,{...e,timestamp:Date.now()})}async createAuthHeader(e,t,s){if(!this.signer)throw new Error("Signer required for authenticated requests");const r=se(t),x=Math.floor(Date.now()/1e3)+300,o=[["t",e.toLowerCase()],["x",r],["expiration",x.toString()]],i=await this.signer({kind:24242,created_at:Math.floor(Date.now()/1e3),content:`${e} ${r}`,tags:o});return`Nostr ${btoa(JSON.stringify(i))}`}async put(e,t,s){const r=this.writeQueue.then(()=>this.doPut(e,t,s),()=>this.doPut(e,t,s));return this.writeQueue=r.then(()=>!0,()=>!0),r}async doPut(e,t,s){const r=await ot(t);if(se(r)!==se(e))throw new Error("Hash does not match data");const x=this.servers.filter(l=>l.write&&!this.isServerInBackoff(l.url));if(x.length===0)throw this.servers.filter(u=>u.write).length===0?new Error("No write-enabled server configured"):new Error("All write servers are in backoff");const o=await this.createAuthHeader("upload",e,s),i=se(e),a=await Promise.allSettled(x.map(async l=>{try{const u=await fetch(`${l.url}/upload`,{method:"PUT",headers:{Authorization:o,"Content-Type":s||"application/octet-stream","X-SHA-256":i},body:new Blob([t])});if(!u.ok&&u.status!==409){const f=await u.text(),h=`${u.status} ${f}`;throw this.log({operation:"put",server:l.url,hash:i,success:!1,error:h}),this.recordError(l.url),new Error(`${l.url}: ${h}`)}if(u.status!==409)try{const f=await u.json();if(f.sha256&&f.sha256!==i){const h=`Hash mismatch: sent ${i}, server got ${f.sha256}`;throw this.log({operation:"put",server:l.url,hash:i,success:!1,error:h}),this.recordError(l.url),new Error(`${l.url}: ${h}`)}}catch(f){if(!(f instanceof SyntaxError))throw f}return this.log({operation:"put",server:l.url,hash:i,success:!0,bytes:t.length}),this.recordSuccess(l.url),u.status!==409}catch(u){const f=u instanceof Error?u.message:String(u);throw f.includes(l.url)||(this.log({operation:"put",server:l.url,hash:i,success:!1,error:f}),this.recordError(l.url)),u}})),d=a.filter(l=>l.status==="fulfilled");if(d.length===0){const l=a.find(u=>u.status==="rejected");throw new Error(`Blossom upload failed: ${l.reason}`)}return d.some(l=>l.value)}async get(e){const t=se(e);for(const s of this.servers)if(!this.isServerInBackoff(s.url))try{const r=await fetch(`${s.url}/${t}.bin`);if(r.ok){const x=new Uint8Array(await r.arrayBuffer()),o=await ot(x);if(se(o)===t)return this.log({operation:"get",server:s.url,hash:t,success:!0,bytes:x.length}),this.recordSuccess(s.url),x;this.log({operation:"get",server:s.url,hash:t,success:!1,error:"Hash mismatch"}),this.recordError(s.url)}else r.status===404?this.log({operation:"get",server:s.url,hash:t,success:!1,error:"404"}):(this.log({operation:"get",server:s.url,hash:t,success:!1,error:`${r.status}`}),this.recordError(s.url))}catch(r){this.log({operation:"get",server:s.url,hash:t,success:!1,error:r instanceof Error?r.message:"Network error"}),this.recordError(s.url);continue}return null}async has(e){const t=se(e);for(const s of this.servers)if(!this.isServerInBackoff(s.url))try{const r=await fetch(`${s.url}/${t}.bin`,{method:"HEAD"});if(r.ok)return this.log({operation:"has",server:s.url,hash:t,success:!0}),this.recordSuccess(s.url),!0;r.status!==404&&r.status>=500&&this.recordError(s.url)}catch(r){this.log({operation:"has",server:s.url,hash:t,success:!1,error:r instanceof Error?r.message:"Network error"}),this.recordError(s.url);continue}return!1}async delete(e){const t=this.servers.find(o=>o.write);if(!t)throw new Error("No write-enabled server configured");const s=await this.createAuthHeader("delete",e),r=se(e),x=await fetch(`${t.url}/${r}.bin`,{method:"DELETE",headers:{Authorization:s}});if(!x.ok){if(x.status===404)return!1;const o=await x.text();throw new Error(`Blossom delete failed: ${x.status} ${o}`)}return!0}}class Ii{constructor(e,t,s,r=!1){q(this,"store");q(this,"chunkSize");q(this,"maxLinks");q(this,"isPublic");q(this,"buffer");q(this,"bufferOffset",0);q(this,"chunks",[]);q(this,"totalSize",0);this.store=e,this.chunkSize=t,this.maxLinks=s,this.isPublic=r,this.buffer=new Uint8Array(this.chunkSize)}async append(e){let t=0;for(;t<e.length;){const s=this.chunkSize-this.bufferOffset,r=Math.min(s,e.length-t);this.buffer.set(e.slice(t,t+r),this.bufferOffset),this.bufferOffset+=r,t+=r,this.bufferOffset===this.chunkSize&&await this.flushChunk()}this.totalSize+=e.length}async flushChunk(){if(this.bufferOffset===0)return;const e=this.buffer.slice(0,this.bufferOffset);if(this.isPublic){const t=await ot(e);await this.store.put(t,e),this.chunks.push({hash:t,size:e.length,type:te.Blob})}else{const t=e.length,{ciphertext:s,key:r}=await o0(e),x=await ot(s);await this.store.put(x,s),this.chunks.push({hash:x,size:t,key:r,type:te.Blob})}this.bufferOffset=0}async currentRoot(){if(this.chunks.length===0&&this.bufferOffset===0)return null;const e=[...this.chunks];if(this.bufferOffset>0){const t=this.buffer.slice(0,this.bufferOffset);if(this.isPublic){const s=await ot(t);await this.store.put(s,t),e.push({hash:s,size:t.length,type:te.Blob})}else{const s=t.length,{ciphertext:r,key:x}=await o0(t),o=await ot(r);await this.store.put(o,r),e.push({hash:o,size:s,key:x,type:te.Blob})}}return this.buildTreeFromChunks(e,this.totalSize)}async finalize(){if(await this.flushChunk(),this.chunks.length===0)if(this.isPublic){const t=new Uint8Array(0),s=await ot(t);return await this.store.put(s,t),{hash:s,size:0}}else{const{ciphertext:t,key:s}=await o0(new Uint8Array(0)),r=await ot(t);return await this.store.put(r,t),{hash:r,size:0,key:s}}const e=await this.buildTreeFromChunks(this.chunks,this.totalSize);return{hash:e.hash,size:this.totalSize,key:e.key}}async buildTreeFromChunks(e,t){if(e.length===1)return Qe(e[0].hash,e[0].key);if(e.length<=this.maxLinks){const r={type:te.File,links:e},{data:x,hash:o}=await y0(r);if(this.isPublic)return await this.store.put(o,x),{hash:o};{const{ciphertext:i,key:a}=await o0(x),d=await ot(i);return await this.store.put(d,i),Qe(d,a)}}const s=[];for(let r=0;r<e.length;r+=this.maxLinks){const x=e.slice(r,r+this.maxLinks),o=x.reduce((l,u)=>l+u.size,0),i={type:te.File,links:x},{data:a,hash:d}=await y0(i);if(this.isPublic)await this.store.put(d,a),s.push({hash:d,size:o,type:te.File});else{const{ciphertext:l,key:u}=await o0(a),f=await ot(l);await this.store.put(f,l),s.push({hash:f,size:o,key:u,type:te.File})}}return this.buildTreeFromChunks(s,t)}get stats(){return{chunks:this.chunks.length,buffered:this.bufferOffset,totalSize:this.totalSize}}}async function Ln(n,e){const t=await ot(e);return await n.put(t,e),t}async function Ri(n,e){const{store:t,chunkSize:s}=n,r=e.length;if(e.length<=s)return{hash:await Ln(t,e),size:r};const x=[];let o=0;for(;o<e.length;){const l=Math.min(o+s,e.length);x.push(e.slice(o,l)),o=l}const i=await Promise.all(x.map(l=>Ln(t,l))),a=i.map((l,u)=>({hash:l,size:u<i.length-1?s:e.length-u*s,type:te.Blob}));return{hash:await Ui(n,a,r),size:r}}async function Ss(n,e){const{store:t,chunkSize:s}=n,x=[...e].sort((l,u)=>l.name.localeCompare(u.name)).map(l=>({hash:l.cid.hash,key:l.cid.key,name:l.name,size:l.size,type:l.type,meta:l.meta})),o={type:te.Dir,links:x},{data:i,hash:a}=await y0(o);if(i.length<=s)return await t.put(a,i),a;const{hash:d}=await Ri(n,i);return d}async function Ui(n,e,t){const{store:s,maxLinks:r}=n;if(e.length===1&&e[0].size===t)return e[0].hash;if(e.length<=r){const o={type:te.File,links:e},{data:i,hash:a}=await y0(o);return await s.put(a,i),a}const x=[];for(let o=0;o<e.length;o+=r){const i=e.slice(o,o+r),a=i.reduce((f,h)=>f+h.size,0),d={type:te.File,links:i},{data:l,hash:u}=await y0(d);await s.put(u,l),x.push({hash:u,size:a,type:te.File})}return Ui(n,x,t)}async function Sl(n,e){return n.get(e)}async function Pl(n,e){const t=await n.get(e);return t?dt(t):null}async function Tl(n,e){if(!e)return te.Blob;const t=await n.get(e);return t?Ti(t):te.Blob}async function Ml(n,e){if(!e)return!1;const t=await n.get(e);if(!t)return!1;const s=dt(t);return(s==null?void 0:s.type)===te.Dir}async function Il(n,e){if(!e)return null;const t=await n.get(e);if(!t)return null;const s=dt(t);return s?ax(n,s):t}async function ax(n,e){const t=e.links.map(async i=>{const a=await n.get(i.hash);if(!a)throw new Error(`Missing chunk: ${se(i.hash)}`);if(i.type!==te.Blob){const d=J0(a);return ax(n,d)}else return a}),s=await Promise.all(t),r=s.reduce((i,a)=>i+a.length,0),x=new Uint8Array(r);let o=0;for(const i of s)x.set(i,o),o+=i.length;return x}async function*Rl(n,e,t={}){const{offset:s=0,prefetch:r=1}=t,x=await n.get(e);if(!x)return;const o=dt(x);if(!o){if(s>=x.length)return;yield s>0?x.slice(s):x;return}yield*Li(n,o,s,r)}async function*Li(n,e,t,s=1){let r=0,x=0;for(let l=0;l<e.links.length;l++){const u=e.links[l].size??0;if(u>0&&r+u<=t)r+=u,x=l+1;else break}const o=e.links.slice(x);if(o.length===0)return;const i=[];let a=r;for(let l=0;l<Math.min(s,o.length);l++){const u=o[l];i.push({promise:n.get(u.hash),link:u,position:a}),a+=u.size??0}let d=s;for(const l of o){const u=i.shift();if(!u)throw new Error("Prefetch queue empty unexpectedly");const f=await u.promise;if(!f)throw new Error(`Missing chunk: ${se(l.hash)}`);if(d<o.length){const h=o[d];i.push({promise:n.get(h.hash),link:h,position:a}),a+=h.size??0,d++}if(l.type!==te.Blob){const h=J0(f),B=Math.max(0,t-u.position);yield*Li(n,h,B,s),r=u.position+(l.size??0)}else{const h=u.position,B=u.position+f.length;if(r=B,B<=t)continue;if(h>=t)yield f;else{const A=t-h;yield f.slice(A)}}}}async function Ul(n,e,t,s){const r=await n.get(e);if(!r)return null;const x=dt(r);if(!x){if(t>=r.length)return new Uint8Array(0);const o=s!==void 0?Math.min(s,r.length):r.length;return r.slice(t,o)}return Ni(n,x,t,s)}async function Ni(n,e,t,s){const r=[];let x=0,o=0;const i=s!==void 0?s-t:1/0;for(const u of e.links){if(o>=i)break;const f=u.size??0;if(f>0&&x+f<=t){x+=f;continue}const h=await n.get(u.hash);if(!h)throw new Error(`Missing chunk: ${se(u.hash)}`);if(u.type!==te.Blob){const B=J0(h),A=Math.max(0,t-x),D=s!==void 0?s-x:void 0,v=await Ni(n,B,A,D);if(v.length>0){const m=Math.min(v.length,i-o);r.push(v.slice(0,m)),o+=m}x+=f}else{const B=x,A=x+h.length;if(x=A,A<=t)continue;const D=Math.max(0,t-B),v=s!==void 0?Math.min(h.length,s-B):h.length;if(D<v){const m=Math.min(v-D,i-o);r.push(h.slice(D,D+m)),o+=m}}}const a=r.reduce((u,f)=>u+f.length,0),d=new Uint8Array(a);let l=0;for(const u of r)d.set(u,l),l+=u.length;return d}async function cx(n,e){const t=await n.get(e);if(!t)return null;const s=dt(t);if(!s)return null;if(s.type===te.Dir)return s;const r=await ax(n,s),x=dt(r);return(x==null?void 0:x.type)===te.Dir?x:null}async function Es(n,e){const t=await cx(n,e);if(!t)return[];const s=[];for(const r of t.links)r.name&&s.push({name:r.name,cid:Qe(r.hash,r.key),size:r.size,type:r.type,meta:r.meta});return s}async function Ll(n,e,t){const s=t.split("/").filter(x=>x.length>0);let r=e;for(const x of s){const o=await cx(n,r);if(!o)return null;const i=o.links.find(a=>a.name===x);if(!i)return null;r=i.hash}return r}async function Nl(n,e){const t=await n.get(e);if(!t)return 0;const s=dt(t);if(!s)return t.length;let r=0;for(const x of s.links)r+=x.size;return r}async function*zi(n,e,t=""){const s=await n.get(e);if(!s)return;const r=await cx(n,e);if(r){const i=r.links.reduce((a,d)=>a+d.size,0);yield{path:t,hash:e,type:te.Dir,size:i};for(const a of r.links){if(!a.name)continue;const d=t?`${t}/${a.name}`:a.name;yield*zi(n,a.hash,d)}return}const x=dt(s);if(!x){yield{path:t,hash:e,type:te.Blob,size:s.length};return}const o=x.links.reduce((i,a)=>i+a.size,0);yield{path:t,hash:e,type:te.File,size:o}}async function Ki(n,e,t,s,r,x,o=te.Blob){const{store:i}=n,a=await Ps(i,e,t);if(!a)throw new Error(`Path not found: ${t.join("/")}`);const l=(await Es(i,a)).filter(f=>f.name!==s).map(f=>({name:f.name,cid:f.cid,size:f.size,type:f.type,meta:f.meta}));l.push({name:s,cid:r,size:x,type:o});const u=await Ss(n,l);return lx(n,e,t,u)}async function $i(n,e,t,s){const{store:r}=n,x=await Ps(r,e,t);if(!x)throw new Error(`Path not found: ${t.join("/")}`);const i=(await Es(r,x)).filter(d=>d.name!==s).map(d=>({name:d.name,cid:d.cid,size:d.size,type:d.type,meta:d.meta})),a=await Ss(n,i);return lx(n,e,t,a)}async function zl(n,e,t,s,r){if(s===r)return e;const{store:x}=n,o=await Ps(x,e,t);if(!o)throw new Error(`Path not found: ${t.join("/")}`);const i=await Es(x,o),a=i.find(u=>u.name===s);if(!a)throw new Error(`Entry not found: ${s}`);const d=i.filter(u=>u.name!==s).map(u=>({name:u.name,cid:u.cid,size:u.size,type:u.type,meta:u.meta}));d.push({name:r,cid:a.cid,size:a.size,type:a.type,meta:a.meta});const l=await Ss(n,d);return lx(n,e,t,l)}async function Kl(n,e,t,s,r){const{store:x}=n,o=await Ps(x,e,t);if(!o)throw new Error(`Source path not found: ${t.join("/")}`);const a=(await Es(x,o)).find(l=>l.name===s);if(!a)throw new Error(`Entry not found: ${s}`);let d=await $i(n,e,t,s);return d=await Ki(n,d,r,s,a.cid,a.size,a.type),d}async function Ps(n,e,t){return t.length===0?e:Ll(n,e,t.join("/"))}async function lx(n,e,t,s){if(t.length===0)return s;const{store:r}=n;let x=s;const o=[...t];for(;o.length>0;){const i=o.pop(),a=o.length===0?e:await Ps(r,e,o);if(!a)throw new Error(`Parent path not found: ${o.join("/")}`);const l=(await Es(r,a)).map(u=>u.name===i?{name:u.name,cid:Qe(x),size:u.size,type:u.type,meta:u.meta}:{name:u.name,cid:u.cid,size:u.size,type:u.type,meta:u.meta});x=await Ss(n,l)}return x}async function Oi(n,e){const{store:t,chunkSize:s}=n,r=e.length;if(e.length<=s){const{ciphertext:l,key:u}=await o0(e),f=await ot(l);return await t.put(f,l),{hash:f,size:r,key:u}}const x=[];let o=0;for(;o<e.length;){const l=Math.min(o+s,e.length);x.push(e.slice(o,l)),o=l}const i=await Promise.all(x.map(async l=>{const{ciphertext:u,key:f}=await o0(l),h=await ot(u);return await t.put(h,u),{hash:h,size:u.length,key:f,type:te.Blob}})),{hash:a,key:d}=await Hi(n,i,r);return{hash:a,size:r,key:d}}async function Hi(n,e,t){const{store:s,maxLinks:r}=n;if(e.length===1&&e[0].key&&t!==void 0&&e[0].size===t)return{hash:e[0].hash,key:e[0].key};if(e.length<=r){const o={type:te.File,links:e},{data:i}=await y0(o),{ciphertext:a,key:d}=await o0(i),l=await ot(a);return await s.put(l,a),{hash:l,key:d}}const x=[];for(let o=0;o<e.length;o+=r){const i=e.slice(o,o+r),a=i.reduce((B,A)=>B+A.size,0),d={type:te.File,links:i},{data:l}=await y0(d),{ciphertext:u,key:f}=await o0(l),h=await ot(u);await s.put(h,u),x.push({hash:h,size:a,key:f,type:te.File})}return Hi(n,x,t)}async function $l(n,e,t){const s=await n.get(e);if(!s)return null;const r=await k0(s,t),x=dt(r);return x?ux(n,x):r}async function Ol(n,e,t){const s=await n.get(e);if(!s)return null;const r=await k0(s,t),x=dt(r);if((x==null?void 0:x.type)===te.Dir)return x;if(x){const o=await ux(n,x),i=dt(o);if((i==null?void 0:i.type)===te.Dir)return i}return null}async function ux(n,e){const t=e.links.map(async i=>{const a=i.key;if(!a)throw new Error(`Missing decryption key for chunk: ${se(i.hash)}`);const d=await n.get(i.hash);if(!d)throw new Error(`Missing chunk: ${se(i.hash)}`);const l=await k0(d,a);if(i.type!==te.Blob){const u=J0(l);return ux(n,u)}else return l}),s=await Promise.all(t),r=s.reduce((i,a)=>i+a.length,0),x=new Uint8Array(r);let o=0;for(const i of s)x.set(i,o),o+=i.length;return x}async function*Hl(n,e,t,s={}){const{offset:r=0,prefetch:x=1}=s,o=await n.get(e);if(!o)return;const i=await k0(o,t),a=dt(i);if(a)yield*ji(n,a,r,x);else{if(r>=i.length)return;yield r>0?i.slice(r):i}}async function*ji(n,e,t,s=1){let r=0,x=0;for(let l=0;l<e.links.length;l++){const u=e.links[l].size??0;if(u>0&&r+u<=t)r+=u,x=l+1;else break}const o=e.links.slice(x);if(o.length===0)return;const i=[];let a=r;for(let l=0;l<Math.min(s,o.length);l++){const u=o[l];i.push({promise:n.get(u.hash),link:u,position:a}),a+=u.size??0}let d=s;for(const l of o){const u=l.key;if(!u)throw new Error(`Missing decryption key for chunk: ${se(l.hash)}`);const f=i.shift();if(!f)throw new Error("Prefetch queue empty unexpectedly");const h=await f.promise;if(!h)throw new Error(`Missing chunk: ${se(l.hash)}`);if(d<o.length){const A=o[d];i.push({promise:n.get(A.hash),link:A,position:a}),a+=A.size??0,d++}const B=await k0(h,u);if(l.type!==te.Blob){const A=J0(B),D=Math.max(0,t-f.position);yield*ji(n,A,D,s),r=f.position+(l.size??0)}else{const A=f.position,D=f.position+B.length;if(r=D,D<=t)continue;if(A>=t)yield B;else{const v=t-A;yield B.slice(v)}}}}async function jl(n,e,t,s,r){const x=await n.get(e);if(!x)return null;const o=await k0(x,t),i=dt(o);if(!i){if(s>=o.length)return new Uint8Array(0);const a=r!==void 0?Math.min(r,o.length):o.length;return o.slice(s,a)}return qi(n,i,s,r)}async function qi(n,e,t,s){const r=[];let x=0,o=0;const i=s!==void 0?s-t:1/0;for(const u of e.links){if(o>=i)break;const f=u.key;if(!f)throw new Error(`Missing decryption key for chunk: ${se(u.hash)}`);const h=u.size??0;if(h>0&&x+h<=t){x+=h;continue}const B=await n.get(u.hash);if(!B)throw new Error(`Missing chunk: ${se(u.hash)}`);const A=await k0(B,f);if(u.type!==te.Blob){const D=J0(A),v=Math.max(0,t-x),m=s!==void 0?s-x:void 0,C=await qi(n,D,v,m);if(C.length>0){const E=Math.min(C.length,i-o);r.push(C.slice(0,E)),o+=E}x+=h}else{const D=x,v=x+A.length;if(x=v,v<=t)continue;const m=Math.max(0,t-D),C=s!==void 0?Math.min(A.length,s-D):A.length;if(m<C){const E=Math.min(C-m,i-o);r.push(A.slice(m,m+E)),o+=E}}}const a=r.reduce((u,f)=>u+f.length,0),d=new Uint8Array(a);let l=0;for(const u of r)d.set(u,l),l+=u.length;return d}async function Ts(n,e){const{store:t,chunkSize:s}=n,x=[...e].sort((d,l)=>d.name.localeCompare(l.name)).map(d=>({hash:d.hash,name:d.name,size:d.size,key:d.key,type:d.type,meta:d.meta})),o=x.reduce((d,l)=>d+l.size,0),i={type:te.Dir,links:x},{data:a}=await y0(i);if(a.length<=s){const{ciphertext:d,key:l}=await o0(a),u=await ot(d);return await t.put(u,d),{hash:u,size:o,key:l}}return Oi(n,a)}async function G0(n,e,t){const s=await Ol(n,e,t);if(!s)return[];const r=[];for(const x of s.links)x.name&&r.push({name:x.name,hash:x.hash,size:x.size,key:x.key,type:x.type,meta:x.meta});return r}async function Gs(n,e,t){const s=await n.get(e);if(!s)return null;const r=await k0(s,t);return dt(r)}async function dx(n,e,t,s){const r=[];let x=e,o=t;for(const i of s){const d=(await G0(n,x,o)).find(l=>l.name===i);if(!d||!d.key)return null;r.push(d.key),x=d.hash,o=d.key}return{dirHash:x,dirKey:o,pathKeys:r}}async function ql(n,e,t,s,r,x,o,i,a=te.Blob){const{store:d}=n,l=await dx(d,e,t,s);if(!l)throw new Error(`Path not found: ${s.join("/")}`);const{dirHash:u,dirKey:f,pathKeys:h}=l,A=(await G0(d,u,f)).filter(v=>v.name!==r).map(v=>({name:v.name,hash:v.hash,size:v.size,key:v.key,type:v.type,meta:v.meta}));A.push({name:r,hash:x,size:o,key:i,type:a});const D=await Ts(n,A);return fx(n,e,t,s,h,D.hash,D.key)}async function Vl(n,e,t,s,r){const{store:x}=n,o=await dx(x,e,t,s);if(!o)throw new Error(`Path not found: ${s.join("/")}`);const{dirHash:i,dirKey:a,pathKeys:d}=o,u=(await G0(x,i,a)).filter(h=>h.name!==r).map(h=>({name:h.name,hash:h.hash,size:h.size,key:h.key,type:h.type,meta:h.meta})),f=await Ts(n,u);return fx(n,e,t,s,d,f.hash,f.key)}async function Gl(n,e,t,s,r,x){if(r===x)return{hash:e,key:t};const{store:o}=n,i=await dx(o,e,t,s);if(!i)throw new Error(`Path not found: ${s.join("/")}`);const{dirHash:a,dirKey:d,pathKeys:l}=i,u=await G0(o,a,d),f=u.find(A=>A.name===r);if(!f)throw new Error(`Entry not found: ${r}`);const h=u.filter(A=>A.name!==r).map(A=>({name:A.name,hash:A.hash,size:A.size,key:A.key,type:A.type,meta:A.meta}));h.push({name:x,hash:f.hash,size:f.size,key:f.key,type:f.type,meta:f.meta});const B=await Ts(n,h);return fx(n,e,t,s,l,B.hash,B.key)}async function fx(n,e,t,s,r,x,o){if(s.length===0)return{hash:x,key:o};const{store:i}=n;let a=x,d=o;const l=[...s];for(;l.length>0;){const u=l.pop();let f,h;if(l.length===0)f=e,h=t;else{f=e,h=t;for(let v=0;v<l.length;v++){const C=(await G0(i,f,h)).find(E=>E.name===l[v]);if(!C||!C.key)throw new Error(`Parent path not found: ${l.join("/")}`);f=C.hash,h=r[v]??C.key}}const A=(await G0(i,f,h)).map(v=>v.name===u?{name:v.name,hash:a,size:v.size,key:d,type:v.type,meta:v.meta}:{name:v.name,hash:v.hash,size:v.size,key:v.key,type:v.type,meta:v.meta}),D=await Ts(n,A);a=D.hash,d=D.key}return{hash:a,key:d}}const Vi=2*1024*1024,Gi=174;class hx{constructor(e){q(this,"store");q(this,"chunkSize");q(this,"maxLinks");this.store=e.store,this.chunkSize=e.chunkSize??Vi,this.maxLinks=e.maxLinks??Gi}get config(){return{store:this.store,chunkSize:this.chunkSize,maxLinks:this.maxLinks}}async putBlob(e){return Ln(this.store,e)}async putFile(e,t){if(t!=null&&t.public){const r=await Ri(this.config,e);return{cid:{hash:r.hash},size:r.size}}const s=await Oi(this.config,e);return{cid:Qe(s.hash,s.key),size:s.size}}async putDirectory(e,t){const s=e.reduce((o,i)=>o+i.size,0);if(t!=null&&t.public){const o=e.map(a=>({name:a.name,cid:a.cid,size:a.size,type:a.type,meta:a.meta}));return{cid:{hash:await Ss(this.config,o)},size:s}}const r=e.map(o=>({name:o.name,hash:o.cid.hash,size:o.size,key:o.cid.key,type:o.type,meta:o.meta})),x=await Ts(this.config,r);return{cid:Qe(x.hash,x.key),size:s}}async getBlob(e){return Sl(this.store,e)}async getTreeNode(e){return e.key?Gs(this.store,e.hash,e.key):Pl(this.store,e.hash)}async getType(e){return e!=null&&e.hash?Tl(this.store,e.hash):te.Blob}async isDirectory(e){if(!(e!=null&&e.hash))return!1;if(e.key)try{const t=await Gs(this.store,e.hash,e.key);return t?t.links.length===0?!0:t.links.some(s=>s.name!==void 0&&!s.name.startsWith("_")):!1}catch{return!1}return Ml(this.store,e.hash)}async readFile(e){return e.key?$l(this.store,e.hash,e.key):Il(this.store,e.hash)}async*readFileStream(e,t={}){e.key?yield*Hl(this.store,e.hash,e.key,t):yield*Rl(this.store,e.hash,t)}async readFileRange(e,t,s){return e.key?jl(this.store,e.hash,e.key,t,s):Ul(this.store,e.hash,t,s)}async listDirectory(e){return e.key?(await G0(this.store,e.hash,e.key)).map(r=>({name:r.name,cid:Qe(r.hash,r.key),size:r.size,type:r.type??te.Blob,meta:r.meta})):(await Es(this.store,e.hash)).map(s=>({name:s.name,cid:s.cid,size:s.size,type:s.type,meta:s.meta}))}async resolvePath(e,t){const s=Array.isArray(t)?t:t.split("/").filter(o=>o.length>0);let r=e,x=te.Dir;for(const o of s){const a=(await this.listDirectory(r)).find(d=>d.name===o);if(!a)return null;r=a.cid,x=a.type}return{cid:r,type:x}}async getSize(e){return Nl(this.store,e)}async*walk(e,t=""){yield*zi(this.store,e,t)}async*walkBlocks(e){const t=new Set,s=async function*(r,x,o){const i=se(x);if(t.has(i))return;t.add(i);const a=await r.get(x);if(a)if(yield{hash:x,data:a},o){const d=await Gs(r,x,o);if(d)for(const l of d.links)yield*s(r,l.hash,l.key)}else{const d=dt(a);if(d)for(const l of d.links)yield*s(r,l.hash,l.key)}};yield*s(this.store,e.hash,e.key)}async pull(e){const t=new Set;let s=0,r=0;const x=async(o,i)=>{const a=se(o);if(t.has(a))return;t.add(a);const d=await this.store.get(o);if(d)if(s++,r+=d.length,i){const l=await Gs(this.store,o,i);l&&await Promise.all(l.links.map(u=>x(u.hash,u.key)))}else{const l=dt(d);l&&await Promise.all(l.links.map(u=>x(u.hash,u.key)))}};return await x(e.hash,e.key),{cid:e,chunks:s,bytes:r}}async push(e,t,s){var l,u,f,h;await this.pull(e);const r=[];for await(const B of this.walkBlocks(e))r.push(B);let x=0,o=0,i=0,a=0;const d=[];for(let B=0;B<r.length;B++){const{hash:A,data:D}=r[B];(l=s==null?void 0:s.onProgress)==null||l.call(s,B+1,r.length);try{await t.put(A,D)===!1?(o++,(u=s==null?void 0:s.onBlock)==null||u.call(s,A,"skipped")):(x++,a+=D.length,(f=s==null?void 0:s.onBlock)==null||f.call(s,A,"success"))}catch(v){i++;const m=v instanceof Error?v:new Error(String(v));d.push({hash:A,error:m}),(h=s==null?void 0:s.onBlock)==null||h.call(s,A,"error",m)}}return{cid:e,pushed:x,skipped:o,failed:i,bytes:a,errors:d}}async setEntry(e,t,s,r,x,o=te.Blob){if(e.key){const a=await ql(this.config,e.hash,e.key,t,s,r.hash,x,r.key,o);return Qe(a.hash,a.key)}return{hash:await Ki(this.config,e.hash,t,s,r,x,o)}}async removeEntry(e,t,s){if(e.key){const x=await Vl(this.config,e.hash,e.key,t,s);return Qe(x.hash,x.key)}return{hash:await $i(this.config,e.hash,t,s)}}async renameEntry(e,t,s,r){if(e.key){const o=await Gl(this.config,e.hash,e.key,t,s,r);return Qe(o.hash,o.key)}return{hash:await zl(this.config,e.hash,t,s,r)}}async moveEntry(e,t,s,r){if(e.key)throw new Error("moveEntry not yet implemented for encrypted trees");return{hash:await Kl(this.config,e.hash,t,s,r)}}getStore(){return this.store}createStream(e){return new Ii(this.store,this.chunkSize,this.maxLinks,(e==null?void 0:e.public)??!1)}}const ir=10,Wl=.5,Yl=.25,Ws=32*1024,to=5e3,Ql=12e4,Jl=20,ar=0,cr=1;function Ex(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}class cs{constructor(e,t){q(this,"pubkey");q(this,"uuid");q(this,"str");this.pubkey=e,this.uuid=t||Ex(),this.str=`${e}:${this.uuid}`}toString(){return this.str}short(){return`${this.pubkey.slice(0,8)}:${this.uuid.slice(0,6)}`}static fromString(e){const[t,s]=e.split(":");if(!t||!s)throw new Error(`Invalid peer string: ${e}`);return new cs(t,s)}}let Xl=class{constructor(e=100){q(this,"cache",new Map);q(this,"maxSize");this.maxSize=e}get(e){const t=this.cache.get(e);return t!==void 0&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.delete(e),this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s!==void 0&&this.cache.delete(s)}this.cache.set(e,t)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}keys(){return this.cache.keys()}values(){return this.cache.values()}entries(){return this.cache.entries()}forEach(e){this.cache.forEach(e)}};function Zl(n){const e=nx(n),t=new Uint8Array(1+e.length);return t[0]=ar,t.set(e,1),t.buffer}function so(n){const e=nx(n),t=new Uint8Array(1+e.length);return t[0]=cr,t.set(e,1),t.buffer}function eu(n){try{const e=n instanceof ArrayBuffer?new Uint8Array(n):n;if(e.length<2)return null;const t=e[0],s=e.slice(1);return t===ar?{type:ar,body:Un(s)}:t===cr?{type:cr,body:Un(s)}:null}catch{return null}}async function tu(n,e){const t=await ot(n);if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}function su(){return{decrementAtMax:Math.random()<Wl,decrementAtMin:Math.random()<Yl}}function ro(n,e){return n<=0?0:n===ir?e.decrementAtMax?n-1:n:n===1?e.decrementAtMin?0:n:n-1}function ru(n){return n>0}function nu(n,e=ir){return{h:n,htl:e}}function xu(n,e){return{h:n,d:e}}function ou(n,e,t,s){return{h:n,d:e,i:t,n:s}}function iu(n){return n.i!==void 0&&n.n!==void 0}function os(n){let e="";for(let t=0;t<n.length;t++)e+=n[t].toString(16).padStart(2,"0");return e}function au(n){for(const e of n.values())clearTimeout(e.timeout),e.resolve(null);n.clear()}const cu=[{urls:"stun:stun.iris.to:3478"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}],lu=100,uu=200;class Nn{constructor(e){q(this,"peerId");q(this,"pubkey");q(this,"direction");q(this,"pc");q(this,"dataChannel",null);q(this,"localStore");q(this,"sendSignaling");q(this,"onClose");q(this,"onConnected");q(this,"debug");q(this,"ourRequests",new Map);q(this,"theirRequests",new Xl(uu));q(this,"requestTimeout");q(this,"pendingCandidates",[]);q(this,"candidateBatchTimeout",null);q(this,"queuedRemoteCandidates",[]);q(this,"onForwardRequest");q(this,"stats",{requestsSent:0,requestsReceived:0,responsesSent:0,responsesReceived:0,receiveErrors:0,fragmentsSent:0,fragmentsReceived:0,fragmentTimeouts:0,reassembliesCompleted:0});q(this,"pendingReassemblies",new Map);q(this,"reassemblyCleanupInterval");q(this,"htlConfig");q(this,"createdAt");q(this,"connectedAt");this.peerId=e.peerId.toString(),this.pubkey=e.peerId.pubkey,this.direction=e.direction,this.localStore=e.localStore,this.sendSignaling=e.sendSignaling,this.onClose=e.onClose,this.onConnected=e.onConnected,this.onForwardRequest=e.onForwardRequest,this.requestTimeout=e.requestTimeout??5e3,this.debug=e.debug??!1,this.createdAt=Date.now(),this.htlConfig=su(),this.reassemblyCleanupInterval=setInterval(()=>this.cleanupStaleReassemblies(),5e3),this.pc=new RTCPeerConnection({iceServers:cu}),this.setupPeerConnection()}log(...e){this.debug&&console.log(`[Peer ${this.peerId.slice(0,12)}]`,...e)}get state(){return this.pc.connectionState}get isConnected(){return this.pc.connectionState==="connected"}get pendingTheirRequestsCount(){return this.theirRequests.size}scheduleCandidateBatch(){this.candidateBatchTimeout||(this.candidateBatchTimeout=setTimeout(()=>{if(this.candidateBatchTimeout=null,this.pendingCandidates.length>0){const e=this.pendingCandidates;this.pendingCandidates=[],this.sendSignaling({type:"candidates",candidates:e,recipient:this.peerId,peerId:""}).catch(t=>{this.log("Failed to send candidates batch:",t)})}},lu))}setupPeerConnection(){this.pc.onicecandidate=e=>{e.candidate&&(this.pendingCandidates.push(e.candidate.toJSON()),this.scheduleCandidateBatch())},this.pc.onconnectionstatechange=()=>{var e;this.log("Connection state:",this.pc.connectionState),this.pc.connectionState==="connected"?(this.connectedAt=Date.now(),(e=this.onConnected)==null||e.call(this)):(this.pc.connectionState==="failed"||this.pc.connectionState==="closed"||this.pc.connectionState==="disconnected")&&this.close()},this.pc.ondatachannel=e=>{this.dataChannel=e.channel,this.setupDataChannel(this.dataChannel)}}setupDataChannel(e){e.binaryType="arraybuffer",e.onopen=()=>{this.log("Data channel open")},e.onclose=()=>{this.log("Data channel closed"),this.close()},e.onmessage=async t=>{t.data instanceof ArrayBuffer&&await this.handleMessage(t.data)}}async handleMessage(e){try{const t=eu(e);if(!t){this.log("Failed to parse message"),this.stats.receiveErrors++;return}if(t.type===ar)await this.handleRequest(t.body);else if(t.type===cr){const s=t.body;let r,x;if(iu(s)){const d=this.handleFragmentResponse(s);if(!d)return;r=d,x=s.h}else r=s.d,x=s.h;const o=os(x),i=this.ourRequests.get(o);if(!i)return;clearTimeout(i.timeout),this.ourRequests.delete(o),await tu(r,x)?(i.resolve(r),this.stats.responsesReceived++):(i.resolve(null),this.stats.receiveErrors++)}}catch(t){this.log("Error handling message:",t),this.stats.receiveErrors++}}async handleRequest(e){const t=e.htl??ir,s=e.h,r=os(s);if(this.stats.requestsReceived++,this.localStore){const x=await this.localStore.get(s);if(x){this.sendResponse(s,x),this.stats.responsesSent++;return}}if(this.onForwardRequest&&ru(t)){this.theirRequests.set(r,{hash:s,requestedAt:Date.now()});const x=ro(t,this.htlConfig),o=await this.onForwardRequest(s,this.peerId,x);if(o){this.theirRequests.delete(r),this.sendResponse(s,o),this.stats.responsesSent++;return}}}sendResponse(e,t){if(!(!this.dataChannel||this.dataChannel.readyState!=="open"))if(t.length<=Ws){const s=xu(e,t);this.dataChannel.send(so(s))}else{const s=Math.ceil(t.length/Ws);for(let r=0;r<s;r++){const x=r*Ws,o=Math.min(x+Ws,t.length),i=t.slice(x,o),a=ou(e,i,r,s);this.dataChannel.send(so(a)),this.stats.fragmentsSent++}}}handleFragmentResponse(e){const t=os(e.h),s=Date.now();this.stats.fragmentsReceived++;let r=this.pendingReassemblies.get(t);r||(r={hash:e.h,fragments:new Map,totalExpected:e.n,receivedBytes:0,firstFragmentAt:s,lastFragmentAt:s},this.pendingReassemblies.set(t,r));const x=this.ourRequests.get(t);return x&&(clearTimeout(x.timeout),x.timeout=setTimeout(()=>{this.ourRequests.delete(t),this.pendingReassemblies.delete(t),this.stats.fragmentTimeouts++,x.resolve(null)},to)),r.fragments.has(e.i)||(r.fragments.set(e.i,e.d),r.receivedBytes+=e.d.length,r.lastFragmentAt=s),r.fragments.size===r.totalExpected?(this.pendingReassemblies.delete(t),this.stats.reassembliesCompleted++,this.assembleFragments(r)):null}assembleFragments(e){const t=new Uint8Array(e.receivedBytes);let s=0;for(let r=0;r<e.totalExpected;r++){const x=e.fragments.get(r);t.set(x,s),s+=x.length}return t}cleanupStaleReassemblies(){const e=Date.now();for(const[t,s]of this.pendingReassemblies){const r=e-s.lastFragmentAt,x=e-s.firstFragmentAt;(r>to||x>Ql)&&(this.pendingReassemblies.delete(t),this.stats.fragmentTimeouts++,this.log("Fragment reassembly timed out:",t.slice(0,16),`stall=${r}ms, total=${x}ms, fragments=${s.fragments.size}/${s.totalExpected}`))}if(this.pendingReassemblies.size>Jl){const t=[...this.pendingReassemblies.entries()].sort((s,r)=>s[1].firstFragmentAt-r[1].firstFragmentAt)[0];t&&(this.pendingReassemblies.delete(t[0]),this.stats.fragmentTimeouts++,this.log("Fragment reassembly evicted (memory cap):",t[0].slice(0,16)))}}async request(e,t=ir){if(!this.dataChannel||this.dataChannel.readyState!=="open")return null;const s=os(e),r=this.ourRequests.get(s);if(r)return new Promise(o=>{const i=r.resolve;r.resolve=a=>{i(a),o(a)}});const x=ro(t,this.htlConfig);return this.stats.requestsSent++,new Promise(o=>{const i=setTimeout(()=>{this.ourRequests.delete(s),o(null)},this.requestTimeout);this.ourRequests.set(s,{hash:e,resolve:o,timeout:i});const a=nu(e,x);this.dataChannel.send(Zl(a))})}getStats(){return{...this.stats}}sendData(e,t){const s=os(e);return this.theirRequests.get(s)?(this.theirRequests.delete(s),this.sendResponse(e,t),this.stats.responsesSent++,this.log("Sent data for hash:",s.slice(0,16)),!0):!1}hasRequested(e){return this.theirRequests.has(os(e))}getTheirRequestCount(){return this.theirRequests.size}async connect(e){this.dataChannel=this.pc.createDataChannel("hashtree",{ordered:!1}),this.setupDataChannel(this.dataChannel);const t=await this.pc.createOffer();await this.pc.setLocalDescription(t),await this.sendSignaling({type:"offer",offer:t,recipient:this.peerId,peerId:e})}async handleSignaling(e,t){if(e.type==="offer"){await this.pc.setRemoteDescription(new RTCSessionDescription(e.offer)),await this.processQueuedCandidates();const s=await this.pc.createAnswer();await this.pc.setLocalDescription(s),await this.sendSignaling({type:"answer",answer:s,recipient:this.peerId,peerId:t})}else if(e.type==="answer")await this.pc.setRemoteDescription(new RTCSessionDescription(e.answer)),await this.processQueuedCandidates();else if(e.type==="candidate")await this.addRemoteCandidate(e.candidate);else if(e.type==="candidates")for(const s of e.candidates)await this.addRemoteCandidate(s)}async addRemoteCandidate(e){if(!this.pc.remoteDescription){this.queuedRemoteCandidates.push(e);return}try{await this.pc.addIceCandidate(new RTCIceCandidate(e))}catch(t){this.log("Failed to add ICE candidate:",t)}}async processQueuedCandidates(){const e=this.queuedRemoteCandidates;this.queuedRemoteCandidates=[];for(const t of e)try{await this.pc.addIceCandidate(new RTCIceCandidate(t))}catch(s){this.log("Failed to add queued ICE candidate:",s)}}close(){this.candidateBatchTimeout&&(clearTimeout(this.candidateBatchTimeout),this.candidateBatchTimeout=null),this.reassemblyCleanupInterval&&(clearInterval(this.reassemblyCleanupInterval),this.reassemblyCleanupInterval=void 0),this.pendingReassemblies.clear(),au(this.ourRequests),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onclose=null,this.dataChannel.onmessage=null,this.dataChannel.close(),this.dataChannel=null),this.pc.onicecandidate=null,this.pc.onconnectionstatechange=null,this.pc.ondatachannel=null,this.pc.close(),this.onClose()}}const Wi=["wss://relay.damus.io","wss://relay.primal.net","wss://nos.lol","wss://relay.nostr.band","wss://temp.iris.to","wss://relay.snort.social"],Ys=25050,Qr="hello";class Yi{constructor(e){q(this,"config");q(this,"pools");q(this,"peerClassifier");q(this,"signer");q(this,"encrypt");q(this,"decrypt");q(this,"giftWrap");q(this,"giftUnwrap");q(this,"myPeerId");q(this,"pool");q(this,"subscriptions",[]);q(this,"peers",new Map);q(this,"helloInterval",null);q(this,"cleanupInterval",null);q(this,"eventHandlers",new Set);q(this,"running",!1);q(this,"pendingReqs",new Map);q(this,"pendingGets",new Map);q(this,"blossomFetches",0);if(this.signer=e.signer,this.encrypt=e.encrypt,this.decrypt=e.decrypt,this.giftWrap=e.giftWrap,this.giftUnwrap=e.giftUnwrap,this.myPeerId=new cs(e.pubkey,Ex()),this.peerClassifier=e.peerClassifier??(()=>"other"),e.pools)this.pools=e.pools;else{const t=e.maxConnections??6,s=e.satisfiedConnections??3;this.pools={follows:{maxConnections:0,satisfiedConnections:0},other:{maxConnections:t,satisfiedConnections:s}}}this.config={helloInterval:e.helloInterval??1e4,messageTimeout:e.messageTimeout??6e4,requestTimeout:e.requestTimeout??5e3,peerQueryDelay:e.peerQueryDelay??500,relays:e.relays??Wi,localStore:e.localStore??null,fallbackStores:e.fallbackStores??[],debug:e.debug??!1},this.pool=new Fc}log(...e){this.config.debug&&console.log("[WebRTCStore]",...e)}getPoolCounts(){const e={follows:{connected:0,total:0},other:{connected:0,total:0}};for(const{peer:t,pool:s}of this.peers.values())e[s].total++,t.isConnected&&e[s].connected++;return e}canAcceptPeer(e){return this.getPoolCounts()[e].total<this.pools[e].maxConnections}isPoolSatisfied(e){return this.getPoolCounts()[e].connected>=this.pools[e].satisfiedConnections}start(){this.running||(this.running=!0,this.log("Starting with peerId:",this.myPeerId.short()),this.log("Pool config:",this.pools),this.startSubscription(),this.helloInterval=setInterval(()=>{this.maybeSendHello()},this.config.helloInterval),this.maybeSendHello(),this.cleanupInterval=setInterval(()=>{this.cleanupConnections()},5e3))}stop(){if(this.running){this.running=!1,this.log("Stopping"),this.helloInterval&&(clearInterval(this.helloInterval),this.helloInterval=null),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null);for(const e of this.subscriptions)e.close();this.subscriptions=[];for(const{peer:e}of this.peers.values())e.close();this.peers.clear()}}on(e){return this.eventHandlers.add(e),()=>this.eventHandlers.delete(e)}emit(e){for(const t of this.eventHandlers)t(e)}startSubscription(){const e=Math.floor((Date.now()-this.config.messageTimeout)/1e3),t={onevent:s=>{this.handleSignalingEvent(s)},oneose:()=>{this.log("Subscription EOSE received")}};this.subscriptions.push(this.pool.subscribe(this.config.relays,{kinds:[Ys],"#l":[Qr],since:e},t)),this.subscriptions.push(this.pool.subscribe(this.config.relays,{kinds:[Ys],"#p":[this.myPeerId.pubkey],since:e},t))}async handleSignalingEvent(e){var o,i,a;if(Date.now()/1e3-(e.created_at??0)>this.config.messageTimeout/1e3)return;const s=e.tags.find(d=>d[0]==="expiration");if(s&&parseInt(s[1],10)<Date.now()/1e3)return;if(((o=e.tags.find(d=>d[0]==="l"))==null?void 0:o[1])===Qr){const d=(i=e.tags.find(l=>l[0]==="peerId"))==null?void 0:i[1];d&&await this.handleHello(d,e.pubkey);return}if(((a=e.tags.find(d=>d[0]==="p"))==null?void 0:a[1])===this.myPeerId.pubkey)try{const d=await this.giftUnwrap(e);if(!d)return;const l=JSON.parse(d.content);await this.handleSignalingMessage(l,d.pubkey)}catch{}}async handleSignalingMessage(e,t){if(e.recipient!==this.myPeerId.toString())return;const s=new cs(t,e.peerId),r=s.toString();if(e.type==="offer")await this.handleOffer(s,e);else{const x=this.peers.get(r);x&&await x.peer.handleSignaling(e,this.myPeerId.uuid)}}async handleHello(e,t){const s=new cs(t,e);if(s.toString()===this.myPeerId.toString()||this.peers.has(s.toString()))return;const r=this.peerClassifier(t);if(!this.canAcceptPeer(r)){this.log("Ignoring hello from",s.short(),"- pool",r,"is full");return}this.log("Received hello from",s.short(),"pool:",r),this.myPeerId.uuid<e&&await this.connectToPeer(s,r)}async handleOffer(e,t){if(e.toString()===this.myPeerId.toString())return;const s=e.toString(),r=this.peerClassifier(e.pubkey);if(!this.peers.has(s)&&!this.canAcceptPeer(r)){this.log("Rejecting offer from",e.short(),"- pool",r,"is full");return}const x=this.peers.get(s);x&&(x.peer.close(),this.peers.delete(s)),this.log("Accepting offer from",e.short(),"pool:",r);const o=new Nn({peerId:e,direction:"inbound",localStore:this.config.localStore,sendSignaling:i=>this.sendSignaling(i,e.pubkey),onClose:()=>this.handlePeerClose(s),onConnected:()=>{this.emit({type:"peer-connected",peerId:s}),this.emit({type:"update"}),this.tryPendingReqs(o)},onForwardRequest:(i,a,d)=>this.forwardRequest(i,a,d),requestTimeout:this.config.requestTimeout,debug:this.config.debug});this.peers.set(s,{peer:o,pool:r}),await o.handleSignaling(t,this.myPeerId.uuid)}async connectToPeer(e,t){const s=e.toString();if(this.peers.has(s))return;this.log("Initiating connection to",e.short(),"pool:",t);const r=new Nn({peerId:e,direction:"outbound",localStore:this.config.localStore,sendSignaling:x=>this.sendSignaling(x,e.pubkey),onClose:()=>this.handlePeerClose(s),onConnected:()=>{this.emit({type:"peer-connected",peerId:s}),this.emit({type:"update"}),this.tryPendingReqs(r)},onForwardRequest:(x,o,i)=>this.forwardRequest(x,o,i),requestTimeout:this.config.requestTimeout,debug:this.config.debug});this.peers.set(s,{peer:r,pool:t}),await r.connect(this.myPeerId.uuid)}handlePeerClose(e){this.peers.delete(e),this.emit({type:"peer-disconnected",peerId:e}),this.emit({type:"update"})}async forwardRequest(e,t,s){const r=Array.from(this.peers.values()).filter(({peer:x})=>x.isConnected&&x.peerId!==t);r.sort((x,o)=>x.pool==="follows"&&o.pool!=="follows"?-1:x.pool!=="follows"&&o.pool==="follows"?1:0);for(let x=0;x<r.length;x++){const{peer:o}=r[x],i=o.request(e,s),a=await Promise.race([i.then(d=>({type:"data",data:d})),this.delay(this.config.peerQueryDelay).then(()=>({type:"timeout"}))]);if(a.type==="data"&&a.data)return this.config.localStore&&await this.config.localStore.put(e,a.data),a.data;a.type==="timeout"&&this.log("Forward: peer",o.peerId.slice(0,12),"timeout, trying next")}return null}sendToInterestedPeers(e,t){let s=0;for(const{peer:r}of this.peers.values())r.isConnected&&r.sendData(e,t)&&s++;return s>0&&this.log("Sent data to",s,"interested peers for hash:",se(e).slice(0,16)),s}async sendSignaling(e,t){if("peerId"in e&&e.peerId===""&&(e.peerId=this.myPeerId.uuid),t){const s={kind:Ys,content:JSON.stringify(e),tags:[]},r=await this.giftWrap(s,t);await this.pool.publish(this.config.relays,r)}else{const s=Math.floor((Date.now()+3e5)/1e3),r=[["l",Qr],["peerId",e.peerId],["expiration",s.toString()]],x={kind:Ys,created_at:Math.floor(Date.now()/1e3),tags:r,content:""},o=await this.signer(x);await this.pool.publish(this.config.relays,o)}}maybeSendHello(){if(!this.running)return;const e=this.isPoolSatisfied("follows"),t=this.isPoolSatisfied("other");if(e&&t){const r=this.getPoolCounts();this.log("Satisfied - follows:",r.follows.connected,"other:",r.other.connected);return}const s=this.getPoolCounts();this.log("Sending hello - follows:",s.follows.connected,"/",this.pools.follows.satisfiedConnections,"other:",s.other.connected,"/",this.pools.other.satisfiedConnections),this.sendSignaling({type:"hello",peerId:this.myPeerId.uuid})}cleanupConnections(){const e=Date.now(),t=15e3;for(const[s,{peer:r}]of this.peers){const x=r.state,o=x==="new"&&e-r.createdAt>t;(x==="failed"||x==="closed"||x==="disconnected"||o)&&(this.log("Cleaning up",x,"connection",o?"(stale)":""),r.close(),this.peers.delete(s),this.emit({type:"update"}))}}getConnectedCount(){return Array.from(this.peers.values()).filter(({peer:e})=>e.isConnected).length}getPeers(){return Array.from(this.peers.values()).map(({peer:e,pool:t})=>({peerId:e.peerId,pubkey:e.pubkey,state:e.state,direction:e.direction,connectedAt:e.connectedAt,isSelf:e.pubkey===this.myPeerId.pubkey,pool:t}))}getMyPeerId(){return this.myPeerId.uuid}isSatisfied(){return this.isPoolSatisfied("follows")&&this.isPoolSatisfied("other")}setPeerClassifier(e){this.peerClassifier=e;for(const[t,s]of this.peers){const r=e(s.peer.pubkey);r!==s.pool&&(this.log("Reclassified peer",t.slice(0,16),"from",s.pool,"to",r),s.pool=r)}this.emit({type:"update"})}setPoolConfig(e){this.pools=e,this.log("Pool config updated:",e),this.emit({type:"update"})}getPoolConfig(){return{...this.pools}}getFallbackStoresCount(){return this.config.fallbackStores.length}getStats(){const e={requestsSent:0,requestsReceived:0,responsesSent:0,responsesReceived:0,receiveErrors:0,blossomFetches:this.blossomFetches,fragmentsSent:0,fragmentsReceived:0,fragmentTimeouts:0,reassembliesCompleted:0},t=new Map;for(const[s,{peer:r,pool:x}]of this.peers){const o=r.getStats();e.requestsSent+=o.requestsSent,e.requestsReceived+=o.requestsReceived,e.responsesSent+=o.responsesSent,e.responsesReceived+=o.responsesReceived,e.receiveErrors+=o.receiveErrors,e.fragmentsSent+=o.fragmentsSent,e.fragmentsReceived+=o.fragmentsReceived,e.fragmentTimeouts+=o.fragmentTimeouts,e.reassembliesCompleted+=o.reassembliesCompleted,t.set(s,{pubkey:r.pubkey,pool:x,stats:o})}return{aggregate:e,perPeer:t}}async put(e,t){const s=this.config.localStore?await this.config.localStore.put(e,t):!1;this.sendToInterestedPeers(e,t);for(const r of this.config.fallbackStores)r.put(e,t).catch(()=>{});return s}async get(e){if(!e)return null;if(this.config.localStore){const x=await this.config.localStore.get(e);if(x)return x}const t=se(e),s=this.pendingGets.get(t);if(s)return this.log("Deduplicating get for hash:",t.slice(0,16)),s;const r=this.fetchFromPeers(e);this.pendingGets.set(t,r);try{return await r}finally{this.pendingGets.delete(t)}}async fetchFromPeers(e){const t=new Set,s=Array.from(this.peers.values()).filter(({peer:r})=>r.isConnected);s.sort((r,x)=>r.pool==="follows"&&x.pool!=="follows"?-1:r.pool!=="follows"&&x.pool==="follows"?1:0);for(let r=0;r<s.length;r++){const{peer:x}=s[r];t.add(x.peerId);const o=x.request(e),i=await Promise.race([o.then(a=>({type:"data",data:a})),this.delay(this.config.peerQueryDelay).then(()=>({type:"timeout"}))]);if(i.type==="data"&&i.data)return this.config.localStore&&await this.config.localStore.put(e,i.data),i.data;i.type==="timeout"&&this.log("Peer",x.peerId.slice(0,12),"timeout after",this.config.peerQueryDelay,"ms, trying next")}if(this.config.fallbackStores.length>0)for(const r of this.config.fallbackStores)try{const x=await r.get(e);if(x)return this.blossomFetches++,this.config.localStore&&await this.config.localStore.put(e,x),x}catch(x){this.log("Fallback store error:",x)}return this.running&&!this.isSatisfied()?this.waitForHash(e,t):null}delay(e){return new Promise(t=>setTimeout(t,e))}waitForHash(e,t){return new Promise(s=>{const r=Math.max(this.config.requestTimeout*6,3e4),x=setTimeout(()=>{this.removePendingReq(e,o),s(null)},r),o={resolve:s,timeout:x,triedPeers:t},i=this.pendingReqs.get(e);i?i.push(o):this.pendingReqs.set(e,[o]),this.log("Added to pending reqs:",e.slice(0,16),"tried",t.size,"peers"),this.tryConnectedPeersForHash(e)})}async tryConnectedPeersForHash(e){const t=this.pendingReqs.get(e);if(!t||t.length===0)return;const s=Array.from(this.peers.values()).filter(({peer:r})=>r.isConnected).map(({peer:r})=>r);for(const r of s){const x=r.peerId,o=t.filter(a=>!a.triedPeers.has(x));if(o.length===0)continue;for(const a of o)a.triedPeers.add(x);this.log("Trying pending req from connected peer:",e.slice(0,16));const i=await r.request(e);if(i){this.config.localStore&&await this.config.localStore.put(e,i);const a=this.pendingReqs.get(e);if(a){for(const d of a)clearTimeout(d.timeout),d.resolve(i);this.pendingReqs.delete(e)}this.log("Resolved pending req:",e.slice(0,16));return}}}removePendingReq(e,t){const s=this.pendingReqs.get(e);if(!s)return;const r=s.indexOf(t);r!==-1&&(s.splice(r,1),s.length===0&&this.pendingReqs.delete(e))}async tryPendingReqs(e){const t=e.peerId;for(const[s,r]of this.pendingReqs.entries()){const x=r.filter(i=>!i.triedPeers.has(t));if(x.length===0)continue;for(const i of x)i.triedPeers.add(t);this.log("Trying pending req from new peer:",s.slice(0,16));const o=await e.request(s);if(o){this.config.localStore&&await this.config.localStore.put(s,o);for(const i of r)clearTimeout(i.timeout),i.resolve(o);this.pendingReqs.delete(s),this.log("Resolved pending req:",s.slice(0,16))}}}async has(e){return!!(this.config.localStore&&await this.config.localStore.has(e))}async delete(e){return this.config.localStore?this.config.localStore.delete(e):!1}}function zn(n){var i,a,d,l,u;const e=(i=n.tags.find(f=>f[0]==="hash"))==null?void 0:i[1];if(!e)return null;const t=(a=n.tags.find(f=>f[0]==="key"))==null?void 0:a[1],s=(d=n.tags.find(f=>f[0]==="encryptedKey"))==null?void 0:d[1],r=(l=n.tags.find(f=>f[0]==="keyId"))==null?void 0:l[1],x=(u=n.tags.find(f=>f[0]==="selfEncryptedKey"))==null?void 0:u[1];let o;return s?o="unlisted":x?o="private":o="public",{hash:e,visibility:o,key:t,encryptedKey:s,keyId:r,selfEncryptedKey:x}}function du(n){const e=zn(n);return e?{hash:e.hash,key:e.key}:null}function Kn(n){const{subscribe:e,publish:t,getPubkey:s,nip19:r}=n,x=new Map,o=new Map,i=Math.random().toString(36).slice(2,8),a=new Map;function d(l){const u=l.indexOf("/");if(u===-1)return null;const f=l.slice(0,u),h=l.slice(u+1);if(!h)return null;try{const B=r.decode(f);return B.type!=="npub"?null:{pubkey:B.data,treeName:h}}catch{return null}}return{async resolve(l){const u=d(l);if(!u)return null;const{pubkey:f,treeName:h}=u;return new Promise(B=>{let A=null,D=0;const v=e({kinds:[30078],authors:[f],"#d":[h],"#l":["hashtree"]},m=>{var F;if(((F=m.tags.find(g=>g[0]==="d"))==null?void 0:F[1])!==h)return;const E=du(m);E&&((m.created_at||0)>D&&(D=m.created_at||0,A=E),A&&(v(),B(Qe(we(A.hash),A.key?we(A.key):void 0))))})})},subscribe(l,u){var D;const f=d(l);if(!f)return u(null),()=>{};const{pubkey:h,treeName:B}=f;let A=x.get(l);if(A){if(A.callbacks.add(u),A.currentHash){const v=A.currentKey?we(A.currentKey):void 0;u(Qe(we(A.currentHash),v),A.currentVisibility??void 0)}}else{const v=e({kinds:[30078],authors:[h],"#d":[B],"#l":["hashtree"]},E=>{var S;if(((S=E.tags.find(P=>P[0]==="d"))==null?void 0:S[1])!==B)return;const g=x.get(l);if(!g)return;const p=zn(E);if(!p)return;const y=E.created_at||0,w=p.hash,_=p.key;if(y>=g.latestCreatedAt&&w&&w!==g.currentHash){g.currentHash=w,g.currentKey=_||null,g.latestCreatedAt=y;const P={visibility:p.visibility,encryptedKey:p.encryptedKey,keyId:p.keyId,selfEncryptedKey:p.selfEncryptedKey};g.currentVisibility=P;const I=_?we(_):void 0;for(const R of g.callbacks)try{R(Qe(we(w),I),P)}catch(z){console.error("Resolver callback error:",z)}}}),m=l.split("/")[0],C=(D=a.get(m))==null?void 0:D.get(B);if(A={unsubscribe:v,callbacks:new Set([u]),currentHash:(C==null?void 0:C.hash)??null,currentKey:(C==null?void 0:C.key)??null,currentVisibility:C?{visibility:C.visibility,encryptedKey:C.encryptedKey,keyId:C.keyId,selfEncryptedKey:C.selfEncryptedKey}:null,latestCreatedAt:(C==null?void 0:C.created_at)??0},x.set(l,A),C!=null&&C.hash){const E=C.key?we(C.key):void 0;u(Qe(we(C.hash),E),A.currentVisibility??void 0)}}return()=>{const v=x.get(l);v&&(v.callbacks.delete(u),v.callbacks.size===0&&(v.unsubscribe(),x.delete(l)))}},async publish(l,u,f,h=!1){const B=d(l);if(!B)return!1;const{treeName:A}=B;if(!s())return!1;const v=se(u.hash),m=u.key?se(u.key):void 0,C=Math.floor(Date.now()/1e3),E=l.split("/")[0];let F=a.get(E);F||(F=new Map,a.set(E,F)),F.set(A,{hash:v,visibility:(f==null?void 0:f.visibility)??"public",key:m,encryptedKey:f==null?void 0:f.encryptedKey,keyId:f==null?void 0:f.keyId,selfEncryptedKey:f==null?void 0:f.selfEncryptedKey,created_at:C});const g=x.get(l);if(g){g.currentHash=v,g.currentKey=m||null,g.latestCreatedAt=C,g.currentVisibility=f??null;for(const y of g.callbacks)try{y(u,f)}catch(w){console.error("Resolver callback error:",w)}}const p=o.get(E);if(p){const y=p.entriesByDTag.get(A),w=y&&!y.hash,_=y?C-y.created_at:0;if(w&&v&&_<30)console.log(`[publish:${i}] Blocked undelete of ${A}: timeDiff=${_}s`);else{p.entriesByDTag.set(A,{hash:v,visibility:(f==null?void 0:f.visibility)??"public",key:m,encryptedKey:f==null?void 0:f.encryptedKey,keyId:f==null?void 0:f.keyId,selfEncryptedKey:f==null?void 0:f.selfEncryptedKey,created_at:C});const S=[];for(const[P,I]of p.entriesByDTag)I.hash&&S.push({key:`${E}/${P}`,cid:Qe(we(I.hash),I.key?we(I.key):void 0),visibility:I.visibility,encryptedKey:I.encryptedKey,keyId:I.keyId,selfEncryptedKey:I.selfEncryptedKey,createdAt:I.created_at});console.log(`[publish:${i}] Emitting ${S.length} trees:`,S.map(P=>P.key.split("/")[1]));for(const P of p.callbacks)try{P(S)}catch(I){console.error("List callback error:",I)}}}if(!h){const y=[["d",A],["l","hashtree"],["hash",v]];m&&y.push(["key",m]),t({kind:30078,content:"",tags:y}).catch(w=>console.error("Failed to publish to nostr:",w))}return!0},list(l,u){const f=l.split("/");if(f.length===0)return u([]),()=>{};const h=f[0];let B;try{const F=r.decode(h);if(F.type!=="npub")return u([]),()=>{};B=F.data}catch{return u([]),()=>{}}const A=o.get(h);if(A){A.callbacks.add(u),console.log(`[list:${i}] Joining existing subscription, callbacks count now: ${A.callbacks.size}`);const F=[];for(const[g,p]of A.entriesByDTag){if(!p.hash){console.log(`[list join] Skipping entry with empty hash: ${g}`);continue}F.push({key:`${h}/${g}`,cid:Qe(we(p.hash),p.key?we(p.key):void 0),visibility:p.visibility,encryptedKey:p.encryptedKey,keyId:p.keyId,selfEncryptedKey:p.selfEncryptedKey,createdAt:p.created_at})}return console.log(`[join:${i}] Emitting ${F.length} trees:`,F.map(g=>g.key.split("/")[1])),u(F),()=>{A.callbacks.delete(u),A.callbacks.size===0&&(A.unsubscribe(),o.delete(h))}}console.log(`[list:${i}] Creating NEW subscription for ${h}`);const D=new Map,v=new Set([u]),m=a.get(h);if(m)for(const[F,g]of m)D.set(F,g);const C=()=>{const F=[];for(const[g,p]of D)p.hash&&F.push({key:`${h}/${g}`,cid:Qe(we(p.hash),p.key?we(p.key):void 0),visibility:p.visibility,encryptedKey:p.encryptedKey,keyId:p.keyId,selfEncryptedKey:p.selfEncryptedKey,createdAt:p.created_at});for(const g of v)try{g(F)}catch(p){console.error("List callback error:",p)}};D.size>0&&C();const E=e({kinds:[30078],authors:[B],"#l":["hashtree"]},F=>{var S;const g=(S=F.tags.find(P=>P[0]==="d"))==null?void 0:S[1];if(!g)return;const p=zn(F),y=!!(p!=null&&p.hash),w=D.get(g),_=F.created_at||0;if(g.includes("delete-test")&&console.log(`[event] ${g}: hasHash=${y}, eventTime=${_}, existing=${w?`hash=${!!w.hash},time=${w.created_at}`:"none"}`),w){const P=!w.hash,I=_-w.created_at;if(P&&y&&I<30||P&&y&&I===0||!(_>w.created_at||_===w.created_at&&!y&&w.hash))return}D.set(g,{hash:(p==null?void 0:p.hash)??"",visibility:(p==null?void 0:p.visibility)??"public",key:p==null?void 0:p.key,encryptedKey:p==null?void 0:p.encryptedKey,keyId:p==null?void 0:p.keyId,selfEncryptedKey:p==null?void 0:p.selfEncryptedKey,created_at:_}),C()});return o.set(h,{npub:h,entriesByDTag:D,callbacks:v,unsubscribe:E}),()=>{v.delete(u),v.size===0&&(E(),o.delete(h))}},stop(){for(const[,l]of x)l.unsubscribe();x.clear(),o.clear()},async delete(l){const u=d(l);if(!u)return!1;const{treeName:f}=u;if(!s())return!1;const B=Math.floor(Date.now()/1e3),A=l.split("/")[0];let D=a.get(A);D||(D=new Map,a.set(A,D)),D.set(f,{hash:"",visibility:"public",key:void 0,created_at:B});const v=x.get(l);if(v){v.currentHash=null,v.currentKey=null,v.latestCreatedAt=B,v.currentVisibility=null;for(const C of v.callbacks)try{C(null)}catch(E){console.error("Resolver callback error:",E)}}const m=o.get(A);if(m){m.entriesByDTag.set(f,{hash:"",visibility:"public",key:void 0,created_at:B});const C=[];for(const[E,F]of m.entriesByDTag)F.hash&&C.push({key:`${A}/${E}`,cid:Qe(we(F.hash),F.key?we(F.key):void 0),visibility:F.visibility,encryptedKey:F.encryptedKey,keyId:F.keyId,selfEncryptedKey:F.selfEncryptedKey,createdAt:F.created_at});for(const E of m.callbacks)try{E(C)}catch(F){console.error("List callback error:",F)}}return t({kind:30078,content:"",tags:[["d",f],["l","hashtree"]],created_at:B+1}).catch(C=>console.error("Failed to publish delete to nostr:",C)),!0},injectListEntry(l){const u=l.key.split("/");if(u.length!==2)return;const[f,h]=u,B=Math.floor(Date.now()/1e3),A=!!se(l.cid.hash);let D=a.get(f);D||(D=new Map,a.set(f,D));const v=D.get(h),m=v&&!v.hash,C=v?B-v.created_at:0;if(m&&A&&C<30){console.log(`[inject:${i}] Blocked cache undelete of ${h}: timeDiff=${C}s`);return}(!v||B>=v.created_at)&&D.set(h,{hash:se(l.cid.hash),visibility:l.visibility??"public",key:l.cid.key?se(l.cid.key):void 0,encryptedKey:l.encryptedKey,keyId:l.keyId,selfEncryptedKey:l.selfEncryptedKey,created_at:B});const E=o.get(f);if(E){const F=E.entriesByDTag.get(h),g=F&&!F.hash,p=F?B-F.created_at:0;if(g&&A&&p<30){console.log(`[inject:${i}] Blocked undelete of ${h}: timeDiff=${p}s`);return}if(!F||B>=F.created_at){console.log(`[inject:${i}] Updating ${h}: hasHash=${A}, existingWasDeleted=${g}, timeDiff=${p}`),E.entriesByDTag.set(h,{hash:se(l.cid.hash),visibility:l.visibility??"public",key:l.cid.key?se(l.cid.key):void 0,encryptedKey:l.encryptedKey,keyId:l.keyId,selfEncryptedKey:l.selfEncryptedKey,created_at:B});const y=[];for(const[w,_]of E.entriesByDTag)_.hash&&y.push({key:`${f}/${w}`,cid:Qe(we(_.hash),_.key?we(_.key):void 0),visibility:_.visibility,encryptedKey:_.encryptedKey,keyId:_.keyId,selfEncryptedKey:_.selfEncryptedKey,createdAt:_.created_at});for(const w of E.callbacks)try{w(y)}catch(_){console.error("List callback error:",_)}}}}}}const Bx=5e3;new TextEncoder;const no=new TextDecoder("utf-8"),Dt={HASH:0,PUBKEY:2,TREE_NAME:3,PATH:4,DECRYPT_KEY:5};function Qi(n){const e={};let t=0;for(;t<n.length;){if(t+2>n.length)throw new Error("TLV: unexpected end of data");const s=n[t],r=n[t+1];if(t+=2,t+r>n.length)throw new Error(`TLV: not enough data for type ${s}, need ${r} bytes`);const x=n.slice(t,t+r);t+=r,e[s]=e[s]||[],e[s].push(x)}return e}function fu(n){const e=[],t=Object.keys(n).map(Number).sort((s,r)=>s-r);for(const s of t){const r=n[s];for(const x of r){if(x.length>255)throw new Error(`TLV value too long for type ${s}: ${x.length} bytes`);const o=new Uint8Array(x.length+2);o[0]=s,o[1]=x.length,o.set(x,2),e.push(o)}}return vc(...e)}function Jr(n,e){const t=us.toWords(e);return us.encode(n,t,Bx)}function Ji(n){if(typeof n=="string"||n instanceof Uint8Array){const r=typeof n=="string"?Vr(n):n;if(r.length!==32)throw new Error(`Hash must be 32 bytes, got ${r.length}`);return Jr("nhash",r)}const e=Vr(n.hash);if(e.length!==32)throw new Error(`Hash must be 32 bytes, got ${e.length}`);if(!n.decryptKey)return Jr("nhash",e);const t={[Dt.HASH]:[e]},s=Vr(n.decryptKey);if(s.length!==32)throw new Error(`Decrypt key must be 32 bytes, got ${s.length}`);return t[Dt.DECRYPT_KEY]=[s],Jr("nhash",fu(t))}function Xi(n){var o,i;n.startsWith("hashtree:")&&(n=n.substring(9));const{prefix:e,words:t}=us.decode(n,Bx);if(e!=="nhash")throw new Error(`Expected nhash prefix, got ${e}`);const s=new Uint8Array(us.fromWords(t));if(s.length===32)return{hash:Ds(s)};const r=Qi(s);if(!((o=r[Dt.HASH])!=null&&o[0])||r[Dt.HASH][0].length!==32)throw new Error("nhash: missing or invalid hash");const x={hash:Ds(r[Dt.HASH][0])};if((i=r[Dt.DECRYPT_KEY])!=null&&i[0]){if(r[Dt.DECRYPT_KEY][0].length!==32)throw new Error("nhash: decrypt key must be 32 bytes");x.decryptKey=Ds(r[Dt.DECRYPT_KEY][0])}return x}function Zi(n){var o,i,a;n.startsWith("hashtree:")&&(n=n.substring(9));const{prefix:e,words:t}=us.decode(n,Bx);if(e!=="npath")throw new Error(`Expected npath prefix, got ${e}`);const s=new Uint8Array(us.fromWords(t)),r=Qi(s);if(!((o=r[Dt.PUBKEY])!=null&&o[0])||r[Dt.PUBKEY][0].length!==32)throw new Error("npath: missing or invalid pubkey");if(!((i=r[Dt.TREE_NAME])!=null&&i[0]))throw new Error("npath: missing tree name");const x={pubkey:Ds(r[Dt.PUBKEY][0]),treeName:no.decode(r[Dt.TREE_NAME][0]),path:r[Dt.PATH]?r[Dt.PATH].map(d=>no.decode(d)):[]};if((a=r[Dt.DECRYPT_KEY])!=null&&a[0]){if(r[Dt.DECRYPT_KEY][0].length!==32)throw new Error("npath: decrypt key must be 32 bytes");x.decryptKey=Ds(r[Dt.DECRYPT_KEY][0])}return x}function Cx(n){return/^nhash1[a-z\d]+$/.test(n||"")}function px(n){return/^npath1[a-z\d]+$/.test(n||"")}function ea(){return crypto.getRandomValues(new Uint8Array(32))}async function ta(n){return(await ot(n)).slice(0,8)}async function sa(n,e){const t=new ArrayBuffer(e.length);new Uint8Array(t).set(e);const s=new ArrayBuffer(n.length);new Uint8Array(s).set(n);const r=await crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt"]),x=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:x},r,s),i=new Uint8Array(12+o.byteLength);return i.set(x),i.set(new Uint8Array(o),12),i}async function ra(n,e){try{const t=new ArrayBuffer(e.length);new Uint8Array(t).set(e);const s=n.slice(0,12),r=n.slice(12),x=new ArrayBuffer(r.length);new Uint8Array(x).set(r);const o=await crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["decrypt"]),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},o,x);return new Uint8Array(i)}catch{return null}}const ls={generateLinkKey(){return se(ea())},async computeKeyId(n){const e=await ta(we(n));return se(e)},async encryptKeyForLink(n,e){const t=await sa(we(n),we(e));return se(t)},async decryptKeyFromLink(n,e){const t=await ra(we(n),we(e));return t?se(t):null}},hu=Object.freeze(Object.defineProperty({__proto__:null,BlossomStore:ix,DEFAULT_CHUNK_SIZE:Vi,DEFAULT_MAX_LINKS:Gi,DEFAULT_RELAYS:Wi,HashTree:hx,LinkType:te,OpfsStore:Mi,Peer:Nn,PeerId:cs,StreamWriter:Ii,WebRTCStore:Yi,cid:Qe,computeKeyId:ta,contentHash:wi,createNostrRefResolver:Kn,createNostrRootResolver:Kn,decodeTreeNode:J0,decryptChk:k0,decryptKeyFromLink:ra,encodeAndHash:y0,encodeTreeNode:Pi,encryptChk:o0,encryptKeyForLink:sa,fromHex:we,generateLinkKey:ea,generateUuid:Ex,getNodeType:Ti,isNHash:Cx,isNPath:px,nhashDecode:Xi,nhashEncode:Ji,npathDecode:Zi,sha256:ot,toHex:se,tryDecodeTreeNode:dt,visibilityHex:ls},Symbol.toStringTag,{value:"Module"}));var Eu=Object.defineProperty,Bu=(n,e,t)=>e in n?Eu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Rt=(n,e,t)=>Bu(n,typeof e!="symbol"?e+"":e,t);class xo{constructor(){Rt(this,"strToUniqueId",new Map),Rt(this,"uniqueIdToStr",new Map),Rt(this,"currentUniqueId",0)}id(e){if(!e||e.trim()==="")throw new Error("Cannot store empty or whitespace-only strings");const t=this.strToUniqueId.get(e);if(t!==void 0)return t;const s=this.currentUniqueId++;return this.strToUniqueId.set(e,s),this.uniqueIdToStr.set(s,e),s}str(e){const t=this.uniqueIdToStr.get(e);if(!t)throw new Error("pub: invalid id "+e);return t}has(e){return this.strToUniqueId.has(e)}*[Symbol.iterator](){yield*this.uniqueIdToStr.entries()}remove(e){const t=this.uniqueIdToStr.get(e);t!==void 0&&(this.uniqueIdToStr.delete(e),this.strToUniqueId.delete(t))}}const oo=/^[0-9a-fA-F]{64}$/,Cu=2;function pu(n,e,t,s,r){const x=new Set,o=new Map,i=new Map,{followedByUser:a,mutedByUser:d}=n.getInternalData(),l=n.usersByFollowDistance,u=Array.from(l.keys()).sort((m,C)=>m-C),f=s!==void 0?u.filter(m=>m<=s):u,h=[];for(const m of f){const C=l.get(m);if(C)for(const E of C){let F=0;const g=a.get(E);if(g)for(const y of g)(!r||F<r)&&(h.push({owner:E,target:y,isFollow:!0,distance:m}),F++);const p=d.get(E);if(p)for(const y of p)(!r||F<r)&&(h.push({owner:E,target:y,isFollow:!1,distance:m}),F++)}}let B=0;const{str:A}=n.getInternalData();for(const m of h){if(t&&B>=t)break;try{A(m.owner),A(m.target)}catch{console.warn(`Skipping edge with invalid ID: owner=${m.owner}, target=${m.target}`);continue}if(e){const E=!x.has(m.owner),F=!x.has(m.target),g=(E?1:0)+(F?1:0);if(x.size+g>e)break}x.add(m.owner),x.add(m.target),B++;const C=m.isFollow?o:i;C.set(m.owner,(C.get(m.owner)??0)+1)}const D=Array.from(o.keys()),v=Array.from(i.keys());return{usedIds:x,followEdgeCount:o,muteEdgeCount:i,followOwners:D,muteOwners:v}}function gu(n){return n.getInternalData()}function Au(n){if(!/^[0-9a-fA-F]+$/.test(n))throw new Error(`Invalid hex string: ${n}`);if(n.length%2!==0)throw new Error(`Hex string must have even length: ${n}`);const e=new Uint8Array(n.length/2);for(let t=0;t<n.length;t+=2)e[t/2]=parseInt(n.substr(t,2),16);return e}function Fu(n){return Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join("")}function Gt(n,e){let t=0,s=0,r=0;for(let x=e;x<n.length;x++){const o=n[x];if(t|=(o&127)<<s,r++,(o&128)===0)break;s+=7}return{value:t,bytesRead:r}}async function*na(n,e,t,s,r){const x=gu(n);let o,i,a,d,l;if(e!==void 0||t!==void 0||s!==void 0||r!==void 0){const C=pu(n,e,t,s,r);o=C.usedIds,i=C.followEdgeCount,a=C.muteEdgeCount,d=C.followOwners,l=C.muteOwners}else{o=new Set,i=new Map,a=new Map;for(const[C,E]of x.followedByUser.entries()){o.add(C),i.set(C,E.size);for(const F of E)o.add(F)}for(const[C,E]of x.mutedByUser.entries()){o.add(C),a.set(C,E.size);for(const F of E)o.add(F)}d=Array.from(i.keys()),l=Array.from(a.keys())}const u=16*1024;let f=new Uint8Array(u),h=0;const B=[],A=()=>{h!==0&&(B.push(f.subarray(0,h)),f=new Uint8Array(u),h=0)},D=C=>{h>=f.length&&A(),f[h++]=C},v=C=>{let E=0;for(;E<C.length;){const F=f.length-h;if(F===0){A();continue}const g=Math.min(F,C.length-E);f.set(C.subarray(E,E+g),h),h+=g,E+=g}},m=C=>{let E=C>>>0;for(;E>=128;)D(E&127|128),E>>>=7;D(E&127)};m(Cu),m(o.size);for(const C of o)v(Au(x.ids.str(C))),m(C);m(d.length);for(const C of d){const E=x.followListCreatedAt.get(C)??0,F=i.get(C);m(C),m(E),m(F);let g=0;const p=x.followedByUser.get(C)||new Set;for(const y of p){if(g>=F)break;m(y),g++}}m(l.length);for(const C of l){const E=x.muteListCreatedAt.get(C)??0,F=a.get(C);m(C),m(E),m(F);let g=0;const p=x.mutedByUser.get(C)||new Set;for(const y of p){if(g>=F)break;m(y),g++}}A();for(const C of B)yield C}async function vu(n,e,t,s,r){const x=[];let o=0;for await(const d of na(n,e,t,s,r))x.push(d),o+=d.length;const i=new Uint8Array(o);let a=0;for(const d of x)i.set(d,a),a+=d.length;return i}async function xa(n,e){var t;let s=0;const r=Gt(e,s);s+=r.bytesRead;const x=Gt(e,s);s+=x.bytesRead;const o=[];for(let h=0;h<x.value;h++){const B=e.slice(s,s+32);s+=32;const A=Fu(B),D=Gt(e,s);s+=D.bytesRead,o.push([A,D.value])}const i=Gt(e,s);s+=i.bytesRead;const a=[];for(let h=0;h<i.value;h++){const B=Gt(e,s);s+=B.bytesRead;const A=Gt(e,s);s+=A.bytesRead;const D=Gt(e,s);s+=D.bytesRead;const v=[];for(let m=0;m<D.value;m++){const C=Gt(e,s);s+=C.bytesRead,v.push(C.value)}a.push([B.value,v,A.value])}const d=Gt(e,s);s+=d.bytesRead;const l=[];for(let h=0;h<d.value;h++){const B=Gt(e,s);s+=B.bytesRead;const A=Gt(e,s);s+=A.bytesRead;const D=Gt(e,s);s+=D.bytesRead;const v=[];for(let m=0;m<D.value;m++){const C=Gt(e,s);s+=C.bytesRead,v.push(C.value)}l.push([B.value,v,A.value])}const u=new gx(n),f=u;f.ids.uniqueIdToStr.clear(),f.ids.strToUniqueId.clear(),f.ids.currentUniqueId=0;for(const[h,B]of o)f.ids.uniqueIdToStr.set(B,h),f.ids.strToUniqueId.set(h,B),f.ids.currentUniqueId=Math.max(f.ids.currentUniqueId,B+1);if(f.ids.strToUniqueId.has(n))f.root=f.ids.strToUniqueId.get(n);else{const h=f.ids.id(n);f.root=h}f.followDistanceByUser.clear(),f.usersByFollowDistance.clear(),f.followDistanceByUser.set(f.root,0),f.usersByFollowDistance.set(0,new Set([f.root]));for(const[h,B,A]of a){for(const D of B)f.privateAddFollower(D,h);f.followListCreatedAt.set(h,A??0)}for(const[h,B,A]of l){f.mutedByUser.set(h,new Set(B));for(const D of B)f.userMutedBy.has(D)||f.userMutedBy.set(D,new Set),(t=f.userMutedBy.get(D))==null||t.add(h);f.muteListCreatedAt.set(h,A??0)}return u}async function yu(n,e){const t=e.getReader(),s=[];let r=0;try{for(;;){const{done:i,value:a}=await t.read();if(i)break;s.push(a),r+=a.length}}finally{t.releaseLock()}const x=new Uint8Array(r);let o=0;for(const i of s)x.set(i,o),o+=i.length;return await xa(n,x)}class u0{static removeMutedNotFollowedUsers(e,t=1e4,s=()=>{}){console.time("removeMutedNotFollowedUsers");let r="";return new Promise(x=>{const{followedByUser:o,userMutedBy:i}=e.getInternalData(),a=new Set,d=Array.from(o.entries());let l=0;s("Building follower counts",0,0),console.log("Building follower index..."),console.time("Building follower index"),r="building";const u=()=>{const v=Math.min(l+t,d.length);for(let m=l;m<v;m++){const[,C]=d[m];for(const E of C)a.add(E)}l=v,l<d.length?setTimeout(u,0):A()},f=[],h=Array.from(i.entries());let B=0;const A=()=>{const v=Math.min(B+t,h.length);for(let m=B;m<v;m++){const[C,E]=h[m];E.size>0&&!a.has(C)&&f.push(C)}B=v,(B%(t*10)===0||B===v)&&(r!=="scanning"&&(console.timeEnd("Building follower index"),console.time("Scanning muted users"),r="scanning"),console.log(`Scanned ${B.toLocaleString()} muted users, found ${f.length.toLocaleString()} to remove`),s("Scanning muted users",B,f.length)),B<h.length?setTimeout(A,0):(console.timeEnd("Scanning muted users"),console.time("Removing users"),r="removing",s("Removing users",B,f.length),D())},D=()=>{if(f.length===0){console.timeEnd("Removing users"),console.log(" Cleanup complete: removed 0 muted users with zero followers"),s("Cleanup complete",h.length,0),console.timeEnd("removeMutedNotFollowedUsers"),x(0);return}console.log(`Batch removing ${f.length.toLocaleString()} users...`),u0.batchRemoveUsers(e,f),console.timeEnd("Removing users"),console.log(` Cleanup complete: removed ${f.length.toLocaleString()} muted users with zero followers`),s("Cleanup complete",h.length,f.length),console.timeEnd("removeMutedNotFollowedUsers"),x(f.length)};setTimeout(u,0)})}static batchRemoveUsers(e,t){var s;const{ids:r}=e.getInternalData(),x=e,o=new Map;for(const i of t)o.set(i,{followedUsers:x.followedByUser.get(i)||new Set,mutedUsers:x.mutedByUser.get(i)||new Set,userMuters:x.userMutedBy.get(i)||new Set,followDistance:x.followDistanceByUser.get(i)});for(const i of t){const a=o.get(i);r.remove(i),a.followDistance!==void 0&&((s=x.usersByFollowDistance.get(a.followDistance))==null||s.delete(i)),x.followDistanceByUser.delete(i),x.followedByUser.delete(i),x.followersByUser.delete(i),x.followListCreatedAt.delete(i),x.mutedByUser.delete(i),x.userMutedBy.delete(i),x.muteListCreatedAt.delete(i)}for(const[,i]of x.followedByUser)for(const a of t)i.delete(a);for(const[,i]of x.followersByUser)for(const a of t)i.delete(a);for(const i of t){const a=o.get(i);for(const d of a.userMuters){const l=x.mutedByUser.get(d);l&&l.delete(i)}for(const d of a.mutedUsers){const l=x.userMutedBy.get(d);l&&l.delete(i)}}}static removeUserById(e,t){u0.batchRemoveUsers(e,[t])}static stats(e,t){const s={},r=e,x=r.id(t),o=u0.getFollowersSet(e,x);for(const i of o){const a=r.followDistanceByUser.get(i);a!==void 0&&(s[a]||(s[a]={followers:0,muters:0}),s[a].followers++)}for(const i of r.userMutedBy.get(x)||[]){const a=r.followDistanceByUser.get(i);a!==void 0&&(s[a]||(s[a]={followers:0,muters:0}),s[a].muters++)}return s}static getFollowersSet(e,t){const{followersByUser:s}=e.getInternalData();return s.get(t)||new Set}static hasFollowers(e,t){const s=e.id(t),{followersByUser:r}=e.getInternalData(),x=r.get(s);return x?x.size>0:!1}static isOvermuted(e,t,s=1){if(t===e.getRoot())return!1;const r=e,x=r.id(t),{followersByUser:o,userMutedBy:i}=e.getInternalData(),a=i.get(x);if(!a||a.size===0)return!1;const d=new Map,l=o.get(x);if(l)for(const f of l){const h=r.followDistanceByUser.get(f);h!==void 0&&(d.has(h)||d.set(h,{followers:0,muters:0}),d.get(h).followers++)}for(const f of a){const h=r.followDistanceByUser.get(f);h!==void 0&&(d.has(h)||d.set(h,{followers:0,muters:0}),d.get(h).muters++)}const u=Array.from(d.keys()).sort((f,h)=>f-h);for(const f of u){const{followers:h,muters:B}=d.get(f);if(h+B>0)return B*s>h}return!1}static async pruneOvermutedUsers(e,t=1,s=()=>{}){console.time("pruneOvermutedUsers");let r=0;const x=e;let o=1,i=!0;for(;i;){const a=x.usersByFollowDistance.get(o);if(!a||a.size===0){i=!1;continue}console.log(`Processing distance ${o} (${a.size.toLocaleString()} users)...`);const d=[];for(const l of a){const u=x.str(l);u0.isOvermuted(e,u,t)&&d.push(l)}if(s(o,a.size,d.length),d.length>0&&(console.log(`  Removing ${d.length.toLocaleString()} overmuted users at distance ${o}`),u0.batchRemoveUsers(e,d),r+=d.length),o++,o>20){console.warn("Stopping pruning at distance 20 to prevent infinite loop");break}}return console.timeEnd("pruneOvermutedUsers"),console.log(` Pruning complete: removed ${r.toLocaleString()} overmuted users total`),e.recalculateFollowDistances(),r}}class gx{constructor(e){Rt(this,"root"),Rt(this,"recalculatingPromise",null),Rt(this,"followDistanceByUser",new Map),Rt(this,"usersByFollowDistance",new Map),Rt(this,"followedByUser",new Map),Rt(this,"followersByUser",new Map),Rt(this,"followListCreatedAt",new Map),Rt(this,"mutedByUser",new Map),Rt(this,"userMutedBy",new Map),Rt(this,"muteListCreatedAt",new Map),Rt(this,"ids",new xo),Rt(this,"isRecalculating",!1),this.ids=new xo,this.root=this.id(e),this.followDistanceByUser.set(this.root,0),this.usersByFollowDistance.set(0,new Set([this.root]))}id(e){return this.ids.id(e)}str(e){return this.ids.str(e)}getRoot(){return this.str(this.root)}getInternalData(){return{followedByUser:this.followedByUser,followersByUser:this.followersByUser,mutedByUser:this.mutedByUser,userMutedBy:this.userMutedBy,followListCreatedAt:this.followListCreatedAt,muteListCreatedAt:this.muteListCreatedAt,ids:this.ids,str:e=>this.str(e)}}setRoot(e){const t=this.id(e);return t===this.root?Promise.resolve():(this.root=t,this.isRecalculating&&this.recalculatingPromise?this.recalculatingPromise.then(()=>this.recalculateFollowDistances()):this.recalculateFollowDistances())}recalculateFollowDistances(e=1e3,t=1e5,s=console.log){return this.isRecalculating?this.recalculatingPromise.then(()=>this.recalculateFollowDistances(e,t,s)):(this.isRecalculating=!0,this.recalculatingPromise=new Promise(r=>{var x;const o=this.root,i=this.followDistanceByUser,a=this.usersByFollowDistance,d=this.followedByUser;i.clear(),a.clear(),i.set(o,0),a.set(0,new Set([o]));const l=[o];let u=0,f=0;const h=((x=performance.now)==null?void 0:x.call(performance))??Date.now();s(`recalculateFollowDistances: start (batchSize=${e})`);const B=()=>{var A;const D=Math.min(u+e,l.length);for(;u<D;u++){const v=l[u],m=i.get(v),C=d.get(v);if(!C)continue;const E=m+1;for(const F of C)if(!i.has(F)){i.set(F,E);let g=a.get(E);g||(g=new Set,a.set(E,g)),g.add(F),l.push(F)}}if(f=u,f>0&&f%t<e&&s(`recalculateFollowDistances: ${f} processed, ${l.length-u} remaining`),u<l.length)setTimeout(B,0);else{const v=(((A=performance.now)==null?void 0:A.call(performance))??Date.now())-h;s(`recalculateFollowDistances: done (${f} users) in ${v.toFixed(1)}ms`),this.isRecalculating=!1,this.recalculatingPromise=null,r()}};B()}),this.recalculatingPromise)}handleEvent(e,t=!1,s=1){const r=(Array.isArray(e)?e:[e]).filter(x=>[3,1e4].includes(x.kind));for(const x of r){const o=x.created_at;if(o>Math.floor(Date.now()/1e3)+600){console.debug("event.created_at more than 10 minutes in the future",x);continue}const i=this.id(x.pubkey);!t&&!this.followDistanceByUser.has(i)||u0.isOvermuted(this,x.pubkey,s)||(x.kind===3?this.handleFollowList(x,i,o):x.kind===1e4&&this.handleMuteList(x,i,o))}}handleFollowList(e,t,s){const r=this.followListCreatedAt.get(t);if(r&&s<=r)return;this.followListCreatedAt.set(t,s);const x=new Set;for(const i of e.tags)if(i[0]==="p"){if(!oo.test(i[1]))continue;const a=this.id(i[1]);a!==t&&x.add(a)}const o=this.followedByUser.get(t)||new Set;for(const i of o)x.has(i)||this.privateRemoveFollower(i,t);for(const i of x)this.privateAddFollower(i,t)}handleMuteList(e,t,s){var r,x,o,i;const a=this.muteListCreatedAt.get(t);if(a&&s<=a)return;this.muteListCreatedAt.set(t,s);const d=new Set;for(const u of e.tags)if(u[0]==="p"){if(!oo.test(u[1]))continue;const f=this.id(u[1]);f!==t&&d.add(f)}const l=this.mutedByUser.get(t)||new Set;for(const u of l)d.has(u)||((r=this.mutedByUser.get(t))==null||r.delete(u),(x=this.userMutedBy.get(u))==null||x.delete(t));for(const u of d)this.mutedByUser.has(t)||this.mutedByUser.set(t,new Set),(o=this.mutedByUser.get(t))==null||o.add(u),this.userMutedBy.has(u)||this.userMutedBy.set(u,new Set),(i=this.userMutedBy.get(u))==null||i.add(t)}isFollowing(e,t){var s;const r=this.id(t),x=this.id(e);return!!((s=this.followedByUser.get(x))!=null&&s.has(r))}getFollowDistance(e){const t=this.followDistanceByUser.get(this.id(e));return t===void 0?1e3:t}addUserByFollowDistance(e,t){var s,r;this.usersByFollowDistance.has(e)||this.usersByFollowDistance.set(e,new Set),(s=this.usersByFollowDistance.get(e))==null||s.add(t);for(const x of this.usersByFollowDistance.keys())x>e&&((r=this.usersByFollowDistance.get(x))==null||r.delete(t))}privateAddFollower(e,t){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid user id");if(this.followedByUser.has(t)||this.followedByUser.set(t,new Set),this.followedByUser.get(t).add(e),this.followersByUser.has(e)||this.followersByUser.set(e,new Set),this.followersByUser.get(e).add(t),e!==this.root){let s;if(t===this.root)s=1,this.addUserByFollowDistance(s,e),this.followDistanceByUser.set(e,s);else{const r=this.followDistanceByUser.get(e),x=this.followDistanceByUser.get(t);s=x&&x+1,(r===void 0||s&&s<r)&&(this.followDistanceByUser.set(e,s),this.addUserByFollowDistance(s,e))}}}addFollower(e,t){this.privateAddFollower(this.id(t),this.id(e))}removeFollower(e,t){this.privateRemoveFollower(this.id(t),this.id(e))}privateRemoveFollower(e,t){var s,r;if((s=this.followedByUser.get(t))==null||s.delete(e),(r=this.followersByUser.get(e))==null||r.delete(t),e===this.root)return;let x=1/0;for(const o of this.getFollowersSet(e)){const i=this.followDistanceByUser.get(o);i!==void 0&&i+1<x&&(x=i+1)}x===1/0?this.followDistanceByUser.delete(e):this.followDistanceByUser.set(e,x)}followerCount(e){const t=this.id(e);return this.getFollowersSet(t).size}followedByFriendsCount(e){var t;let s=0;const r=this.id(e);for(const x of this.getFollowersSet(r))(t=this.followedByUser.get(this.root))!=null&&t.has(x)&&s++;return s}mutedByFriendsCount(e){var t;let s=0;const r=this.id(e);for(const x of this.userMutedBy.get(r)??[])(t=this.followedByUser.get(this.root))!=null&&t.has(x)&&s++;return s}size(){var e;let t=0,s=0;const r={};for(const x of this.followedByUser.values())t+=x.size;for(const x of this.mutedByUser.values())s+=x.size;for(const[x,o]of this.usersByFollowDistance.entries())r[x]=o.size;return{users:this.followDistanceByUser.size||((e=this.ids.uniqueIdToStr)==null?void 0:e.size)||0,follows:t,mutes:s,sizeByDistance:r}}followedByFriends(e){var t;const s=this.id(e),r=new Set;for(const x of this.getFollowersSet(s))(t=this.followedByUser.get(this.root))!=null&&t.has(x)&&r.add(this.str(x));return r}getFollowedByUser(e,t=!1){const s=this.id(e),r=new Set;for(const x of this.followedByUser.get(s)||[])r.add(this.str(x));return t&&r.add(e),r}getFollowersByUser(e){const t=this.id(e),s=new Set;for(const r of this.getFollowersSet(t))s.add(this.str(r));return s}getUsersByFollowDistance(e){const t=this.usersByFollowDistance.get(e)||new Set,s=new Set;for(const r of t)s.add(this.str(r));return s}getFollowListCreatedAt(e){return this.followListCreatedAt.get(this.id(e))}merge(e){return new Promise(t=>{console.log("size before merge",this.size()),console.time("merge graph");const s=Array.from(e);let r=0;const x=()=>{if(r>=s.length){this.recalculateFollowDistances().then(()=>{console.timeEnd("merge graph"),console.log("size after merge",this.size()),t()});return}const o=s[r];this.mergeUserLists(o,this.followListCreatedAt,e.followListCreatedAt,this.followedByUser,e.followedByUser),this.mergeUserLists(o,this.muteListCreatedAt,e.muteListCreatedAt,this.mutedByUser,e.mutedByUser),r++,setTimeout(x,0)};setTimeout(x,0)})}mergeUserLists(e,t,s,r,x){const o=this.id(e),i=t.get(o),a=s.get(o);if(!i||a&&i<a){const d=x.get(o)||new Set,l=r.get(o)||new Set;for(const u of d)l.has(u)||(r.has(o)||r.set(o,new Set),r.get(o).add(u));for(const u of l)d.has(u)||r.get(o).delete(u);t.set(o,a??0)}}*userIterator(e){const t=Array.from(this.usersByFollowDistance.keys()).sort((s,r)=>s-r);for(const s of t){if(e!==void 0&&s>e)break;const r=this.usersByFollowDistance.get(s)||new Set;for(const x of r)yield this.str(x)}}[Symbol.iterator](){return this.userIterator()}getMutedByUser(e){const t=this.id(e),s=new Set;for(const r of this.mutedByUser.get(t)||[])s.add(this.str(r));return s}getUserMutedBy(e){const t=this.id(e),s=new Set;for(const r of this.userMutedBy.get(t)||[])s.add(this.str(r));return s}stats(e){return u0.stats(this,e)}removeMutedNotFollowedUsers(e=1e4,t=()=>{}){return u0.removeMutedNotFollowedUsers(this,e,t)}toBinaryChunks(e,t,s,r){return na(this,e,t,s,r)}toBinary(e,t,s,r){return vu(this,e,t,s,r)}static fromBinary(e,t){return xa(e,t)}static fromBinaryStream(e,t){return yu(e,t)}getFollowersSet(e){return u0.getFollowersSet(this,e)}}const Ax="4523be58d395b1b196a9b8c82b038b6895cb02b683d0c253a955068dba1facd0",Dr=3,Du=2,mu=!1,V0=(...n)=>mu;class wu extends yr{constructor(){super("hashtree-social-graph");q(this,"socialGraph");this.version(1).stores({socialGraph:"&key"})}}const $n=new wu;let De,lr=!1,tr=null;new Promise(n=>{tr=n});function bu(){const{subscribe:n,update:e}=Je({version:0,isRecrawling:!1});return{subscribe:n,incrementVersion:()=>{e(t=>({...t,version:t.version+1}))},setIsRecrawling:t=>{e(s=>({...s,isRecrawling:t}))},getState:()=>Ge(D0)}}const D0=bu();function hs(){D0.incrementVersion()}async function ku(n){try{const e=await $n.socialGraph.get("main");if(e!=null&&e.data){const t=await gx.fromBinary(n,e.data);return V0("loaded from dexie, size:",t.size()),t}}catch(e){console.error("[socialGraph] error loading from dexie:",e),await $n.socialGraph.delete("main")}return null}let Xr=null;const _u=15e3;let Qs=null;const Su=5e3;function Pu(){Qs&&clearTimeout(Qs),Qs=setTimeout(async()=>{Qs=null,!(!lr||!De)&&(await De.recalculateFollowDistances(),hs())},Su)}function oa(){Xr||(Xr=setTimeout(async()=>{if(Xr=null,!(!lr||!De))try{const n=await De.toBinary();await $n.socialGraph.put({key:"main",data:n,updatedAt:Date.now()}),V0("saved to dexie, size:",De.size())}catch(n){console.error("[socialGraph] error saving to dexie:",n)}},_u))}async function Tu(n=Ax){if(lr){De.setRoot(n),hs();return}lr=!0;const e=await ku(n);e?De=e:De=new gx(n),hs()}async function Mu(){const n=Ge(ce).pubkey;await Tu(n||void 0),n||De.setRoot(Ax),tr==null||tr(!0)}function Fx(n){if(!De)return;De.handleEvent(n),oa(),(Array.isArray(n)?n:[n]).some(s=>s.kind===Dr)&&Pu()}function Iu(){return De}let Fs=null;async function Ru(n){const e=await ye.fetchEvents({kinds:[Dr],authors:[n],limit:1});for(const t of e)Fx(t.rawEvent());await De.recalculateFollowDistances(),hs()}async function io(n,e=Du){if(!(e<=0)){D0.setIsRecrawling(!0);try{const t=new Set,s=De.getFollowedByUser(n);for(const r of s)De.getFollowedByUser(r).size===0&&t.add(r);if(t.size===0?V0("no missing follow lists at depth 1"):(V0("fetching",t.size,"follow lists at depth 1"),await ao(Array.from(t))),e>=2){const r=new Set;for(const x of s){const o=De.getFollowedByUser(x);for(const i of o)De.getFollowedByUser(i).size===0&&!t.has(i)&&r.add(i)}if(r.size>0){V0("fetching",r.size,"follow lists at depth 2");const x=Array.from(r).slice(0,500);await ao(x)}}await De.recalculateFollowDistances(),hs(),oa()}finally{D0.setIsRecrawling(!1)}}}async function ao(n){if(n.length===0)return;const e=100,t=500;for(let s=0;s<n.length;s+=e){const r=n.slice(s,s+e);V0("fetching batch",s/e+1,"of",Math.ceil(n.length/e));try{const x=await ye.fetchEvents({kinds:[Dr],authors:r}),o=[];for(const i of x)o.push(i.rawEvent());o.length>0&&De.handleEvent(o),s+e<n.length&&await new Promise(i=>setTimeout(i,t))}catch(x){console.error("[socialGraph] error fetching batch:",x)}}}async function co(n){De.setRoot(n),await Ru(n),queueMicrotask(()=>io(n)),Fs==null||Fs.stop(),Fs=ye.subscribe({kinds:[Dr],authors:[n],limit:1},{closeOnEose:!1});let e=0;Fs.on("event",t=>{typeof t.created_at!="number"||t.created_at<e||(e=t.created_at,Fx(t.rawEvent()),queueMicrotask(()=>io(n,1)))})}async function Uu(){const n=Ge(ce).pubkey;n&&await co(n);let e=n;ce.subscribe(t=>{V0("nostrStore changed, pubkey:",t.pubkey,"prev:",e),t.pubkey!==e&&(t.pubkey?co(t.pubkey):(De.setRoot(Ax),hs()),e=t.pubkey)})}function Lu(n){return!n||!De?1e3:De.getFollowDistance(n)}function Nu(n){return!n||!De?new Set:De.followedByFriends(n)}function zu(n){const e=Ge(ce).pubkey;return!n||!e||!De?!1:De.isFollowing(n,e)}function Ku(n){return!n||!De?new Set:De.getFollowersByUser(n)}function ia(n){return!n||!De?new Set:De.getFollowedByUser(n)}function $u(){if(!De)return 0;const n=De.size();return typeof n=="object"&&n!==null?n.users:0}const aa=Lu,ca=Nu,Ou=ia;queueMicrotask(()=>{Mu().then(()=>Uu()).then(()=>{}).catch(n=>{console.error("[socialGraph] initialization error:",n)})});const P0={followsMax:20,followsSatisfied:10,otherMax:10,otherSatisfied:5},la={gitignoreBehavior:"ask"},ua={autoSave:!0},A0={enabled:!0,storageCap:2*1024*1024*1024,ownQuotaPercent:50,syncFollowedPublic:!0,syncVisitedUnlisted:!0},Ut={relays:["wss://relay.damus.io","wss://relay.primal.net","wss://nos.lol","wss://relay.nostr.band","wss://relay.snort.social","wss://temp.iris.to"],blossomServers:[{url:"https://files.iris.to",read:!0,write:!1},{url:"https://hashtree.iris.to",read:!1,write:!0}],negentropyEnabled:!1};class Hu extends yr{constructor(){super("hashtree-settings");q(this,"settings");this.version(1).stores({settings:"&key"})}}const Yt=new Hu;function ju(){const{subscribe:n,update:e}=Je({appearance:{},content:{},imgproxy:{},notifications:{},desktop:{},debug:{},legal:{},pools:P0,poolsLoaded:!1,upload:la,editor:ua,sync:A0,network:Ut,networkLoaded:!1});return{subscribe:n,setPoolSettings:t=>{e(s=>{const r={...s.pools,...t};return Yt.settings.put({key:"pools",value:r}).catch(console.error),{...s,pools:r}})},resetPoolSettings:()=>{e(t=>(Yt.settings.put({key:"pools",value:P0}).catch(console.error),{...t,pools:P0}))},setUploadSettings:t=>{e(s=>{const r={...s.upload,...t};return Yt.settings.put({key:"upload",value:r}).catch(console.error),{...s,upload:r}})},setEditorSettings:t=>{e(s=>{const r={...s.editor,...t};return Yt.settings.put({key:"editor",value:r}).catch(console.error),{...s,editor:r}})},setSyncSettings:t=>{e(s=>{const r={...s.sync,...t};return Yt.settings.put({key:"sync",value:r}).catch(console.error),{...s,sync:r}})},resetSyncSettings:()=>{e(t=>(Yt.settings.put({key:"sync",value:A0}).catch(console.error),{...t,sync:A0}))},setNetworkSettings:t=>{e(s=>{const r={...s.network,...t};return Yt.settings.put({key:"network",value:r}).catch(console.error),{...s,network:r}})},resetNetworkSettings:()=>{e(t=>(Yt.settings.put({key:"network",value:Ut}).catch(console.error),{...t,network:Ut}))},getState:()=>Ge(Le),setState:t=>{e(s=>({...s,...t}))}}}const Le=ju();async function qu(){try{const[n,e,t,s,r]=await Promise.all([Yt.settings.get("pools"),Yt.settings.get("upload"),Yt.settings.get("editor"),Yt.settings.get("sync"),Yt.settings.get("network")]),x={poolsLoaded:!0,networkLoaded:!0};if(n!=null&&n.value){const o=n.value;x.pools={followsMax:o.followsMax??P0.followsMax,followsSatisfied:o.followsSatisfied??P0.followsSatisfied,otherMax:o.otherMax??P0.otherMax,otherSatisfied:o.otherSatisfied??P0.otherSatisfied}}if(e!=null&&e.value){const o=e.value;x.upload={gitignoreBehavior:o.gitignoreBehavior??la.gitignoreBehavior}}if(t!=null&&t.value){const o=t.value;x.editor={autoSave:o.autoSave??ua.autoSave}}if(s!=null&&s.value){const o=s.value;x.sync={enabled:o.enabled??A0.enabled,storageCap:o.storageCap??A0.storageCap,ownQuotaPercent:o.ownQuotaPercent??A0.ownQuotaPercent,syncFollowedPublic:o.syncFollowedPublic??A0.syncFollowedPublic,syncVisitedUnlisted:o.syncVisitedUnlisted??A0.syncVisitedUnlisted}}if(r!=null&&r.value){const o=r.value;let i=Ut.blossomServers;o.blossomServers&&Array.isArray(o.blossomServers)&&(i=o.blossomServers.map(a=>typeof a=="string"?{url:a,read:!0,write:!1}:{...a,read:a.read??!0})),x.network={relays:o.relays??Ut.relays,blossomServers:i,negentropyEnabled:o.negentropyEnabled??Ut.negentropyEnabled}}Le.setState(x)}catch(n){console.error("[settings] error loading:",n),Le.setState({poolsLoaded:!0,networkLoaded:!0})}}qu();const Vu=50;function Gu(){const{subscribe:n,update:e}=Je([]);return{subscribe:n,add:t=>{e(s=>[t,...s].slice(0,Vu))},clear:()=>{e(()=>[])},getAll:()=>Ge(ur)}}const ur=Gu(),W0=new Mi({dirName:"hashtree-explorer"});let da=new hx({store:W0});function Bt(){return da}let ze=null;function Wu(){const{subscribe:n,update:e}=Je({peerCount:0,peers:[],myPeerId:null,fallbackStoresCount:0,webrtcStats:null,perPeerStats:new Map,stats:{items:0,bytes:0}});return{subscribe:n,setPeerCount:t=>{e(s=>({...s,peerCount:t}))},setPeers:t=>{e(s=>({...s,peers:t}))},setMyPeerId:t=>{e(s=>({...s,myPeerId:t}))},setFallbackStoresCount:t=>{e(s=>({...s,fallbackStoresCount:t}))},setWebRTCStats:(t,s)=>{e(r=>({...r,webrtcStats:t,perPeerStats:s}))},setStats:t=>{e(s=>({...s,stats:t}))},getState:()=>Ge(e0)}}const e0=Wu();if(typeof window<"u"){const n=window;n.__appStore=e0,n.__localStore=W0}function Zr(n){return n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/1024/1024).toFixed(1)} MB`}async function Yu(){try{const n=await W0.count(),e=await W0.totalBytes();e0.setStats({items:n,bytes:e})}catch{}}function Qu(n){if(n.length===0)return"";try{const e=new TextDecoder("utf-8",{fatal:!0}).decode(n);if(!/[\x00-\x08\x0E-\x1F]/.test(e.slice(0,1e3)))return e}catch{}return null}function lo(){return n=>{const e=Iu();return e&&e.getFollowDistance(n)<=1?"follows":"other"}}function uo(){const n=Ge(Le),e=n.poolsLoaded?n.pools:P0;return{follows:{maxConnections:e.followsMax,satisfiedConnections:e.followsSatisfied},other:{maxConnections:e.otherMax,satisfiedConnections:e.otherSatisfied}}}function vx(n,e,t,s,r,x){var f,h;ze&&ze.stop();const o=Ge(Le).network,i=((f=o==null?void 0:o.relays)==null?void 0:f.length)>0?o.relays:Ut.relays,a=((h=o==null?void 0:o.blossomServers)==null?void 0:h.length)>0?o.blossomServers:Ut.blossomServers;ze=new Yi({signer:n,pubkey:e,encrypt:t,decrypt:s,giftWrap:r,giftUnwrap:x,localStore:W0,debug:!0,relays:i,peerClassifier:lo(),pools:uo(),fallbackStores:[new ix({servers:a,signer:n,logger:B=>ur.add(B)})]}),da=new hx({store:ze}),ze.on(B=>{if(B.type==="update"&&(e0.setPeerCount((ze==null?void 0:ze.getConnectedCount())??0),e0.setPeers((ze==null?void 0:ze.getPeers())??[]),e0.setFallbackStoresCount((ze==null?void 0:ze.getFallbackStoresCount())??0),ze)){const{aggregate:A,perPeer:D}=ze.getStats();e0.setWebRTCStats(A,D)}});const d=D0.subscribe(()=>{ze&&ze.setPeerClassifier(lo())});let l=Ge(Le).pools;const u=Le.subscribe(B=>{ze&&B.pools!==l&&(ze.setPoolConfig(uo()),l=B.pools)});ze._unsubscribers=[d,u],e0.setMyPeerId(ze.getMyPeerId()),e0.setFallbackStoresCount(ze.getFallbackStoresCount()),ze.start()}function fo(){if(ze){const{aggregate:n,perPeer:e}=ze.getStats();e0.setWebRTCStats(n,e)}}function Y0(){if(typeof window<"u"&&window.__hashtreeResolver)return window.__hashtreeResolver;const n=Kn({subscribe:(e,t)=>{const s={kinds:e.kinds,authors:e.authors,"#d":e["#d"],"#l":e["#l"]},r={closeOnEose:!1,cacheUsage:Sc.CACHE_FIRST},x=ye.subscribe(s,r);return x.on("event",o=>{t({id:o.id,pubkey:o.pubkey,kind:o.kind??30078,content:o.content,tags:o.tags,created_at:o.created_at??0})}),()=>x.stop()},publish:async e=>{try{const t=new vr(ye);return t.kind=e.kind,t.content=e.content,t.tags=e.tags,e.created_at&&(t.created_at=e.created_at),await t.publish(),!0}catch(t){return console.error("Failed to publish event:",t),!1}},getPubkey:()=>Nt.getState().pubkey,nip19:Ke});return typeof window<"u"&&(window.__hashtreeResolver=n),n}function yx(n,e){return!n||!e?null:`${n}/${e}`}const Ju=Object.freeze(Object.defineProperty({__proto__:null,getRefResolver:Y0,getResolverKey:yx},Symbol.toStringTag,{value:"Module"}));class fa{constructor(e=100){q(this,"cache",new Map);q(this,"maxSize");this.maxSize=e}get(e){const t=this.cache.get(e);return t!==void 0&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.delete(e),this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s!==void 0&&this.cache.delete(s)}this.cache.set(e,t)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}}const m0=new fa(100),en=new Set,sr=new Map;function Xu(n,e){let t=sr.get(n);return t||(t=new Set,sr.set(n,t)),t.add(e),()=>{t.delete(e),t.size===0&&sr.delete(n)}}function On(n,e){const t=sr.get(n);t&&t.forEach(s=>s(e))}async function Dx(n){if(!en.has(n)){en.add(n);try{const e=await ye.fetchEvents({kinds:[3],authors:[n],limit:1});if(e.size>0){const s=Array.from(e).sort((o,i)=>(i.created_at||0)-(o.created_at||0))[0],r=s.tags.filter(o=>o[0]==="p"&&o[1]).map(o=>o[1]),x={pubkey:s.pubkey,follows:r,followedAt:s.created_at||0};m0.set(n,x),On(n,x)}else{const t={pubkey:n,follows:[],followedAt:0};m0.set(n,t),On(n,t)}}catch(e){console.error("[follows] fetch error",e)}finally{en.delete(n)}}}function dr(n){const e=n!=null&&n.startsWith("npub1")?(()=>{try{return Ke.decode(n).data}catch{return""}})():n||"",{subscribe:t,set:s}=Je(e?m0.get(e):void 0);if(e){const r=Xu(e,s),x=m0.get(e);return x?s(x):Dx(e),{subscribe:t,destroy:r}}return{subscribe:t,destroy:()=>{}}}async function Zu(n){const e=Ge(ce).pubkey;if(!e||!ye.signer)return!1;let t=m0.get(e);t||(await Dx(e),t=m0.get(e));const s=(t==null?void 0:t.follows)||[];if(s.includes(n))return!0;const r=[...s,n];return ha(e,r)}async function ed(n){const e=Ge(ce).pubkey;if(!e||!ye.signer)return!1;let t=m0.get(e);t||(await Dx(e),t=m0.get(e));const s=(t==null?void 0:t.follows)||[];if(!s.includes(n))return!0;const r=s.filter(x=>x!==n);return ha(e,r)}async function ha(n,e){try{const t=new vr(ye);t.kind=3,t.content="",t.tags=e.map(r=>["p",r]),await t.publish();const s={pubkey:n,follows:e,followedAt:t.created_at||Math.floor(Date.now()/1e3)};return m0.set(n,s),On(n,s),Fx(t.rawEvent()),!0}catch(t){return console.error("[follows] publish error",t),!1}}const Ea="hashtree:accounts",fr="hashtree:activeAccount";function td(){const{subscribe:n,set:e,update:t}=Je({accounts:[],activeAccountPubkey:null});return{subscribe:n,setAccounts:r=>{t(x=>({...x,accounts:r}))},setActiveAccount:r=>{t(x=>({...x,activeAccountPubkey:r}))},addAccount:r=>{t(x=>{if(x.accounts.some(i=>i.pubkey===r.pubkey))return x;const o=[...x.accounts,r];return ho(o),{...x,accounts:o}})},removeAccount:r=>{const x=Ge(Lt);if(x.accounts.length<=1)return!1;const o=x.accounts.filter(a=>a.pubkey!==r);ho(o);let i=x.activeAccountPubkey;return x.activeAccountPubkey===r&&o.length>0&&(i=o[0].pubkey,localStorage.setItem(fr,o[0].pubkey)),e({accounts:o,activeAccountPubkey:i}),!0},getState:()=>Ge(Lt),setState:r=>{t(x=>({...x,...r}))}}}const Lt=td();function ho(n){const e=n.map(t=>({pubkey:t.pubkey,npub:t.npub,type:t.type,nsec:t.nsec,addedAt:t.addedAt}));localStorage.setItem(Ea,JSON.stringify(e))}function sd(){try{const n=localStorage.getItem(Ea);return n?JSON.parse(n):[]}catch{return[]}}function rd(){return localStorage.getItem(fr)}function mr(n){n?localStorage.setItem(fr,n):localStorage.removeItem(fr)}function mx(n){try{const e=Ke.decode(n);if(e.type!=="nsec")return null;const t=e.data,s=Ar(t);return{pubkey:s,npub:Ke.npubEncode(s),type:"nsec",nsec:n,addedAt:Date.now()}}catch{return null}}function nd(n){return{pubkey:n,npub:Ke.npubEncode(n),type:"extension",addedAt:Date.now()}}function xd(){const n=sd(),e=rd();Lt.setState({accounts:n,activeAccountPubkey:e&&n.some(t=>t.pubkey===e)?e:n.length>0?n[0].pubkey:null})}class od extends yr{constructor(){super("hashtree-chunk-metadata");q(this,"chunks");q(this,"trees");this.version(1).stores({chunks:"&hashHex, *owners, lastAccessed",trees:"&key, ownerNpub, isOwn"})}}const R0=new od;async function id(n){return R0.trees.get(n)}async function ad(n){await R0.trees.put(n)}async function cd(n){return(await R0.trees.where("ownerNpub").equals(n).toArray()).reduce((t,s)=>t+s.totalBytes,0)}async function ld(n){const e=await R0.trees.where("isOwn").equals(0).toArray(),t=new Set(e.map(s=>s.ownerNpub));for(const s of n)t.delete(s);return Array.from(t)}async function ud(n,e){const t=await R0.trees.where("ownerNpub").equals(n).toArray(),s=new Set(t.map(i=>i.key)),r=await R0.chunks.orderBy("lastAccessed").toArray(),x=[];let o=0;for(const i of r){if(o>=e)break;i.owners.every(d=>s.has(d))&&i.owners.length>0&&(x.push(i.hashHex),o+=i.size)}return x}async function dd(n){await R0.chunks.bulkDelete(n)}async function fd(){const n=await R0.trees.toArray(),e=new Map;for(const t of n){const s=e.get(t.ownerNpub);s?(s.bytes+=t.totalBytes,s.treeCount+=1,t.isOwn&&(s.isOwn=!0)):e.set(t.ownerNpub,{bytes:t.totalBytes,treeCount:1,isOwn:t.isOwn})}return Array.from(e.entries()).map(([t,s])=>({npub:t,...s})).sort((t,s)=>s.bytes-t.bytes)}const Ba=Je([]);async function Ca(){const n=await fd();Ba.set(n)}class hd{constructor(){q(this,"running",!1);q(this,"syncQueue",[]);q(this,"processing",!1);q(this,"followsUnsubscribers",new Map);q(this,"treeListUnsubscribers",new Map);q(this,"ownTreesUnsubscriber",null);q(this,"processQueueTimeoutId",null)}start(){this.running||(this.running=!0,console.log("[backgroundSync] Starting service"),this.subscribeToOwnTrees(),this.subscribeToFollows())}stop(){var e;if(this.running){this.running=!1,console.log("[backgroundSync] Stopping service"),(e=this.ownTreesUnsubscriber)==null||e.call(this),this.ownTreesUnsubscriber=null;for(const t of this.followsUnsubscribers.values())t();this.followsUnsubscribers.clear();for(const t of this.treeListUnsubscribers.values())t();this.treeListUnsubscribers.clear(),this.syncQueue=[],this.processQueueTimeoutId&&(clearTimeout(this.processQueueTimeoutId),this.processQueueTimeoutId=null)}}queueTreeSync(e,t,s,r=2){if(!this.getSyncSettings().enabled)return;const o=this.syncQueue.findIndex(i=>i.key===e);if(o!==-1){se(this.syncQueue[o].cid.hash)!==se(t.hash)&&(this.syncQueue[o]={key:e,cid:t,isOwn:s,priority:r});return}this.syncQueue.push({key:e,cid:t,isOwn:s,priority:r}),this.syncQueue.sort((i,a)=>i.priority-a.priority),this.scheduleProcessQueue()}queueVisitedTree(e,t){const s=this.getSyncSettings();!s.enabled||!s.syncVisitedUnlisted||this.queueTreeSync(e,t,!1,1)}getSyncSettings(){return Ge(Le).sync??A0}getOwnNpubs(){return Ge(Lt).accounts.map(t=>t.npub)}subscribeToOwnTrees(){const e=Y0();if(!e.list)return;const t=Ge(ce);if(!t.npub)return;const s=e.list(t.npub,r=>{for(const x of r)this.queueTreeSync(x.key,x.cid,!0,0)});this.ownTreesUnsubscriber=s}subscribeToFollows(){const e=Ge(ce);if(!e.pubkey)return;const t=dr(e.pubkey),s=x=>{if(!x||!this.getSyncSettings().syncFollowedPublic)return;const i=x.follows||[],a=new Set(this.getOwnNpubs());for(const l of i){const u=jn(l);a.has(u)||this.treeListUnsubscribers.has(u)||this.subscribeToUserTrees(u)}const d=new Set(i.map(l=>jn(l)));for(const[l,u]of this.treeListUnsubscribers)d.has(l)||(u(),this.treeListUnsubscribers.delete(l))},r=t.subscribe(s);this.followsUnsubscribers.set("main",r)}subscribeToUserTrees(e){const t=Y0();if(!t.list)return;const s=t.list(e,r=>{for(const x of r)x.visibility==="public"&&this.queueTreeSync(x.key,x.cid,!1,2)});this.treeListUnsubscribers.set(e,s)}scheduleProcessQueue(){this.processQueueTimeoutId||(this.processQueueTimeoutId=setTimeout(()=>{this.processQueueTimeoutId=null,this.processQueue()},100))}async processQueue(){if(!(this.processing||!this.running)&&this.syncQueue.length!==0){this.processing=!0;try{const e=this.syncQueue.shift();if(!e)return;await this.syncTree(e),await this.checkQuotas()}catch(e){console.error("[backgroundSync] Error processing queue:",e)}finally{this.processing=!1,this.syncQueue.length>0&&this.running&&this.scheduleProcessQueue()}}}async syncTree(e){const{key:t,cid:s,isOwn:r}=e,x=await id(t),o=se(s.hash);if(!(x&&x.rootHash===o)){console.log(`[backgroundSync] Syncing tree: ${t}`);try{const i=Bt(),{chunks:a,bytes:d}=await i.pull(s),l=t.split("/")[0],u={key:t,ownerNpub:l,rootHash:o,totalBytes:d,lastSynced:Date.now(),isOwn:r};await ad(u),Ca(),console.log(`[backgroundSync] Synced ${t}: ${a} chunks, ${d} bytes`)}catch(i){console.error(`[backgroundSync] Failed to sync ${t}:`,i)}}}async checkQuotas(){const e=this.getSyncSettings();if(!e.enabled)return;const t=await W0.totalBytes();if(t<=e.storageCap)return;console.log(`[backgroundSync] Storage ${t} exceeds cap ${e.storageCap}, enforcing quotas`);const s=this.getOwnNpubs(),r=await ld(s);if(r.length===0)return;const o=e.storageCap*(1-e.ownQuotaPercent/100)/r.length;for(const i of r){const a=await cd(i);if(a>o){const d=a-o;console.log(`[backgroundSync] User ${i.slice(0,12)}... over quota by ${d} bytes`);const l=await ud(i,d);for(const u of l)try{await W0.delete(we(u))}catch(f){console.error(`[backgroundSync] Failed to delete chunk ${u}:`,f)}await dd(l),console.log(`[backgroundSync] Evicted ${l.length} chunks from ${i.slice(0,12)}...`)}}}}let tn=null;function Ed(){return tn||(tn=new hd),tn}function wx(){Ed().start()}const pa=Je(window.location.hash);typeof window<"u"&&window.addEventListener("hashchange",()=>{pa.set(window.location.hash)});function Bd(n){var u;const e=n.replace(/^#\/?/,"");let t=e,s=null,r=!1,x=null,o=null,i=null,a=!1;const d=e.indexOf("?");if(d!==-1){t=e.slice(0,d);const f=new URLSearchParams(e.slice(d+1));s=f.get("k"),r=f.get("stream")==="1",x=f.get("g"),o=f.get("branch"),a=f.get("merge")==="1";const h=f.get("compare"),B=f.get("base"),A=f.get("head");if(h!=null&&h.includes("...")){const[D,v]=h.split("...");D&&v&&(i={base:D,head:v})}else a&&B&&A&&(i={base:B,head:A})}const l=t.split("/").filter(Boolean).map(decodeURIComponent);if(l[0]&&Cx(l[0]))try{const f=Xi(l[0]);return{npub:null,treeName:null,cid:{hash:f.hash,key:f.decryptKey},path:l.slice(1),isPermalink:!0,linkKey:s,isStreaming:r,gitRoot:x,branch:o,compareBranches:i,isMergeView:a}}catch{}if(l[0]&&px(l[0]))try{const f=Zi(l[0]);return{npub:Ke.npubEncode(f.pubkey),treeName:f.treeName,cid:null,path:f.path||[],isPermalink:!1,linkKey:s,isStreaming:r,gitRoot:x,branch:o,compareBranches:i,isMergeView:a}}catch{}if(["settings","wallet","users"].includes(l[0]))return{npub:null,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1};if((u=l[0])!=null&&u.startsWith("npub")){const f=l[0];if(["profile","follows","edit"].includes(l[1]))return{npub:f,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1};if(l[1]&&!["profile","follows","edit"].includes(l[1])){let h=l[1],B=2;return l[1]==="docs"&&l[2]&&(h=`docs/${l[2]}`,B=3),{npub:f,treeName:h,cid:null,path:l.slice(B),isPermalink:!1,linkKey:s,isStreaming:r,gitRoot:x,branch:o,compareBranches:i,isMergeView:a}}return{npub:f,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1}}return{npub:null,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1}}const w0=tx(pa,n=>Bd(n));tx(w0,n=>n.path);const F0=new Map;function Cd(n,e,t){let s=F0.get(n);s||(s={hash:null,encryptionKey:void 0,visibilityInfo:void 0,decryptedKey:void 0,listeners:new Set,unsubscribe:null},F0.set(n,s)),s.hash=e,s.encryptionKey=t,s.decryptedKey=t,s.listeners.forEach(r=>r(e,t,s.visibilityInfo))}function pd(n,e){let t=F0.get(n);if(!t){t={hash:null,encryptionKey:void 0,visibilityInfo:void 0,decryptedKey:void 0,listeners:new Set,unsubscribe:null},F0.set(n,t);const s=Y0();t.unsubscribe=s.subscribe(n,(r,x)=>{const o=F0.get(n);o&&(o.hash=(r==null?void 0:r.hash)??null,o.encryptionKey=r==null?void 0:r.key,o.visibilityInfo=x,o.listeners.forEach(i=>i((r==null?void 0:r.hash)??null,r==null?void 0:r.key,x)))})}return t.listeners.add(e),t.hash&&e(t.hash,t.encryptionKey,t.visibilityInfo),()=>{var r;const s=F0.get(n);s&&(s.listeners.delete(e),s.listeners.size===0&&((r=s.unsubscribe)==null||r.call(s),F0.delete(n)))}}async function gd(n,e,t){if(e)return e;if(n){if(n.visibility==="unlisted"&&n.encryptedKey&&t)try{const s=await ls.decryptKeyFromLink(n.encryptedKey,t);if(s)return we(s);console.warn("[decryptEncryptionKey] Key mismatch - linkKey does not decrypt encryptedKey")}catch(s){console.error("[decryptEncryptionKey] Decryption failed:",s)}if(n.selfEncryptedKey)try{const s=Ge(ce),r=Fa();if(r&&s.pubkey){const x=Mt.v2.utils.getConversationKey(r,s.pubkey),o=Mt.v2.decrypt(n.selfEncryptedKey,x);return we(o)}}catch(s){console.debug("Could not decrypt selfEncryptedKey (not owner?):",s)}}}const g0=Je(null);let C0=null,Js=null;function Ad(){return w0.subscribe(async n=>{if(n.isPermalink&&n.cid){const t=n.cid.key?we(n.cid.key):void 0;g0.set(Qe(we(n.cid.hash),t)),C0&&(C0(),C0=null,Js=null);return}const e=yx(n.npub??void 0,n.treeName??void 0);if(!e){g0.set(null),C0&&(C0(),C0=null,Js=null);return}e!==Js&&(C0&&C0(),g0.set(null),Js=e,C0=pd(e,async(t,s,r)=>{if(!t){g0.set(null);return}const x=await gd(r,s,n.linkKey);if(x){const o=F0.get(e);o&&(o.decryptedKey=x)}g0.set(Qe(t,x))}))}),g0}function ga(n,e){const t=yx(n??void 0,e??void 0);if(!t)return null;const s=F0.get(t);if(!(s!=null&&s.hash))return null;const r=s.decryptedKey??s.encryptionKey;return Qe(s.hash,r)}const Eo="__treeRootStoreInitialized",Bo=typeof globalThis<"u"?globalThis:window;queueMicrotask(()=>{Bo[Eo]||(Bo[Eo]=!0,Ad())});const hr=new Map,sn=new Map,Fd=1e3,vd=new Set;function yd(n,e){for(const t of vd)try{t(n,e)}catch(s){console.error("Cache listener error:",s)}}function Bs(n,e,t,s,r){const x=`${n}/${e}`,o=hr.get(x),i=r??(o==null?void 0:o.visibility);hr.set(x,{hash:t,key:s,visibility:i,dirty:!0}),yd(n,e),Dd(n,e),Cd(x,t,s)}function Aa(n,e,t,s,r){Bs(n,e,we(t),s?we(s):void 0,r)}function Dd(n,e){const t=`${n}/${e}`,s=sn.get(t);s&&clearTimeout(s);const r=setTimeout(()=>{sn.delete(t),md(n,e)},Fd);sn.set(t,r)}async function md(n,e){const t=`${n}/${e}`,s=hr.get(t);if(!(!s||!s.dirty))try{const{publishTreeRoot:r}=await i0(async()=>{const{publishTreeRoot:d}=await Promise.resolve().then(()=>kr);return{publishTreeRoot:d}},void 0),x=se(s.hash),o=s.key?se(s.key):void 0,i=s.visibility;if(await r(e,x,o,i)){const d=hr.get(t);d&&se(d.hash)===x&&(d.dirty=!1)}}catch(r){console.error("Failed to publish tree root:",r)}}function X0(){var l,u;const n=window.location.hash.slice(2),[e,t]=n.split("?"),s=e.split("/").filter(Boolean).map(decodeURIComponent);let r=null,x=!1,o=null,i=null,a=null,d=!1;if(t){const f=new URLSearchParams(t);r=f.get("k"),x=f.get("stream")==="1",o=f.get("g"),i=f.get("branch"),d=f.get("merge")==="1";const h=f.get("compare"),B=f.get("base"),A=f.get("head");if(h!=null&&h.includes("...")){const[D,v]=h.split("...");D&&v&&(a={base:D,head:v})}else d&&B&&A&&(a={base:B,head:A})}if((l=s[0])!=null&&l.startsWith("nhash1"))try{const{nhashDecode:f}=require("hashtree"),h=f(s[0]);return{npub:null,treeName:null,cid:{hash:h.hash,key:h.decryptKey},path:s.slice(1),isPermalink:!0,linkKey:r,isStreaming:x,gitRoot:o,branch:i,compareBranches:a,isMergeView:d}}catch{}if(["settings","wallet"].includes(s[0]))return{npub:null,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1};if((u=s[0])!=null&&u.startsWith("npub")){const f=s[0];if(["profile","follows","followers","edit"].includes(s[1]))return{npub:f,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1};if(s[1]&&!["profile","follows","followers","edit"].includes(s[1])){let h=s[1],B=2;return s[1]==="docs"&&s[2]&&(h=`docs/${s[2]}`,B=3),{npub:f,treeName:h,cid:null,path:s.slice(B),isPermalink:!1,linkKey:r,isStreaming:x,gitRoot:o,branch:i,compareBranches:a,isMergeView:d}}return{npub:f,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1}}return{npub:null,treeName:null,cid:null,path:[],isPermalink:!1,linkKey:null,isStreaming:!1,gitRoot:null,branch:null,compareBranches:null,isMergeView:!1}}const wr="hashtree:nsec",br="hashtree:loginType";function wd(){const n=Ut.relays,{subscribe:e,update:t}=Je({pubkey:null,npub:null,isLoggedIn:!1,selectedTree:null,relays:n,relayStatuses:new Map(n.map(s=>[s,"disconnected"])),connectedRelays:0,discoveredRelays:[]});return{subscribe:e,setPubkey:s=>{t(r=>({...r,pubkey:s}))},setNpub:s=>{t(r=>({...r,npub:s}))},setIsLoggedIn:s=>{t(r=>({...r,isLoggedIn:s}))},setSelectedTree:s=>{t(r=>({...r,selectedTree:s}))},setRelays:s=>{t(r=>({...r,relays:s}))},setConnectedRelays:s=>{t(r=>({...r,connectedRelays:s}))},setRelayStatus:(s,r)=>{t(x=>{const o=new Map(x.relayStatuses);return o.set(s,r),{...x,relayStatuses:o}})},setRelayStatuses:s=>{t(r=>({...r,relayStatuses:s}))},setDiscoveredRelays:s=>{t(r=>({...r,discoveredRelays:s}))},getState:()=>Ge(ce),setState:s=>{t(r=>({...r,...s}))}}}const bd=typeof window<"u"?window.__nostrStore:null,ce=bd||wd();typeof window<"u"&&(window.__nostrStore=ce);const Nt=ce;let Xt=null;function Fa(){return Xt}function Hn(){return Xt?Ke.nsecEncode(Xt):null}const kd=new Tc({dbName:"hashtree-ndk-cache"}),ye=new Pc({explicitRelayUrls:Ut.relays,cacheAdapter:kd});ye.connect().catch(console.error);async function va(){var t,s,r,x;const n=Le.getState(),e=((s=(t=n.network)==null?void 0:t.relays)==null?void 0:s.length)>0?n.network.relays:Ut.relays;ce.setRelays(e),ce.setRelayStatuses(new Map(e.map(o=>[rr(o),"disconnected"])));for(const o of((r=ye.pool)==null?void 0:r.relays.values())??[])(x=ye.pool)==null||x.removeRelay(o.url);for(const o of e)ye.addExplicitRelay(o);await ye.connect(),Z0()}const _d=4,ya=5;function Sd(n){return n>=ya?"connected":n===_d?"connecting":"disconnected"}function rr(n){return n.replace(/\/$/,"")}function Z0(){var i,a;const n=ye.pool;if(!n){ce.setConnectedRelays(0);return}let e=0;const t=new Map,s=[],r=Le.getState(),x=((a=(i=r.network)==null?void 0:i.relays)==null?void 0:a.length)>0?r.network.relays:Ut.relays,o=new Set(x.map(rr));for(const d of x)t.set(rr(d),"disconnected");for(const d of n.relays.values()){const l=Sd(d.status),u=rr(d.url);o.has(u)?t.set(u,l):s.push({url:u,status:l}),d.status>=ya&&e++}s.sort((d,l)=>d.url.localeCompare(l.url)),ce.setConnectedRelays(e),ce.setRelayStatuses(t),ce.setDiscoveredRelays(s)}var di;(di=ye.pool)==null||di.on("relay:connect",()=>Z0());var fi;(fi=ye.pool)==null||fi.on("relay:disconnect",()=>Z0());setInterval(Z0,2e3);setTimeout(Z0,500);setTimeout(Z0,1500);setTimeout(Z0,3e3);let ws=Le.getState().network,Co=JSON.stringify(ws==null?void 0:ws.relays);Le.subscribe(n=>{var e;if(n.networkLoaded&&n.network!==ws){const t=JSON.stringify((e=n.network)==null?void 0:e.relays),s=t!==Co;ws=n.network,Co=t,s&&va().catch(console.error)}});queueMicrotask(()=>{Da().catch(console.error)});async function Ms(n){if(!ye.signer)throw new Error("No signing method available");const e=new vr(ye,n);return await e.sign(),e.rawEvent()}function bx(n,e,t){return{giftWrap:async(x,o)=>{const i={pubkey:n,kind:x.kind,content:x.content,tags:x.tags},a=Bi();Ar(a);const d=Mt.v2.utils.getConversationKey(a,o),l=Mt.v2.encrypt(JSON.stringify(i),d),u=Math.floor(Date.now()/1e3),f=u+300;return yc({kind:25050,created_at:u,tags:[["p",o],["expiration",f.toString()]],content:l},a)},giftUnwrap:async x=>{try{const o=await t(x.pubkey,x.content);return JSON.parse(o)}catch{return null}}}}async function Da(){xd();const n=localStorage.getItem(br),e=localStorage.getItem(wr),t=Lt.getState();if(t.accounts.length===0&&(n||e)&&n==="nsec"&&e){const r=mx(e);r&&(Lt.addAccount(r),Lt.setActiveAccount(r.pubkey),mr(r.pubkey))}const s=t.accounts.find(r=>r.pubkey===t.activeAccountPubkey);if(s){if(s.type==="extension")return Er();if(s.type==="nsec"&&s.nsec)return Br(s.nsec,!1)}return n==="extension"?Er():n==="nsec"&&e?Br(e):(kx(),!0)}async function Pd(n=2e3){return window.nostr?!0:new Promise(e=>{const t=Date.now(),s=setInterval(()=>{window.nostr?(clearInterval(s),e(!0)):Date.now()-t>n&&(clearInterval(s),e(!1))},100)})}async function Er(){try{if(!await Pd())throw new Error("No nostr extension found");const e=new Mc;ye.signer=e;const s=(await e.user()).pubkey;if(ce.setPubkey(s),ce.setNpub(Ke.npubEncode(s)),ce.setIsLoggedIn(!0),Xt=null,localStorage.setItem(br,"extension"),localStorage.removeItem(wr),!Lt.getState().accounts.some(d=>d.pubkey===s)){const d=nd(s);Lt.addAccount(d)}Lt.setActiveAccount(s),mr(s);const x=async(d,l)=>{var u;return(u=window.nostr.nip44)!=null&&u.encrypt?window.nostr.nip44.encrypt(d,l):window.nostr.nip04.encrypt(d,l)},o=async(d,l)=>{var u;return(u=window.nostr.nip44)!=null&&u.decrypt?window.nostr.nip44.decrypt(d,l):window.nostr.nip04.decrypt(d,l)},{giftWrap:i,giftUnwrap:a}=bx(s,x,o);return vx(Ms,s,x,o,i,a),wx(),!0}catch(n){return console.error("Extension login failed:",n),!1}}function Br(n,e=!0){try{const t=Ke.decode(n);if(t.type!=="nsec")throw new Error("Invalid nsec");Xt=t.data;const s=Ar(Xt),r=new gi(n);if(ye.signer=r,ce.setPubkey(s),ce.setNpub(Ke.npubEncode(s)),ce.setIsLoggedIn(!0),e){if(localStorage.setItem(br,"nsec"),localStorage.setItem(wr,n),!Lt.getState().accounts.some(u=>u.pubkey===s)){const u=mx(n);u&&Lt.addAccount(u)}Lt.setActiveAccount(s),mr(s)}const x=Xt,o=async(l,u)=>{const f=Mt.v2.utils.getConversationKey(x,l);return Mt.v2.encrypt(u,f)},i=async(l,u)=>{const f=Mt.v2.utils.getConversationKey(x,l);return Mt.v2.decrypt(u,f)},{giftWrap:a,giftUnwrap:d}=bx(s,o,i);return vx(Ms,s,o,i,a,d),wx(),!0}catch(t){return console.error("Nsec login failed:",t),!1}}function kx(){Xt=Bi();const n=Ar(Xt),e=Ke.nsecEncode(Xt),t=new gi(e);ye.signer=t,ce.setPubkey(n);const s=Ke.npubEncode(n);ce.setNpub(s),ce.setIsLoggedIn(!0),localStorage.setItem(br,"nsec"),localStorage.setItem(wr,e);const r=mx(e);r&&(Lt.addAccount(r),Lt.setActiveAccount(n),mr(n));const x=Xt,o=async(l,u)=>{const f=Mt.v2.utils.getConversationKey(x,l);return Mt.v2.encrypt(u,f)},i=async(l,u)=>{const f=Mt.v2.utils.getConversationKey(x,l);return Mt.v2.decrypt(u,f)},{giftWrap:a,giftUnwrap:d}=bx(n,o,i);return vx(Ms,n,o,i,a,d),Td(),setTimeout(()=>wx(),1e3),{nsec:e,npub:s}}async function Td(){try{const{createTree:n}=await i0(async()=>{const{createTree:e}=await Promise.resolve().then(()=>z8);return{createTree:e}},void 0);await n("public","public",!0),await n("link","unlisted",!0),await n("private","private",!0)}catch(n){console.error("Failed to create default folders:",n)}}async function _x(n,e,t,s={}){var u;const r=ce.getState();if(!r.pubkey||!ye.signer)return{success:!1};const x=s.visibility??"public",o=Math.floor(Date.now()/1e3),i=new vr(ye);if(i.kind=30078,i.content="",i.created_at=o,i.tags=[["d",n],["l","hashtree"],["hash",e]],s.labels)for(const f of s.labels)i.tags.push(["l",f]);let a;if(t)switch(x){case"public":i.tags.push(["key",t]);break;case"unlisted":a=s.linkKey??ls.generateLinkKey(),(async()=>{var D;const f=await ls.encryptKeyForLink(t,a),h=await ls.computeKeyId(a);i.tags.push(["encryptedKey",f]),i.tags.push(["keyId",h]);const B=Mt.v2.utils.getConversationKey(Xt,r.pubkey),A=Mt.v2.encrypt(t,B);i.tags.push(["selfEncryptedKey",A]);try{await i.sign(),(D=ye.cacheAdapter)!=null&&D.setEvent&&await ye.cacheAdapter.setEvent(i,[{kinds:[30078],authors:[r.pubkey],"#d":[n]}])}catch(v){console.error("Failed to sign/cache hashtree:",v)}i.publish().catch(v=>console.error("Failed to publish hashtree:",v))})();break;case"private":(async()=>{var B;const f=Mt.v2.utils.getConversationKey(Xt,r.pubkey),h=Mt.v2.encrypt(t,f);i.tags.push(["selfEncryptedKey",h]);try{await i.sign(),(B=ye.cacheAdapter)!=null&&B.setEvent&&await ye.cacheAdapter.setEvent(i,[{kinds:[30078],authors:[r.pubkey],"#d":[n]}])}catch(A){console.error("Failed to sign/cache hashtree:",A)}i.publish().catch(A=>console.error("Failed to publish hashtree:",A))})();break}(!t||x==="public")&&(async()=>{var f;try{await i.sign(),(f=ye.cacheAdapter)!=null&&f.setEvent&&await ye.cacheAdapter.setEvent(i,[{kinds:[30078],authors:[r.pubkey],"#d":[n]}]),i.publish().catch(h=>console.error("Failed to publish hashtree:",h))}catch(h){console.error("Failed to sign/cache hashtree:",h)}})();const d=r.selectedTree;d&&d.name===n&&d.pubkey===r.pubkey&&ce.setSelectedTree({...d,rootHash:e,rootKey:x==="public"?t:void 0,visibility:x,created_at:i.created_at||Math.floor(Date.now()/1e3)});const l=r.npub;if(l){const{getRefResolver:f}=await i0(async()=>{const{getRefResolver:m}=await Promise.resolve().then(()=>Ju);return{getRefResolver:m}},void 0),{fromHex:h,cid:B}=await i0(async()=>{const{fromHex:m,cid:C}=await Promise.resolve().then(()=>hu);return{fromHex:m,cid:C}},void 0),A=f(),D=h(e),v=t?h(t):void 0;(u=A.publish)==null||u.call(A,`${l}/${n}`,B(D,v),{visibility:x},!0)}return{success:!0,linkKey:a}}function jn(n){return Ke.npubEncode(n)}function bs(n){try{const e=Ke.decode(n);return e.type!=="npub"?null:e.data}catch{return null}}function ma(){const n=ce.getState();return!n.isLoggedIn||!n.selectedTree||!n.pubkey?!1:n.selectedTree.pubkey===n.pubkey}function Q0(n){const e=ce.getState();if(!ma()||!e.selectedTree||!e.npub)return;const t=se(n.hash),s=n.key?se(n.key):void 0;Aa(e.npub,e.selectedTree.name,t,s),ce.setSelectedTree({...e.selectedTree,rootHash:t,rootKey:e.selectedTree.visibility==="public"?s:e.selectedTree.rootKey})}async function Md(n,e,t,s){var a,d,l;const r=ce.getState();if(!r.pubkey||!ye.signer)return!1;let x=s??"public",o;return s||((a=r.selectedTree)==null?void 0:a.name)===n&&((d=r.selectedTree)==null?void 0:d.pubkey)===r.pubkey&&((l=r.selectedTree)!=null&&l.visibility)&&(x=r.selectedTree.visibility),x==="unlisted"&&(o=X0().linkKey??void 0),(await _x(n,e,t,{visibility:x,linkKey:o})).success}const kr=Object.freeze(Object.defineProperty({__proto__:null,autosaveIfOwn:Q0,generateNewKey:kx,getNsec:Hn,getSecretKey:Fa,isOwnTree:ma,linkKeyUtils:ls,loginWithExtension:Er,loginWithNsec:Br,ndk:ye,nostrStore:ce,npubToPubkey:bs,pubkeyToNpub:jn,publishTreeRoot:Md,restoreSession:Da,saveHashtree:_x,signEvent:Ms,updateNdkRelays:va,useNostrStore:Nt},Symbol.toStringTag,{value:"Module"})),qn=new fa(200),rn=new Set,nr=new Map;function Id(n,e){let t=nr.get(n);return t||(t=new Set,nr.set(n,t)),t.add(e),()=>{t.delete(e),t.size===0&&nr.delete(n)}}function Rd(n,e){const t=nr.get(n);t&&t.forEach(s=>s(e))}async function Ud(n){if(!rn.has(n)){rn.add(n);try{const e=await ye.fetchEvents({kinds:[0],authors:[n],limit:1});if(e.size>0){const s=Array.from(e).sort((r,x)=>(x.created_at||0)-(r.created_at||0))[0];try{const r=JSON.parse(s.content);r.pubkey=s.pubkey,qn.set(n,r),Rd(n,r)}catch(r){console.error("[profile] JSON parse error",r)}}}catch(e){console.error("[profile] fetch error",e)}finally{rn.delete(n)}}}function Sx(n){const e=n?n.startsWith("npub1")?(()=>{try{return Ke.decode(n).data}catch{return""}})():n:"",t=Je(e?qn.get(e):void 0);if(e){const s=Id(e,r=>{t.set(r)});return qn.get(e)||Ud(e),{subscribe:(r,x)=>{const o=t.subscribe(r,x);return()=>{o(),s()}}}}return{subscribe:t.subscribe}}function wa(n,e){if(!(!n&&!e)&&n)return n.display_name||n.name||n.username||(n.nip05?n.nip05.split("@")[0]:void 0)}const po=["canidae","felidae","cat","cattle","dog","donkey","goat","horse","pig","rabbit","aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","capybara","cardinal","caribou","carp","cat","catshark","caterpillar","catfish","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","cicada","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragonfly","dragon","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","gamefowl","galliform","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","urial","vicuna","viper","vole","vulture","wallaby","walrus","wasp","warbler","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra","alpaca","cat","cattle","chicken","dog","donkey","ferret","gayal","goldfish","guppy","horse","koi","llama","sheep","yak","unicorn"],go=JSON.parse('["average","big","colossal","fat","giant","gigantic","great","huge","immense","large","little","long","mammoth","massive","miniature","petite","puny","short","small","tall","tiny","boiling","breezy","broken","bumpy","chilly","cold","cool","creepy","crooked","cuddly","curly","damaged","damp","dirty","dry","dusty","filthy","flaky","fluffy","wet","broad","chubby","crooked","curved","deep","flat","high","hollow","low","narrow","round","shallow","skinny","square","steep","straight","wide","ancient","brief","early","fast","late","long","modern","old","quick","rapid","short","slow","swift","young","abundant","empty","few","heavy","light","many","numerous","sound","cooing","faint","harsh","hissing","hushed","husky","loud","melodic","moaning","mute","noisy","purring","quiet","raspy","resonant","screeching","shrill","silent","soft","squealing","thundering","voiceless","whispering","bitter","delicious","fresh","juicy","ripe","rotten","salty","sour","spicy","stale","sticky","strong","sweet","tasteless","tasty","thirsty","fluttering","fuzzy","greasy","grubby","hard","hot","icy","loose","melted","plastic","prickly","rainy","rough","scattered","shaggy","shaky","sharp","shivering","silky","slimy","slippery","smooth","soft","solid","steady","sticky","tender","tight","uneven","weak","wet","wooden","afraid","angry","annoyed","anxious","arrogant","ashamed","awful","bad","bewildered","bored","combative","condemned","confused","creepy","cruel","dangerous","defeated","defiant","depressed","disgusted","disturbed","eerie","embarrassed","envious","evil","fierce","foolish","frantic","frightened","grieving","helpless","homeless","hungry","hurt","ill","jealous","lonely","mysterious","naughty","nervous","obnoxious","outrageous","panicky","repulsive","scary","scornful","selfish","sore","tense","terrible","thoughtless","tired","troubled","upset","uptight","weary","wicked","worried","agreeable","amused","brave","calm","charming","cheerful","comfortable","cooperative","courageous","delightful","determined","eager","elated","enchanting","encouraging","energetic","enthusiastic","excited","exuberant","fair","faithful","fantastic","fine","friendly","funny","gentle","glorious","good","happy","healthy","helpful","hilarious","jolly","joyous","kind","lively","lovely","lucky","obedient","perfect","pleasant","proud","relieved","silly","smiling","splendid","successful","thoughtful","victorious","vivacious","witty","wonderful","zealous","zany","other","good","new","old","great","high","small","different","large","local","social","important","long","young","national","british","right","early","possible","big","little","political","able","late","general","full","far","low","public","available","bad","main","sure","clear","major","economic","only","likely","real","black","particular","international","special","difficult","certain","open","whole","white","free","short","easy","strong","european","central","similar","human","common","necessary","single","personal","hard","private","poor","financial","wide","foreign","simple","recent","concerned","american","various","close","fine","english","wrong","present","royal","natural","individual","nice","french","nihilist","solipsist","materialist","surrealist","heroic","awesome","hedonist","absurd","current","modern","labour","legal","happy","final","red","normal","serious","previous","total","prime","significant","industrial","sorry","dead","specific","appropriate","top","soviet","basic","military","original","successful","aware","hon","popular","heavy","professional","direct","dark","cold","ready","green","useful","effective","western","traditional","scottish","german","independent","deep","interesting","considerable","involved","physical","hot","existing","responsible","complete","medical","blue","extra","past","male","interested","fair","essential","beautiful","civil","primary","obvious","future","environmental","positive","senior","nuclear","annual","relevant","huge","rich","commercial","safe","regional","practical","official","separate","key","chief","regular","due","additional","active","powerful","complex","standard","impossible","light","warm","middle","fresh","sexual","front","domestic","actual","united","technical","ordinary","cheap","strange","internal","excellent","quiet","soft","potential","northern","religious","quick","very","famous","cultural","proper","broad","joint","formal","limited","conservative","lovely","usual","ltd","unable","rural","initial","substantial","bright","average","leading","reasonable","immediate","suitable","equal","detailed","working","overall","female","afraid","democratic","growing","sufficient","scientific","eastern","correct","inc","irish","expensive","educational","mental","dangerous","critical","increased","familiar","unlikely","double","perfect","slow","tiny","dry","historical","thin","daily","southern","increasing","wild","alone","urban","empty","married","narrow","liberal","supposed","upper","apparent","tall","busy","bloody","prepared","russian","moral","careful","clean","attractive","japanese","vital","thick","alternative","fast","ancient","elderly","rare","external","capable","brief","wonderful","grand","typical","entire","grey","constant","vast","surprised","ideal","terrible","academic","funny","minor","pleased","severe","ill","corporate","negative","permanent","weak","brown","fundamental","odd","crucial","inner","used","criminal","contemporary","sharp","sick","near","roman","massive","unique","secondary","parliamentary","african","unknown","subsequent","angry","alive","guilty","lucky","enormous","well","yellow","unusual","net","tough","dear","extensive","glad","remaining","agricultural","alright","healthy","italian","principal","tired","efficient","comfortable","chinese","relative","friendly","conventional","willing","sudden","proposed","voluntary","slight","valuable","dramatic","golden","temporary","federal","keen","flat","silent","indian","worried","pale","statutory","welsh","dependent","firm","wet","competitive","armed","radical","outside","acceptable","sensitive","living","pure","global","emotional","sad","secret","rapid","adequate","fixed","sweet","administrative","wooden","remarkable","comprehensive","surprising","solid","rough","mere","mass","brilliant","maximum","absolute","electronic","visual","electric","cool","spanish","literary","continuing","supreme","chemical","genuine","exciting","written","advanced","extreme","classical","fit","favourite","widespread","confident","straight","proud","numerous","opposite","distinct","mad","helpful","given","disabled","consistent","anxious","nervous","awful","stable","constitutional","satisfied","conscious","developing","strategic","holy","smooth","dominant","remote","theoretical","outstanding","pink","pretty","clinical","minimum","honest","impressive","related","residential","extraordinary","plain","visible","accurate","distant","still","greek","complicated","musical","precise","gentle","broken","live","silly","fat","tight","monetary","round","psychological","violent","unemployed","inevitable","junior","sensible","grateful","pleasant","dirty","structural","welcome","deaf","above","continuous","blind","overseas","mean","entitled","delighted","loose","occasional","evident","desperate","fellow","universal","square","steady","classic","equivalent","intellectual","victorian","level","ultimate","creative","lost","medieval","clever","linguistic","convinced","judicial","raw","sophisticated","asleep","vulnerable","illegal","outer","revolutionary","bitter","changing","australian","native","imperial","strict","wise","informal","flexible","collective","frequent","experimental","spiritual","intense","rational","generous","inadequate","prominent","logical","bare","historic","modest","dutch","acute","electrical","valid","weekly","gross","automatic","loud","reliable","mutual","liable","multiple","ruling","curious","sole","managing","pregnant","latin","nearby","exact","underlying","identical","satisfactory","marginal","distinctive","electoral","urgent","presidential","controversial","everyday","encouraging","organic","continued","expected","statistical","desirable","innocent","improved","exclusive","marked","experienced","unexpected","superb","sheer","disappointed","frightened","gastric","romantic","naked","reluctant","magnificent","convenient","established","closed","uncertain","artificial","diplomatic","tremendous","marine","mechanical","retail","institutional","mixed","required","biological","known","functional","straightforward","superior","digital","spectacular","unhappy","confused","unfair","aggressive","spare","painful","abstract","asian","associated","legislative","monthly","intelligent","hungry","explicit","nasty","just","faint","coloured","ridiculous","amazing","comparable","successive","realistic","back","decent","decentralized","bitcoin","cypherpunk","unnecessary","flying","random","influential","dull","genetic","neat","marvellous","crazy","damp","giant","secure","bottom","skilled","subtle","elegant","brave","lesser","parallel","steep","intensive","casual","tropical","lonely","partial","preliminary","concrete","alleged","assistant","vertical","upset","delicate","mild","occupational","excessive","progressive","exceptional","integrated","striking","continental","okay","harsh","combined","fierce","handsome","characteristic","chronic","compulsory","interim","objective","splendid","magic","systematic","obliged","payable","fun","horrible","primitive","fascinating","ideological","metropolitan","surrounding","estimated","peaceful","premier","operational","technological","kind","advisory","hostile","precious","accessible","determined","excited","impressed","provincial","smart","endless","isolated","drunk","geographical","like","dynamic","boring","forthcoming","unfortunate","definite","super","notable","indirect","stiff","wealthy","awkward","lively","neutral","artistic","content","mature","colonial","ambitious","evil","magnetic","verbal","legitimate","sympathetic","empirical","head","shallow","vague","naval","depressed","shared","added","shocked","mid","worthwhile","qualified","missing","blank","absent","favourable","polish","israeli","developed","profound","representative","enthusiastic","dreadful","rigid","reduced","cruel","coastal","peculiar","swiss","crude","extended","selected","eager","canadian","bold","relaxed","corresponding","running","planned","applicable","immense","allied","comparative","uncomfortable","conservation","productive","beneficial","bored","charming","minimal","mobile","turkish","orange","rear","passive","suspicious","overwhelming","fatal","resulting","symbolic","registered","neighbouring","calm","irrelevant","patient","compact","profitable","rival","loyal","moderate","distinguished","interior","noble","insufficient","eligible","mysterious","varying","managerial","molecular","olympic","linear","prospective","printed","parental","diverse","elaborate","furious","fiscal","burning","useless","semantic","embarrassed","inherent","philosophical","deliberate","awake","variable","promising","unpleasant","varied","sacred","selective","inclined","tender","hidden","worthy","intermediate","sound","protective","fortunate","slim","defensive","divine","stuck","driving","invisible","misleading","circular","mathematical","inappropriate","liquid","persistent","solar","doubtful","manual","architectural","intact","incredible","devoted","prior","tragic","respectable","optimistic","convincing","unacceptable","decisive","competent","spatial","respective","binding","relieved","nursing","toxic","select","redundant","integral","then","probable","amateur","fond","passing","specified","territorial","horizontal","inland","cognitive","regulatory","miserable","resident","polite","scared","gothic","civilian","instant","lengthy","adverse","korean","unconscious","anonymous","aesthetic","orthodox","static","unaware","costly","fantastic","foolish","fashionable","causal","compatible","wee","implicit","dual","ok","cheerful","subjective","forward","surviving","exotic","purple","cautious","visiting","aggregate","ethical","teenage","dying","disastrous","delicious","confidential","underground","thorough","grim","autonomous","atomic","frozen","colourful","injured","uniform","ashamed","glorious","wicked","coherent","rising","shy","novel","balanced","delightful","arbitrary","adjacent","worrying","weird","unchanged","rolling","evolutionary","intimate","sporting","disciplinary","formidable","lexical","noisy","gradual","accused","homeless","supporting","coming","renewed","excess","retired","rubber","chosen","outdoor","embarrassing","preferred","bizarre","appalling","agreed","imaginative","governing","accepted","vocational","mighty","puzzled","worldwide","organisational","sunny","eldest","eventual","spontaneous","vivid","rude","faithful","ministerial","innovative","controlled","conceptual","unwilling","civic","meaningful","alive","brainy","breakable","busy","careful","cautious","clever","concerned","crazy","curious","dead","different","difficult","doubtful","easy","famous","fragile","helpful","helpless","important","impossible","innocent","inquisitive","modern","open","outstanding","poor","powerful","puzzled","real","rich","shy","sleepy","super","tame","uninterested","wandering","wild","wrong","adorable","alert","average","beautiful","blonde","bloody","blushing","bright","clean","clear","cloudy","colorful","crowded","cute","dark","drab","distinct","dull","elegant","fancy","filthy","glamorous","gleaming","graceful","grotesque","homely","light","misty","motionless","muddy","plain","poised","quaint","shiny","smoggy","sparkling","spotless","stormy","strange","ugly","unsightly","unusual","bad","better","beautiful","big","black","blue","bright","clumsy","crazy","dizzy","dull","fat","frail","friendly","funny","great","green","gigantic","gorgeous","grumpy","handsome","happy","horrible","itchy","jittery","jolly","kind","long","lazy","magnificent","magenta","many","mighty","mushy","nasty","new","nice","nosy","nutty","nutritious","odd","orange","ordinary","pretty","precious","prickly","purple","quaint","quiet","quick","quickest","rainy","rare","ratty","red","roasted","robust","round","sad","scary","scrawny","short","silly","stingy","strange","striped","spotty","tart","tall","tame","tan","tender","testy","tricky","tough","ugly","ugliest","vast","watery","wasteful","wonderful","yellow","yummy","zany"]');function Ao(n){return typeof n!="string"?"":n.charAt(0).toUpperCase()+n.slice(1)}function ba(n){if(!n)throw new Error("No seed provided");const e=new TextEncoder,t=Dc(e.encode(n)),s=go[t[0]%go.length],r=po[t[1]%po.length];return`${Ao(s)} ${Ao(r)}`}const Fo=9,Ld=95,Nd=45,vo=5;function zd(n){return n.split("").reduce((e,t)=>(e^t.charCodeAt(0))*-vo,vo)>>>2}function ka(n="",e=Ld,t=Nd,s=zd){const r=s(n),x=r%Fo*(360/Fo);return[...Array(n?25:0)].reduce((o,i,a)=>r&1<<a%15?o+`<rect x="${a>14?7-~~(a/5):~~(a/5)}" y="${a%5}" width="1" height="1"/>`:o,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${x} ${e}% ${t}%)">`)+"</svg>"}var hi,v0,gr,ks,_s,Vn,Ei;(hi=globalThis.customElements)!=null&&hi.get("minidenticon-svg")||(Ei=globalThis.customElements)==null||Ei.define("minidenticon-svg",(v0=class extends HTMLElement{constructor(){super(...arguments);qs(this,_s);qs(this,ks,!1)}connectedCallback(){qr(this,_s,Vn).call(this),Yx(this,ks,!0)}attributeChangedCallback(){jr(this,ks)&&qr(this,_s,Vn).call(this)}},gr=new WeakMap,ks=new WeakMap,_s=new WeakSet,Vn=function(){var r;const t=v0.observedAttributes.map(x=>this.getAttribute(x)||void 0),s=t.join(",");this.innerHTML=(r=jr(v0,gr))[s]??(r[s]=ka(...t))},q(v0,"observedAttributes",["username","saturation","lightness"]),qs(v0,gr,{}),v0));var Kd=U('<div><img alt=""/></div>');function yo(n,e){Oe(e,!0);let t=it(e,"size",3,40),s=it(e,"saturation",3,50),r=it(e,"lightness",3,50),x=it(e,"class",3,""),o=L(()=>"data:image/svg+xml;utf8,"+encodeURIComponent(ka(e.seed,s(),r())));var i=Kd(),a=b(i);Q(()=>{Be(i,1,`rounded-full flex items-center justify-center shrink-0 bg-surface-3 ${x()??""}`),ds(i,`width: ${t()??""}px; height: ${t()??""}px;`),Ce(a,"src",c(o)),Ce(a,"width",t()*.7),Ce(a,"height",t()*.7)}),M(n,i),He()}var $d=U('<span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></span>');function Gn(n,e){Oe(e,!0);const t=()=>_e(ce,"$nostrStore",r),s=()=>_e(D0,"$socialGraphStore",r),[r,x]=mt();let o=it(e,"size",3,"md"),i=it(e,"class",3,"");const a={sm:{badge:"w-3 h-3",icon:8},md:{badge:"w-4 h-4",icon:10},lg:{badge:"w-5 h-5",icon:12}};let d=L(()=>t().pubkey),l=L(()=>!!c(d)),u=L(()=>(s().version,aa(e.pubKeyHex))),f=L(()=>(s().version,ca(e.pubKeyHex))),h=L(()=>c(l)&&e.pubKeyHex&&c(u)<=2),B=L(()=>{if(c(u)===0)return"You";if(c(u)===1)return"Following";const E=c(f).size;return`Followed by ${E} friend${E!==1?"s":""}`}),A=L(()=>c(u)===0||c(u)===1?"bg-blue-500":c(f).size>10?"bg-purple-500":"bg-gray-500"),D=L(()=>a[o()]);var v=Ie(),m=ge(v);{var C=E=>{var F=$d(),g=b(F);Q(()=>{Be(F,1,`rounded-full flex items-center justify-center ${c(D).badge??""} text-white ${c(A)??""} ${i()??""}`),Ce(F,"title",c(B)),Ce(g,"width",c(D).icon),Ce(g,"height",c(D).icon)}),M(E,F)};$(m,E=>{c(h)&&E(C)})}M(n,v),He(),x()}var Od=U("<img/>"),Hd=U("<div><!></div>"),jd=U('<div class="relative inline-block"><!> <!></div>'),qd=U("<img/>"),Vd=U("<div><!></div>");function Is(n,e){Oe(e,!0);const t=()=>_e(c(a),"$profileStore",s),[s,r]=mt();let x=it(e,"size",3,40),o=it(e,"class",3,""),i=it(e,"showBadge",3,!1),a=L(()=>e.pubkey?Sx(e.pubkey):null),d=L(()=>c(a)?t():null),l=ee(!1);$e(()=>{e.pubkey,T(l,!1)});let u=L(()=>wa(c(d),e.pubkey)||(e.pubkey?ba(e.pubkey):""));function f(C){return C<=32?"sm":C<=48?"md":"lg"}let h=L(()=>f(x())),B=L(()=>{var C;return((C=c(d))==null?void 0:C.picture)&&!c(l)});var A=Ie(),D=ge(A);{var v=C=>{var E=jd(),F=b(E);{var g=w=>{var _=Od();Q(()=>{Ce(_,"src",c(d).picture),Ce(_,"alt",c(u)),Ce(_,"title",c(u)),Ce(_,"width",x()),Ce(_,"height",x()),Be(_,1,`rounded-full object-cover ${o()??""}`)}),T0("error",_,()=>T(l,!0)),M(w,_)},p=w=>{var _=Hd(),S=b(_);yo(S,{get seed(){return e.pubkey},get size(){return x()},get class(){return o()}}),Q(()=>Ce(_,"title",c(u))),M(w,_)};$(F,w=>{c(B)?w(g):w(p,!1)})}var y=k(F,2);Gn(y,{get pubKeyHex(){return e.pubkey},get size(){return c(h)},class:"absolute -top-0.5 -right-0.5"}),M(C,E)},m=C=>{var E=Ie(),F=ge(E);{var g=y=>{var w=qd();Q(()=>{Ce(w,"src",c(d).picture),Ce(w,"alt",c(u)),Ce(w,"title",c(u)),Ce(w,"width",x()),Ce(w,"height",x()),Be(w,1,`rounded-full object-cover ${o()??""}`)}),T0("error",w,()=>T(l,!0)),M(y,w)},p=y=>{var w=Vd(),_=b(w);yo(_,{get seed(){return e.pubkey},get size(){return x()},get class(){return o()}}),Q(()=>Ce(w,"title",c(u))),M(y,w)};$(F,y=>{c(B)?y(g):y(p,!1)},!0)}M(C,E)};$(D,C=>{i()?C(v):C(m,!1)})}M(n,A),He(),r()}var Gd=U("<div>Not followed by anyone you follow</div>"),Wd=U("<div>Followed by friends of friends</div>"),Yd=U('<a class="rounded-full ring-2 ring-surface-0 hover:z-10"><!></a>'),Qd=U("<span>and</span>"),Jd=U("<span>,</span>"),Xd=U('<!> <a class="text-text-1 hover:underline"><!></a>',1),Zd=U("<span> </span>"),e9=U('<div><div class="flex -space-x-2"></div> <div class="text-sm text-text-2 min-w-0 truncate"><span>Followed by</span> <!> <!></div></div>');function t9(n,e){Oe(e,!0);const t=()=>_e(ce,"$nostrStore",r),s=()=>_e(D0,"$socialGraphStore",r),[r,x]=mt(),o=3,i=3;let a=it(e,"class",3,""),d=L(()=>t().pubkey),l=L(()=>(s().version,aa(e.pubkey))),u=L(()=>(s().version,ca(e.pubkey))),f=L(()=>Array.from(c(u)).slice(0,o)),h=L(()=>c(u).size),B=L(()=>e.pubkey===c(d));function A(C){try{return Ke.npubEncode(C)}catch{return C}}var D=Ie(),v=ge(D);{var m=C=>{var E=Ie(),F=ge(E);{var g=y=>{var w=Ie(),_=ge(w);{var S=I=>{var R=Gd();Q(()=>Be(R,1,`text-sm text-text-2 ${a()??""}`)),M(I,R)},P=I=>{var R=Ie(),z=ge(R);{var K=O=>{var j=Wd();Q(()=>Be(j,1,`text-sm text-text-2 ${a()??""}`)),M(O,j)};$(z,O=>{c(l)===3&&O(K)},!0)}M(I,R)};$(_,I=>{c(l)===2?I(S):I(P,!1)})}M(y,w)},p=y=>{var w=e9(),_=b(w);Tt(_,20,()=>c(f),z=>z,(z,K)=>{var O=Yd(),j=b(O);Is(j,{get pubkey(){return K},size:24}),Q(W=>Ce(O,"href",`#/${W??""}`),[()=>A(K)]),M(z,O)});var S=k(_,2),P=k(b(S),2);Tt(P,18,()=>c(f).slice(0,i),z=>z,(z,K,O)=>{var j=Xd(),W=ge(j);{var J=le=>{var re=Ie(),Se=ge(re);{var de=xe=>{var ue=Qd();M(xe,ue)},ae=xe=>{var ue=Jd();M(xe,ue)};$(Se,xe=>{c(O)===c(f).length-1||c(O)===i-1?xe(de):xe(ae,!1)})}M(le,re)};$(W,le=>{c(O)>0&&le(J)})}var G=k(W,2),oe=b(G);Px(oe,{get pubkey(){return K}}),Q(le=>Ce(G,"href",`#/${le??""}`),[()=>A(K)]),M(z,j)});var I=k(P,2);{var R=z=>{var K=Zd(),O=b(K);Q(()=>V(O,`and ${c(h)-i} other${c(h)-i!==1?"s":""}`)),M(z,K)};$(I,z=>{c(h)>i&&z(R)})}Q(()=>Be(w,1,`flex items-center gap-2 ${a()??""}`)),M(y,w)};$(F,y=>{c(h)===0?y(g):y(p,!1)})}M(C,E)};$(v,C=>{c(B)||C(m)})}M(n,D),He(),x()}var s9=U("<span> </span>"),r9=U("<span> </span>");function Px(n,e){Oe(e,!0);const t=()=>_e(c(o),"$profileStore",s),[s,r]=mt();let x=it(e,"class",3,""),o=L(()=>e.pubkey?Sx(e.pubkey):null),i=L(()=>c(o)?t():null),a=L(()=>wa(c(i),e.pubkey)),d=L(()=>e.pubkey?ba(e.pubkey):"");var l=Ie(),u=ge(l);{var f=B=>{var A=s9(),D=b(A);Q(()=>{Be(A,1,`truncate ${x()??""}`),V(D,c(a))}),M(B,A)},h=B=>{var A=r9(),D=b(A);Q(()=>{Be(A,1,`truncate italic opacity-70 ${x()??""}`),V(D,c(d))}),M(B,A)};$(u,B=>{c(a)?B(f):B(h,!1)})}M(n,l),He(),r()}var n9=U('<span class="text-xs text-muted truncate"> </span>'),x9=U('<div><!> <div class="flex flex-col min-w-0"><!> <!></div></div>');function q0(n,e){let t=it(e,"avatarSize",3,36),s=it(e,"showBadge",3,!0),r=it(e,"class",3,"");var x=x9(),o=b(x);Is(o,{get pubkey(){return e.pubkey},get size(){return t()},get showBadge(){return s()}});var i=k(o,2),a=b(i);Px(a,{get pubkey(){return e.pubkey},class:"text-sm"});var d=k(a,2);{var l=u=>{var f=n9(),h=b(f);Q(()=>V(h,e.description)),M(u,f)};$(d,u=>{e.description&&u(l)})}Q(()=>Be(x,1,`flex items-center gap-3 ${r()??""}`)),M(n,x)}var o9=U('<button class="bg-transparent border-none cursor-pointer p-0 hover:opacity-80" title="My Profile (double-click for users)"><!></button>'),i9=U('<div class="flex gap-2"><input type="password" placeholder="nsec1..." class="flex-1 input text-sm"/> <button class="btn-success text-sm">Login</button></div>'),a9=U('<p class="text-danger text-sm m-0"> </p>'),c9=U('<div class="flex flex-col gap-2"><div class="flex gap-1 md:gap-2 flex-wrap"><button class="btn-success text-xs md:text-sm"><span class="hidden md:inline">Login (Extension)</span> <span class="md:hidden">Login</span></button> <button class="btn-ghost text-xs md:text-sm hidden md:block"> </button> <button class="btn-ghost text-xs md:text-sm hidden md:block">New</button></div> <!> <!></div>');function l9(n,e){Oe(e,!0);const t=()=>_e(ce,"$nostrStore",s),[s,r]=mt();let x=ee(!1),o=ee(""),i=ee(""),a=L(()=>t().isLoggedIn),d=L(()=>t().npub),l=L(()=>t().pubkey);function u(){c(d)&&I0(`/${c(d)}/profile`)}async function f(){T(i,""),await Er()||T(i,"Extension login failed. Is a nostr extension installed?")}function h(){if(T(i,""),!c(o).trim()){T(i,"Please enter an nsec");return}Br(c(o).trim())?(T(o,""),T(x,!1)):T(i,"Invalid nsec")}function B(){T(i,""),kx()}var A=Ie(),D=ge(A);{var v=C=>{var E=o9();E.__click=u,E.__dblclick=()=>I0("/users");var F=b(E);Is(F,{get pubkey(){return c(l)},size:32}),M(C,E)},m=C=>{var E=c9(),F=b(E),g=b(F);g.__click=f;var p=k(g,2);p.__click=()=>T(x,!c(x));var y=b(p),w=k(p,2);w.__click=B;var _=k(F,2);{var S=R=>{var z=i9(),K=b(z),O=k(K,2);O.__click=h,fs(K,()=>c(o),j=>T(o,j)),M(R,z)};$(_,R=>{c(x)&&R(S)})}var P=k(_,2);{var I=R=>{var z=a9(),K=b(z);Q(()=>V(K,c(i))),M(R,z)};$(P,R=>{c(i)&&R(I)})}Q(()=>V(y,c(x)?"Cancel":"nsec")),M(C,E)};$(D,C=>{c(a)&&c(l)?C(v):C(m,!1)})}M(n,A),He(),r()}wt(["click","dblclick"]);var u9=U('<span class="text-[10px] text-danger -mt-0.5">offline</span>'),d9=U('<a href="#/settings" class="flex flex-col items-center px-2 py-1 text-sm no-underline"><div class="flex items-center gap-1.5"><span data-testid="peer-indicator-dot" class="i-lucide-wifi"></span> <span data-testid="peer-count"> </span></div> <!></a>');function f9(n,e){Oe(e,!0);const t=()=>_e(e0,"$appStore",r),s=()=>_e(ce,"$nostrStore",r),[r,x]=mt();let o=L(()=>t().peerCount),i=L(()=>t().peers),a=L(()=>s().connectedRelays),d=L(()=>s().isLoggedIn),l=L(()=>c(i).filter(g=>g.pool==="follows"&&g.state==="connected").length),u=ee(t0(typeof navigator<"u"?navigator.onLine:!0));$e(()=>{const g=()=>{T(u,!0)},p=()=>{T(u,!1)};return window.addEventListener("online",g),window.addEventListener("offline",p),()=>{window.removeEventListener("online",g),window.removeEventListener("offline",p)}});let f=L(()=>!c(u)||!c(d)||c(a)===0?"#f85149":c(o)===0?"#d29922":c(l)>0?"#58a6ff":"#3fb950"),h=L(()=>c(u)?c(d)?c(a)===0?"No relays connected":c(o)===0?`${c(a)} relay${c(a)!==1?"s":""}, no peers`:c(l)>0?`${c(l)} follow${c(l)!==1?"s":""}, ${c(o)-c(l)} other, ${c(a)} relay${c(a)!==1?"s":""}`:`${c(o)} peer${c(o)!==1?"s":""}, ${c(a)} relay${c(a)!==1?"s":""}`:"Not connected":"Offline"),B=L(()=>c(a)+c(o));var A=d9(),D=b(A),v=b(D),m=k(v,2),C=b(m),E=k(D,2);{var F=g=>{var p=u9();M(g,p)};$(E,g=>{c(u)||g(F)})}Q(()=>{Ce(A,"title",c(h)),ds(v,`color: ${c(f)??""}`),ds(m,`color: ${c(f)??""}`),V(C,c(B))}),M(n,A),He(),x()}function b0(n){return Array.isArray?Array.isArray(n):Pa(n)==="[object Array]"}function h9(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function E9(n){return n==null?"":h9(n)}function d0(n){return typeof n=="string"}function _a(n){return typeof n=="number"}function B9(n){return n===!0||n===!1||C9(n)&&Pa(n)=="[object Boolean]"}function Sa(n){return typeof n=="object"}function C9(n){return Sa(n)&&n!==null}function Jt(n){return n!=null}function nn(n){return!n.trim().length}function Pa(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const p9="Incorrect 'index' type",g9=n=>`Invalid value for key ${n}`,A9=n=>`Pattern length exceeds max of ${n}.`,F9=n=>`Missing ${n} property in key`,v9=n=>`Property 'weight' in key '${n}' must be a positive integer`,Do=Object.prototype.hasOwnProperty;class y9{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let r=Ta(s);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ta(n){let e=null,t=null,s=null,r=1,x=null;if(d0(n)||b0(n))s=n,e=mo(n),t=Wn(n);else{if(!Do.call(n,"name"))throw new Error(F9("name"));const o=n.name;if(s=o,Do.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(v9(o));e=mo(o),t=Wn(o),x=n.getFn}return{path:e,id:t,weight:r,src:s,getFn:x}}function mo(n){return b0(n)?n:n.split(".")}function Wn(n){return b0(n)?n.join("."):n}function D9(n,e){let t=[],s=!1;const r=(x,o,i)=>{if(Jt(x))if(!o[i])t.push(x);else{let a=o[i];const d=x[a];if(!Jt(d))return;if(i===o.length-1&&(d0(d)||_a(d)||B9(d)))t.push(E9(d));else if(b0(d)){s=!0;for(let l=0,u=d.length;l<u;l+=1)r(d[l],o,i+1)}else o.length&&r(d,o,i+1)}};return r(n,d0(e)?e.split("."):e,0),s?t:t[0]}const m9={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},w9={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},b9={location:0,threshold:.6,distance:100},k9={useExtendedSearch:!1,getFn:D9,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ie={...w9,...m9,...b9,...k9};const _9=/[^ ]+/g;function S9(n=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(r){const x=r.match(_9).length;if(t.has(x))return t.get(x);const o=1/Math.pow(x,.5*n),i=parseFloat(Math.round(o*s)/s);return t.set(x,i),i},clear(){t.clear()}}}class Tx{constructor({getFn:e=ie.getFn,fieldNormWeight:t=ie.fieldNormWeight}={}){this.norm=S9(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,d0(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();d0(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!Jt(e)||nn(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((r,x)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Jt(o)){if(b0(o)){let i=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:d,value:l}=a.pop();if(Jt(l))if(d0(l)&&!nn(l)){let u={v:l,i:d,n:this.norm.get(l)};i.push(u)}else b0(l)&&l.forEach((u,f)=>{a.push({nestedArrIndex:f,value:u})})}s.$[x]=i}else if(d0(o)&&!nn(o)){let i={v:o,n:this.norm.get(o)};s.$[x]=i}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function Ma(n,e,{getFn:t=ie.getFn,fieldNormWeight:s=ie.fieldNormWeight}={}){const r=new Tx({getFn:t,fieldNormWeight:s});return r.setKeys(n.map(Ta)),r.setSources(e),r.create(),r}function P9(n,{getFn:e=ie.getFn,fieldNormWeight:t=ie.fieldNormWeight}={}){const{keys:s,records:r}=n,x=new Tx({getFn:e,fieldNormWeight:t});return x.setKeys(s),x.setIndexRecords(r),x}function Xs(n,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:r=ie.distance,ignoreLocation:x=ie.ignoreLocation}={}){const o=e/n.length;if(x)return o;const i=Math.abs(s-t);return r?o+i/r:i?1:o}function T9(n=[],e=ie.minMatchCharLength){let t=[],s=-1,r=-1,x=0;for(let o=n.length;x<o;x+=1){let i=n[x];i&&s===-1?s=x:!i&&s!==-1&&(r=x-1,r-s+1>=e&&t.push([s,r]),s=-1)}return n[x-1]&&x-s>=e&&t.push([s,x-1]),t}const j0=32;function M9(n,e,t,{location:s=ie.location,distance:r=ie.distance,threshold:x=ie.threshold,findAllMatches:o=ie.findAllMatches,minMatchCharLength:i=ie.minMatchCharLength,includeMatches:a=ie.includeMatches,ignoreLocation:d=ie.ignoreLocation}={}){if(e.length>j0)throw new Error(A9(j0));const l=e.length,u=n.length,f=Math.max(0,Math.min(s,u));let h=x,B=f;const A=i>1||a,D=A?Array(u):[];let v;for(;(v=n.indexOf(e,B))>-1;){let p=Xs(e,{currentLocation:v,expectedLocation:f,distance:r,ignoreLocation:d});if(h=Math.min(p,h),B=v+l,A){let y=0;for(;y<l;)D[v+y]=1,y+=1}}B=-1;let m=[],C=1,E=l+u;const F=1<<l-1;for(let p=0;p<l;p+=1){let y=0,w=E;for(;y<w;)Xs(e,{errors:p,currentLocation:f+w,expectedLocation:f,distance:r,ignoreLocation:d})<=h?y=w:E=w,w=Math.floor((E-y)/2+y);E=w;let _=Math.max(1,f-w+1),S=o?u:Math.min(f+w,u)+l,P=Array(S+2);P[S+1]=(1<<p)-1;for(let R=S;R>=_;R-=1){let z=R-1,K=t[n.charAt(z)];if(A&&(D[z]=+!!K),P[R]=(P[R+1]<<1|1)&K,p&&(P[R]|=(m[R+1]|m[R])<<1|1|m[R+1]),P[R]&F&&(C=Xs(e,{errors:p,currentLocation:z,expectedLocation:f,distance:r,ignoreLocation:d}),C<=h)){if(h=C,B=z,B<=f)break;_=Math.max(1,2*f-B)}}if(Xs(e,{errors:p+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:d})>h)break;m=P}const g={isMatch:B>=0,score:Math.max(.001,C)};if(A){const p=T9(D,i);p.length?a&&(g.indices=p):g.isMatch=!1}return g}function I9(n){let e={};for(let t=0,s=n.length;t<s;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<s-t-1}return e}const Cr=String.prototype.normalize?(n=>n.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(n=>n);class Ia{constructor(e,{location:t=ie.location,threshold:s=ie.threshold,distance:r=ie.distance,includeMatches:x=ie.includeMatches,findAllMatches:o=ie.findAllMatches,minMatchCharLength:i=ie.minMatchCharLength,isCaseSensitive:a=ie.isCaseSensitive,ignoreDiacritics:d=ie.ignoreDiacritics,ignoreLocation:l=ie.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:x,findAllMatches:o,minMatchCharLength:i,isCaseSensitive:a,ignoreDiacritics:d,ignoreLocation:l},e=a?e:e.toLowerCase(),e=d?Cr(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const u=(h,B)=>{this.chunks.push({pattern:h,alphabet:I9(h),startIndex:B})},f=this.pattern.length;if(f>j0){let h=0;const B=f%j0,A=f-B;for(;h<A;)u(this.pattern.substr(h,j0),h),h+=j0;if(B){const D=f-j0;u(this.pattern.substr(D),D)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?Cr(e):e,this.pattern===e){let A={isMatch:!0,score:0};return r&&(A.indices=[[0,e.length-1]]),A}const{location:x,distance:o,threshold:i,findAllMatches:a,minMatchCharLength:d,ignoreLocation:l}=this.options;let u=[],f=0,h=!1;this.chunks.forEach(({pattern:A,alphabet:D,startIndex:v})=>{const{isMatch:m,score:C,indices:E}=M9(e,A,D,{location:x+v,distance:o,threshold:i,findAllMatches:a,minMatchCharLength:d,includeMatches:r,ignoreLocation:l});m&&(h=!0),f+=C,m&&E&&(u=[...u,...E])});let B={isMatch:h,score:h?f/this.chunks.length:1};return h&&r&&(B.indices=u),B}}class U0{constructor(e){this.pattern=e}static isMultiMatch(e){return wo(e,this.multiRegex)}static isSingleMatch(e){return wo(e,this.singleRegex)}search(){}}function wo(n,e){const t=n.match(e);return t?t[1]:null}class R9 extends U0{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class U9 extends U0{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class L9 extends U0{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class N9 extends U0{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class z9 extends U0{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class K9 extends U0{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Ra extends U0{constructor(e,{location:t=ie.location,threshold:s=ie.threshold,distance:r=ie.distance,includeMatches:x=ie.includeMatches,findAllMatches:o=ie.findAllMatches,minMatchCharLength:i=ie.minMatchCharLength,isCaseSensitive:a=ie.isCaseSensitive,ignoreDiacritics:d=ie.ignoreDiacritics,ignoreLocation:l=ie.ignoreLocation}={}){super(e),this._bitapSearch=new Ia(e,{location:t,threshold:s,distance:r,includeMatches:x,findAllMatches:o,minMatchCharLength:i,isCaseSensitive:a,ignoreDiacritics:d,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Ua extends U0{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const r=[],x=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+x,r.push([s,t-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const Yn=[R9,Ua,L9,N9,K9,z9,U9,Ra],bo=Yn.length,$9=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,O9="|";function H9(n,e={}){return n.split(O9).map(t=>{let s=t.trim().split($9).filter(x=>x&&!!x.trim()),r=[];for(let x=0,o=s.length;x<o;x+=1){const i=s[x];let a=!1,d=-1;for(;!a&&++d<bo;){const l=Yn[d];let u=l.isMultiMatch(i);u&&(r.push(new l(u,e)),a=!0)}if(!a)for(d=-1;++d<bo;){const l=Yn[d];let u=l.isSingleMatch(i);if(u){r.push(new l(u,e));break}}}return r})}const j9=new Set([Ra.type,Ua.type]);class q9{constructor(e,{isCaseSensitive:t=ie.isCaseSensitive,ignoreDiacritics:s=ie.ignoreDiacritics,includeMatches:r=ie.includeMatches,minMatchCharLength:x=ie.minMatchCharLength,ignoreLocation:o=ie.ignoreLocation,findAllMatches:i=ie.findAllMatches,location:a=ie.location,threshold:d=ie.threshold,distance:l=ie.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:x,findAllMatches:i,ignoreLocation:o,location:a,threshold:d,distance:l},e=t?e:e.toLowerCase(),e=s?Cr(e):e,this.pattern=e,this.query=H9(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:x}=this.options;e=r?e:e.toLowerCase(),e=x?Cr(e):e;let o=0,i=[],a=0;for(let d=0,l=t.length;d<l;d+=1){const u=t[d];i.length=0,o=0;for(let f=0,h=u.length;f<h;f+=1){const B=u[f],{isMatch:A,indices:D,score:v}=B.search(e);if(A){if(o+=1,a+=v,s){const m=B.constructor.type;j9.has(m)?i=[...i,...D]:i.push(D)}}else{a=0,o=0,i.length=0;break}}if(o){let f={isMatch:!0,score:a/o};return s&&(f.indices=i),f}}return{isMatch:!1,score:1}}}const Qn=[];function V9(...n){Qn.push(...n)}function Jn(n,e){for(let t=0,s=Qn.length;t<s;t+=1){let r=Qn[t];if(r.condition(n,e))return new r(n,e)}return new Ia(n,e)}const pr={AND:"$and",OR:"$or"},Xn={PATH:"$path",PATTERN:"$val"},Zn=n=>!!(n[pr.AND]||n[pr.OR]),G9=n=>!!n[Xn.PATH],W9=n=>!b0(n)&&Sa(n)&&!Zn(n),ko=n=>({[pr.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function La(n,e,{auto:t=!0}={}){const s=r=>{let x=Object.keys(r);const o=G9(r);if(!o&&x.length>1&&!Zn(r))return s(ko(r));if(W9(r)){const a=o?r[Xn.PATH]:x[0],d=o?r[Xn.PATTERN]:r[a];if(!d0(d))throw new Error(g9(a));const l={keyId:Wn(a),pattern:d};return t&&(l.searcher=Jn(d,e)),l}let i={children:[],operator:x[0]};return x.forEach(a=>{const d=r[a];b0(d)&&d.forEach(l=>{i.children.push(s(l))})}),i};return Zn(n)||(n=ko(n)),s(n)}function Y9(n,{ignoreFieldNorm:e=ie.ignoreFieldNorm}){n.forEach(t=>{let s=1;t.matches.forEach(({key:r,norm:x,score:o})=>{const i=r?r.weight:null;s*=Math.pow(o===0&&i?Number.EPSILON:o,(i||1)*(e?1:x))}),t.score=s})}function Q9(n,e){const t=n.matches;e.matches=[],Jt(t)&&t.forEach(s=>{if(!Jt(s.indices)||!s.indices.length)return;const{indices:r,value:x}=s;let o={indices:r,value:x};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function J9(n,e){e.score=n.score}function X9(n,e,{includeMatches:t=ie.includeMatches,includeScore:s=ie.includeScore}={}){const r=[];return t&&r.push(Q9),s&&r.push(J9),n.map(x=>{const{idx:o}=x,i={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(x,i)}),i})}class es{constructor(e,t={},s){this.options={...ie,...t},this.options.useExtendedSearch,this._keyStore=new y9(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof Tx))throw new Error(p9);this._myIndex=t||Ma(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Jt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const x=this._docs[s];e(x,s)&&(this.removeAt(s),s-=1,r-=1,t.push(x))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:x,sortFn:o,ignoreFieldNorm:i}=this.options;let a=d0(e)?d0(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Y9(a,{ignoreFieldNorm:i}),x&&a.sort(o),_a(t)&&t>-1&&(a=a.slice(0,t)),X9(a,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=Jn(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:x,i:o,n:i})=>{if(!Jt(x))return;const{isMatch:a,score:d,indices:l}=t.searchIn(x);a&&r.push({item:x,idx:o,matches:[{score:d,value:x,norm:i,indices:l}]})}),r}_searchLogical(e){const t=La(e,this.options),s=(i,a,d)=>{if(!i.children){const{keyId:u,searcher:f}=i,h=this._findMatches({key:this._keyStore.get(u),value:this._myIndex.getValueForItemAtKeyId(a,u),searcher:f});return h&&h.length?[{idx:d,item:a,matches:h}]:[]}const l=[];for(let u=0,f=i.children.length;u<f;u+=1){const h=i.children[u],B=s(h,a,d);if(B.length)l.push(...B);else if(i.operator===pr.AND)return[]}return l},r=this._myIndex.records,x={},o=[];return r.forEach(({$:i,i:a})=>{if(Jt(i)){let d=s(t,i,a);d.length&&(x[a]||(x[a]={idx:a,item:i,matches:[]},o.push(x[a])),d.forEach(({matches:l})=>{x[a].matches.push(...l)}))}}),o}_searchObjectList(e){const t=Jn(e,this.options),{keys:s,records:r}=this._myIndex,x=[];return r.forEach(({$:o,i})=>{if(!Jt(o))return;let a=[];s.forEach((d,l)=>{a.push(...this._findMatches({key:d,value:o[l],searcher:t}))}),a.length&&x.push({idx:i,item:o,matches:a})}),x}_findMatches({key:e,value:t,searcher:s}){if(!Jt(t))return[];let r=[];if(b0(t))t.forEach(({v:x,i:o,n:i})=>{if(!Jt(x))return;const{isMatch:a,score:d,indices:l}=s.searchIn(x);a&&r.push({score:d,key:e,value:x,idx:o,norm:i,indices:l})});else{const{v:x,n:o}=t,{isMatch:i,score:a,indices:d}=s.searchIn(x);i&&r.push({score:a,key:e,value:x,norm:o,indices:d})}return r}}es.version="7.1.0";es.createIndex=Ma;es.parseIndex=P9;es.config=ie;es.parseQuery=La;V9(q9);var Z9=U("<button><!></button>"),e8=U('<div class="absolute top-full left-0 right-0 mt-1 bg-surface-2 rounded border border-surface-3 shadow-lg z-50 max-h-64 overflow-auto"></div>'),t8=U('<div class="relative"><div><span class="i-lucide-search text-sm text-muted shrink-0"></span> <input type="text" placeholder="Search users or paste hash..."/></div> <!></div>');function Na(n,e){Oe(e,!0);const t=()=>_e(ce,"$nostrStore",s),[s,r]=mt();let x=it(e,"fullWidth",3,!1),o=it(e,"autofocus",3,!1),i=ee(void 0);const a=/^([a-f0-9]{64})(\/.*)?$/i;let d=ee(""),l=ee(!1),u=ee(!1),f=ee(0),h=ee(void 0),B=L(()=>t().pubkey),A=L(()=>Ou(c(B))),D=L(()=>{if(!c(A)||c(A).size===0)return null;const S=[];for(const P of c(A))try{const I=Ke.npubEncode(P);S.push({pubkey:P,npub:I})}catch{}return new es(S,{keys:["npub","pubkey"],includeScore:!0,threshold:.4})}),v=L(()=>!c(D)||!c(d).trim()||c(d).trim().length<2?[]:c(D).search(c(d).trim(),{limit:5}).map(P=>P.item));$e(()=>{c(v),T(f,0)}),$e(()=>{o()&&c(i)&&c(i).focus()}),$e(()=>{const S=P=>{c(h)&&!c(h).contains(P.target)&&T(u,!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)});function m(S){let P=S.trim();try{const R=new URL(P);if(R.hash&&R.hash.startsWith("#/"))return window.location.hash=R.hash,T(d,""),!0}catch{}if(P.startsWith("#/"))return window.location.hash=P,T(d,""),!0;if(P.startsWith("npub1")&&P.length>=63)return window.location.hash=`#/${P}`,T(d,""),!0;if(Cx(P)||px(P))return window.location.hash=`#/${P}`,T(d,""),!0;const I=P.match(a);if(I){const R=I[1],z=I[2]||"",K=Ji(R);return window.location.hash=`#/${K}${z}`,T(d,""),!0}return P.startsWith("npub1")?(window.location.hash=`#/${P}`,T(d,""),!0):!1}function C(S){window.location.hash=`#/${S.npub}`,T(d,""),T(u,!1)}function E(S){const P=S.target.value.trim();m(P)?T(u,!1):(T(d,S.target.value,!0),T(u,!0))}function F(S){if(c(u)&&c(v).length>0){if(S.key==="ArrowDown"){S.preventDefault(),T(f,Math.min(c(f)+1,c(v).length-1),!0);return}if(S.key==="ArrowUp"){S.preventDefault(),T(f,Math.max(c(f)-1,0),!0);return}if(S.key==="Enter"&&c(v)[c(f)]){S.preventDefault(),C(c(v)[c(f)]);return}}S.key==="Enter"&&(m(c(d).trim()),T(u,!1)),S.key==="Escape"&&T(u,!1)}var g=t8(),p=b(g),y=k(b(p),2);y.__input=E,y.__keydown=F,M0(y,S=>T(i,S),()=>c(i));var w=k(p,2);{var _=S=>{var P=e8();Tt(P,21,()=>c(v),Qt,(I,R,z)=>{var K=Z9();K.__click=()=>C(c(R));var O=b(K);q0(O,{get pubkey(){return c(R).pubkey},avatarSize:28}),Q(()=>Be(K,1,`w-full px-3 py-2 text-left ${z===c(f)?"bg-surface-3":"hover:bg-surface-3"}`)),T0("mouseenter",K,()=>T(f,z,!0)),M(I,K)}),M(S,P)};$(w,S=>{c(u)&&c(v).length>0&&S(_)})}M0(g,S=>T(h,S),()=>c(h)),Q(()=>{Be(p,1,`flex items-center gap-2 px-3 py-1.5 rounded-full bg-surface-2 border transition-colors ${c(l)?"border-accent":"border-surface-3"}`),Be(y,1,`bg-transparent border-none outline-none text-sm text-text-1 placeholder:text-muted ${x()?"flex-1":"w-40 lg:w-64"}`)}),T0("focus",y,()=>{T(l,!0),T(u,!0)}),T0("blur",y,()=>T(l,!1)),fs(y,()=>c(d),S=>T(d,S)),M(n,g),He(),r()}wt(["input","keydown","click"]);var s8=U('<div class="absolute left-0 right-0 top-0 h-12 bg-surface-1 flex items-center px-3 z-50"><div class="flex-1"><!></div> <button class="p-2 text-text-2 hover:text-text-1 bg-transparent border-none cursor-pointer" aria-label="Close search"><span class="i-lucide-x text-lg"></span></button></div>'),r8=U('<button class="p-2 text-text-2 hover:text-text-1 bg-transparent border-none cursor-pointer" aria-label="Search"><span class="i-lucide-search text-lg"></span></button>'),n8=U('<div class="md:hidden"><!></div>');function x8(n,e){Oe(e,!0);let t=ee(!1),s=ee(void 0);$e(()=>{if(!c(t))return;const a=l=>{c(s)&&!c(s).contains(l.target)&&T(t,!1)},d=l=>{l.key==="Escape"&&T(t,!1)};return document.addEventListener("mousedown",a),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("keydown",d)}});var r=n8(),x=b(r);{var o=a=>{var d=s8(),l=b(d),u=b(l);Na(u,{fullWidth:!0,autofocus:!0});var f=k(l,2);f.__click=()=>T(t,!1),M(a,d)},i=a=>{var d=r8();d.__click=()=>T(t,!0),M(a,d)};$(x,a=>{c(t)?a(o):a(i,!1)})}M0(r,a=>T(s,a),()=>c(s)),M(n,r),He()}wt(["click"]);const za=Je([]);function o8(n){za.update(e=>e.filter(t=>t.id!==n))}const x0=Je(null),p0=Je(!1),O0=Je(!1);let xn=null,_o=null,on=null;async function So(){const n=Ge(g0),t=Ge(w0).path,s=n!=null&&n.hash?se(n.hash):null,r=n!=null&&n.key?se(n.key):null,x=t.join("/");if(s===xn&&r===_o&&x===on)return;const o=x===on&&xn!==null;if(xn=s,_o=r,on=x,!n||!s){x0.set(null),p0.set(!1),o||O0.set(t.length>0);return}if(t.length===0){if(Ge(w0).isPermalink){o||O0.set(!0);const d=Bt();try{await d.isDirectory(n)?(x0.set(n),p0.set(!1)):(x0.set(null),p0.set(!0))}catch{x0.set(n),p0.set(!1)}O0.set(!1);return}x0.set(n),p0.set(!1),O0.set(!1);return}o||O0.set(!0);const i=Bt();try{const a=await i.resolvePath(n,t);if(!a)return;if(a.type===te.Dir)x0.set(a.cid),p0.set(!1);else if(p0.set(!0),t.length===1)x0.set(n);else{const l=t.slice(0,-1),u=await i.resolvePath(n,l);x0.set((u==null?void 0:u.cid)??null)}O0.set(!1)}catch{x0.set(null),p0.set(!1),O0.set(!1)}}const Po="__currentDirHashInitialized",To=typeof globalThis<"u"?globalThis:window;function i8(){To[Po]||(To[Po]=!0,g0.subscribe(()=>{So()}),w0.subscribe(()=>{So()}))}i8();tx(x0,n=>(n==null?void 0:n.hash)??null);function Cs(){const n=X0();return ga(n.npub,n.treeName)}function Mx(n,e,t,s,r){const x=[];n&&e&&x.push(n,e),x.push(...t),s&&x.push(s);let o="/"+x.map(encodeURIComponent).join("/");return r&&(o+=`?k=${r}`),o}function Rs(){const n=X0(),e=n.path;return e.length===0?[]:n.isStreaming&&e.length>0||Ge(p0)?e.slice(0,-1):e}function Ka(n,e){const t=X0(),s=Rs();let r=Mx(t.npub,t.treeName,s,n,t.linkKey);r+=r.includes("?")?"&edit=1":"?edit=1",I0(r)}const $a=Je(new Set),an=new Map;function a8(n,e){const t=an.get(n);t&&clearTimeout(t);const s=setTimeout(()=>{an.delete(n),$a.update(r=>r.has(n)?new Set([...r].filter(o=>o!==n)):r)},e);an.set(n,s)}function Oa(n){$a.update(e=>new Set([...e,...n]));for(const e of n)a8(e,5e3)}const c8={showCreateModal:!1,createModalType:"file",createTreeVisibility:"public",showRenameModal:!1,renameTarget:"",showForkModal:!1,forkTarget:null,showExtractModal:!1,extractTarget:null,extractLocation:"subdir",showGitignoreModal:!1,gitignoreTarget:null,showGitHistoryModal:!1,gitHistoryTarget:null,showGitShellModal:!1,gitShellTarget:null,showShareModal:!1,shareUrl:null,showCollaboratorsModal:!1,collaboratorsTarget:null,showUnsavedChangesModal:!1,unsavedChangesTarget:null,showNewPullRequestModal:!1,newPullRequestTarget:null,showNewIssueModal:!1,newIssueTarget:null,showGitCommitModal:!1,gitCommitTarget:null,showBlossomPushModal:!1,blossomPushTarget:null,modalInput:""},_t=Je(c8);function l8(n){_t.update(e=>({...e,showCreateModal:!0,createModalType:n,createTreeVisibility:"public",modalInput:""}))}function Zt(){_t.update(n=>({...n,showCreateModal:!1,createTreeVisibility:"public",modalInput:""}))}function u8(n){_t.update(e=>({...e,createTreeVisibility:n}))}function d8(n,e){_t.update(t=>({...t,showForkModal:!0,forkTarget:{dirCid:n,suggestedName:e},modalInput:e}))}function H0(){_t.update(n=>({...n,showForkModal:!1,forkTarget:null,modalInput:""}))}function Ha(n){_t.update(e=>({...e,showShareModal:!0,shareUrl:n}))}function vs(){_t.update(n=>({...n,showShareModal:!1,shareUrl:null}))}function Mo(n,e){_t.update(t=>({...t,showCollaboratorsModal:!0,collaboratorsTarget:{npubs:n,onSave:e}}))}function f8(){_t.update(n=>({...n,showCollaboratorsModal:!1,collaboratorsTarget:null}))}function ja(n){_t.update(e=>({...e,modalInput:n}))}function h8(n,e,t){_t.update(s=>({...s,showBlossomPushModal:!0,blossomPushTarget:{cid:n,name:e,isDirectory:t}}))}function n0(){_t.update(n=>({...n,showBlossomPushModal:!1,blossomPushTarget:null}))}function E8(n){const e=[];for(const t of n.split(`
`)){const s=t.trim();if(!s||s.startsWith("#"))continue;let r=s,x=!1,o=!1;r.startsWith("!")&&(x=!0,r=r.slice(1)),r.endsWith("/")&&(o=!0,r=r.slice(0,-1));const i=B8(r);e.push({pattern:s,regex:i,negation:x,directoryOnly:o})}return e}function B8(n){let e="",t=0;for(n.startsWith("/")?(n=n.slice(1),e="^"):e="(^|/)";t<n.length;){const r=n[t];if(r==="*")n[t+1]==="*"?n[t+2]==="/"?(e+="(.*/)?",t+=3):(t+2,n.length,e+=".*",t+=2):(e+="[^/]*",t++);else if(r==="?")e+="[^/]",t++;else if(r==="["){const x=n.indexOf("]",t+1);x!==-1?(e+=n.slice(t,x+1),t=x+1):(e+="\\[",t++)}else r==="/"?(e+="/",t++):(e+=r.replace(/[.+^${}()|\\]/g,"\\$&"),t++)}return e+="(/.*)?$",new RegExp(e)}E8(`
# Common OS files
.DS_Store
Thumbs.db
`);const qa=Je(null);function C8(n){qa.set(n)}function cn(){C8(null)}var p8=U('<div class="pointer-events-auto bg-surface-1 border border-surface-3 rounded-lg shadow-lg p-3 max-w-sm w-full flex items-start gap-2"><span></span> <span class="text-sm text-text-1 flex-1"> </span> <button class="shrink-0 text-text-3 hover:text-text-1 transition-colors"><span class="i-lucide-x text-sm"></span></button></div>'),g8=U('<div class="pointer-events-auto bg-surface-1 border border-accent rounded-lg shadow-lg p-3 max-w-sm w-full"><div class="flex items-center gap-2 mb-2"><span class="i-lucide-loader-2 animate-spin text-accent shrink-0"></span> <span class="text-sm text-text-1 truncate flex-1"> </span> <button class="btn-ghost shrink-0 px-2 py-0.5 text-xs">Cancel</button></div> <div class="w-full h-1.5 bg-surface-3 rounded-full overflow-hidden mb-1"><div class="h-full bg-accent transition-all duration-150"></div></div> <div class="flex items-center justify-between text-xs text-text-3"><span class="capitalize"> </span> <span> </span></div></div>'),A8=U('<div class="pointer-events-none flex flex-col items-center gap-2" style="position: fixed; bottom: 1rem; left: 1rem; right: 1rem; z-index: 9999;"><!> <!></div>');function F8(n,e){Oe(e,!0);const t=()=>_e(qa,"$uploadProgress",r),s=()=>_e(za,"$toasts",r),[r,x]=mt(),o={info:"i-lucide-info",success:"i-lucide-check-circle",error:"i-lucide-x-circle",warning:"i-lucide-alert-triangle"},i={info:"text-accent",success:"text-success",error:"text-danger",warning:"text-warning"};let a=L(()=>{var h;return(h=t())!=null&&h.totalBytes?Math.round((t().bytes||0)/t().totalBytes*100):t()?Math.round(t().current/t().total*100):0}),d=L(()=>t()||s().length>0);var l=Ie(),u=ge(l);{var f=h=>{var B=A8(),A=b(B);Tt(A,1,s,m=>m.id,(m,C)=>{var E=p8(),F=b(E),g=k(F,2),p=b(g),y=k(g,2);y.__click=()=>o8(c(C).id),Q(()=>{Be(F,1,`${o[c(C).type]??""} ${i[c(C).type]??""} shrink-0 mt-0.5`),V(p,c(C).message)}),M(m,E)});var D=k(A,2);{var v=m=>{var C=g8(),E=b(C),F=k(b(E),2),g=b(F),p=k(F,2);p.__click=function(...z){cn==null||cn.apply(this,z)};var y=k(E,2),w=b(y),_=k(y,2),S=b(_),P=b(S),I=k(S,2),R=b(I);Q(()=>{V(g,t().fileName),ds(w,`width: ${c(a)??""}%`),V(P,`${(t().status||"uploading")??""}...`),V(R,`${t().current??""} / ${t().total??""}`)}),M(m,C)};$(D,m=>{t()&&m(v)})}M(h,B)};$(u,h=>{c(d)&&h(f)})}M(n,l),He(),x()}wt(["click"]);class v8 extends yr{constructor(){super("hashtree-link-keys");q(this,"linkKeys");this.version(1).stores({linkKeys:"key"})}}const Va=new v8;let Ix={},Zs=null;const y8=new Set;async function Ga(){return Zs||(Zs=(async()=>{try{const n=await Va.linkKeys.toArray();Ix=Object.fromEntries(n.map(e=>[e.key,e.linkKey]))}catch{}})(),Zs)}Ga();function Wa(){return Ix}async function Ya(){await Ga()}async function D8(n,e,t){const s=`${n}/${e}`;Ix[s]=t,await Va.linkKeys.put({key:s,linkKey:t}),y8.forEach(r=>r())}function Rx(n){const e=Je([]);if(!n)return{subscribe:e.subscribe};const t=Y0();if(!t.list)return{subscribe:e.subscribe};const s=ce.getState().npub,r=n===s;let x;return Ya().then(()=>{x=t.list(n,o=>{const i=r?Wa():{},a=o.map(d=>{const l=d.key.indexOf("/"),u=l>=0?d.key.slice(l+1):"",f=d.visibility,h=f==="unlisted"&&r?i[`${n}/${u}`]:void 0;return{key:d.key,name:u,hash:d.cid.hash,hashHex:se(d.cid.hash),encryptionKey:d.cid.key,visibility:f,encryptedKey:d.encryptedKey,keyId:d.keyId,selfEncryptedKey:d.selfEncryptedKey,linkKey:h,createdAt:d.createdAt}});e.set(a)})}),{subscribe:o=>{const i=e.subscribe(o);return()=>{i(),x==null||x()}}}}const Ux=Object.freeze(Object.defineProperty({__proto__:null,createTreesStore:Rx,getStoredLinkKeys:Wa,storeLinkKey:D8,waitForLinkKeysCache:Ya},Symbol.toStringTag,{value:"Module"}));function Qa(n){return[...n].sort((e,t)=>{const s=e.type===te.Dir,r=t.type===te.Dir;return s!==r?s?-1:1:e.name.localeCompare(t.name)})}function m8(){const n=Je({entries:[],loading:!1,isDirectory:!0});let e=null,t=null,s=new Map;return x0.subscribe(async r=>{var a,d;const x=r!=null&&r.hash?se(r.hash):null,o=r!=null&&r.key?se(r.key):null;if(x===e&&o===t)return;if(e=x,t=o,!r||!x){n.set({entries:[],loading:!1,isDirectory:!0}),s.clear();return}n.update(l=>({...l,loading:!0}));const i=Bt();try{let l=[];if(r.key)l=await i.listDirectory(r);else if(await i.isDirectory(r))l=await i.listDirectory(r);else{n.set({entries:[],loading:!1,isDirectory:!1}),s.clear();return}if(s.size>0){const h=new Set;for(const B of l){const A=s.get(B.name),D=(a=B.cid)!=null&&a.hash?se(B.cid.hash):null;A&&D&&A!==D&&h.add(B.name)}h.size>0&&Oa(h)}const u=new Map;for(const h of l)(d=h.cid)!=null&&d.hash&&u.set(h.name,se(h.cid.hash));const f=u.size!==s.size||[...u].some(([h,B])=>s.get(h)!==B);s=u,f?n.set({entries:Qa(l),loading:!1,isDirectory:!0}):n.update(h=>h.loading?{...h,loading:!1}:h)}catch{n.set({entries:[],loading:!1,isDirectory:!1}),s.clear()}}),{subscribe:n.subscribe,__testSet:r=>n.set(r)}}const w8=m8();typeof window<"u"&&(window.__testSetDirectoryEntries=n=>{w8.__testSet({entries:Qa(n),loading:!1,isDirectory:!0})});const ex="hashtree:recents",b8=20;function k8(){try{const n=localStorage.getItem(ex);if(!n)return[];const e=JSON.parse(n);let t=!1;const s=e.map(r=>{if(r.type==="hash"&&r.npub){t=!0;const{npub:x,...o}=r;return o}return r});return t&&localStorage.setItem(ex,JSON.stringify(s)),s}catch{return[]}}function _8(n){try{localStorage.setItem(ex,JSON.stringify(n))}catch{}}const S8=Je(k8());function P8(n){const e={...n,timestamp:Date.now()};S8.update(t=>{const s=t.filter(x=>x.path!==n.path),r=[e,...s].slice(0,b8);return _8(r),r})}const Io="__recentsNhashInitialized",Ro=typeof globalThis<"u"?globalThis:window;Ro[Io]||(Ro[Io]=!0,w0.subscribe(n=>{var e;if(n.isPermalink&&((e=n.cid)!=null&&e.hash)){const s=window.location.hash.replace(/^#\/?/,"").split("/")[0];if(!s)return;P8({type:"hash",label:s.slice(0,16)+"...",path:"/"+s,hasKey:!!n.cid.key})}}));var T8=U('<span><span class="i-lucide-link"></span> <span class="i-lucide-lock absolute -bottom-0.5 -right-1.5 text-[0.6em]"></span></span>'),M8=U("<span></span>");function Ja(n,e){let t=it(e,"class",3,"");function s(d){switch(d){case"public":return{icon:"i-lucide-globe",title:"Public"};case"unlisted":return{icon:"i-lucide-link",title:"Unlisted (link only)"};case"private":return{icon:"i-lucide-lock",title:"Private"}}}let r=L(()=>e.visibility?s(e.visibility):null);var x=Ie(),o=ge(x);{var i=d=>{},a=d=>{var l=Ie(),u=ge(l);{var f=B=>{var A=T8();Q(()=>{Be(A,1,`relative inline-block shrink-0 ${t()??""}`),Ce(A,"title",c(r).title)}),M(B,A)},h=B=>{var A=M8();Q(()=>{Be(A,1,`shrink-0 ${c(r).icon??""} ${t()??""}`),Ce(A,"title",c(r).title)}),M(B,A)};$(u,B=>{e.visibility==="unlisted"?B(f):B(h,!1)},!0)}M(d,l)};$(o,d=>{!e.visibility||!c(r)?d(i):d(a,!1)})}M(n,x)}var I8=U('<a class="aspect-[1/1.414] bg-surface-1 rounded-lg border border-surface-3 hover:border-accent transition-colors no-underline flex flex-col"><div class="flex-1 flex items-center justify-center"><span class="i-lucide-file-text text-4xl text-accent"></span></div> <div class="p-2 border-t border-surface-3"><div class="flex items-center gap-1.5"><!> <h3 class="text-sm font-medium text-text-1 truncate"> </h3></div></div></a>'),R8=U('<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"><button class="aspect-[1/1.414] bg-surface-1 rounded-lg border border-dashed border-surface-3 hover:border-accent transition-colors cursor-pointer flex flex-col items-center justify-center gap-2"><span class="i-lucide-plus text-4xl text-accent"></span> <span class="text-sm text-text-2">New Document</span></button> <!></div>'),U8=U('<div class="flex-1 overflow-auto"><div class="max-w-4xl mx-auto p-6"><!></div></div>');function ln(n,e){Oe(e,!0);let t=L(()=>Nt.getState()),s=L(()=>c(t).npub),r=L(()=>Rx(c(s))),x=ee(t0([]));$e(()=>c(r).subscribe(B=>{T(x,B,!0)}));let o=L(()=>c(x).filter(f=>f.name.startsWith("docs/")).map(f=>({...f,displayName:f.name.slice(5)})).slice(0,10));function i(){if(!c(s)){alert("Please sign in to create a document");return}l8("document")}var a=U8(),d=b(a),l=b(d);{var u=f=>{var h=R8(),B=b(h);B.__click=i;var A=k(B,2);Tt(A,17,()=>c(o),Qt,(D,v)=>{const m=L(()=>c(v).linkKey?`?k=${c(v).linkKey}`:"");var C=I8(),E=k(b(C),2),F=b(E),g=b(F);Ja(g,{get visibility(){return c(v).visibility},class:"text-text-3 text-xs"});var p=k(g,2),y=b(p);Q(()=>{Ce(C,"href",`#/${c(s)??""}/${c(v).name??""}${c(m)??""}`),V(y,c(v).displayName)}),M(D,C)}),M(f,h)};$(l,f=>{c(s)&&f(u)})}M(n,a),He()}wt(["click"]);async function Us(n){var u;const e=X0();if(!e.npub||!e.treeName)return null;const t=Bt(),s=Nt.getState();let r;try{const f=Ke.decode(e.npub);if(f.type!=="npub")return null;r=f.data}catch{return null}if(!(r===s.pubkey))return null;const o=n.map(f=>({name:f.name,cid:f.cid,size:f.size,type:f.type})),{cid:i}=await t.putDirectory(o),a=se(i.hash),d=i.key?se(i.key):void 0,l=((u=s.selectedTree)==null?void 0:u.visibility)??"public";return s.npub&&Bs(s.npub,e.treeName,i.hash,i.key,l),Nt.setSelectedTree({id:"",name:e.treeName,pubkey:r,rootHash:a,rootKey:d,visibility:l,created_at:Math.floor(Date.now()/1e3)}),_x(e.treeName,a,d,{visibility:l}),i}async function Lx(n){if(!n)return;const e=Cs(),t=Bt(),s=Rs(),{cid:r}=await t.putDirectory([]);if(e){const x=await t.setEntry(e,s,n,r,0,te.Dir);Q0(x)}else await Us([{name:n,cid:r,size:0,type:te.Dir}])}async function Nx(n){var l;if(!n)return;const e=Cs(),t=Bt(),s=Rs(),x=Nt.getState().npub||"",o=new TextEncoder().encode(x?x+`
`:""),{cid:i,size:a}=await t.putFile(o),{cid:d}=await t.putDirectory([{name:".yjs",cid:i,size:a,type:te.Blob}]);if(e){const u=await t.setEntry(e,s,n,d,0,te.Dir);Q0(u);const f=X0(),h=Nt.getState();h.npub&&f.treeName&&Bs(h.npub,f.treeName,u.hash,u.key,(l=h.selectedTree)==null?void 0:l.visibility)}else await Us([{name:n,cid:d,size:0,type:te.Dir}])}async function zx(n,e,t="public"){if(!e)return{success:!1};const{saveHashtree:s}=await i0(async()=>{const{saveHashtree:d}=await Promise.resolve().then(()=>kr);return{saveHashtree:d}},void 0),{storeLinkKey:r}=await i0(async()=>{const{storeLinkKey:d}=await Promise.resolve().then(()=>Ux);return{storeLinkKey:d}},void 0),x=se(n.hash),o=n.key?se(n.key):void 0,i=Nt.getState();if(!i.npub||!i.pubkey)return{success:!1};Nt.setSelectedTree({id:"",name:e,pubkey:i.pubkey,rootHash:x,rootKey:t==="public"?o:void 0,visibility:t,created_at:Math.floor(Date.now()/1e3)}),Bs(i.npub,e,n.hash,n.key,t);const a=await s(e,x,o,{visibility:t});if(a.linkKey&&r(i.npub,e,a.linkKey),a.success){const d=a.linkKey?`?k=${a.linkKey}`:"";I0(`/${encodeURIComponent(i.npub)}/${encodeURIComponent(e)}${d}`)}return a}async function Kx(n,e="public",t=!1){if(!n)return{success:!1};const{saveHashtree:s}=await i0(async()=>{const{saveHashtree:l}=await Promise.resolve().then(()=>kr);return{saveHashtree:l}},void 0),{storeLinkKey:r}=await i0(async()=>{const{storeLinkKey:l}=await Promise.resolve().then(()=>Ux);return{storeLinkKey:l}},void 0),x=Bt(),{cid:o}=await x.putDirectory([]),i=se(o.hash),a=o.key?se(o.key):void 0,d=Nt.getState();if(d.isLoggedIn&&d.npub&&d.pubkey){t||Nt.setSelectedTree({id:"",name:n,pubkey:d.pubkey,rootHash:i,rootKey:e==="public"?a:void 0,visibility:e,created_at:Math.floor(Date.now()/1e3)}),Bs(d.npub,n,o.hash,o.key,e);const l=await s(n,i,a,{visibility:e});if(l.linkKey&&r(d.npub,n,l.linkKey),!t){const u=l.linkKey?`?k=${l.linkKey}`:"";I0(`/${encodeURIComponent(d.npub)}/${encodeURIComponent(n)}${u}`)}return l}return{success:!1}}async function L8(n,e="public"){if(!n)return{success:!1};const{saveHashtree:t}=await i0(async()=>{const{saveHashtree:B}=await Promise.resolve().then(()=>kr);return{saveHashtree:B}},void 0),{storeLinkKey:s}=await i0(async()=>{const{storeLinkKey:B}=await Promise.resolve().then(()=>Ux);return{storeLinkKey:B}},void 0),r=Bt(),x=Nt.getState();if(!x.isLoggedIn||!x.npub||!x.pubkey)return{success:!1};const o=`docs/${n}`,i=new TextEncoder().encode(x.npub+`
`),{cid:a,size:d}=await r.putFile(i),{cid:l}=await r.putDirectory([{name:".yjs",cid:a,size:d,type:te.Blob}]),u=se(l.hash),f=l.key?se(l.key):void 0;Nt.setSelectedTree({id:"",name:o,pubkey:x.pubkey,rootHash:u,rootKey:e==="public"?f:void 0,visibility:e,created_at:Math.floor(Date.now()/1e3)}),Bs(x.npub,o,l.hash,l.key,e);const h=await t(o,u,f,{visibility:e,labels:["docs"]});return h.linkKey&&s(x.npub,o,h.linkKey),{success:!0,npub:x.npub,treeName:o,linkKey:h.linkKey}}const N8=Object.freeze(Object.defineProperty({__proto__:null,createDocument:Nx,createDocumentTree:L8,createFolder:Lx,createTree:Kx,forkTree:zx,initVirtualTree:Us},Symbol.toStringTag,{value:"Module"}));async function Xa(n,e=""){if(!n)return;const t=Cs(),s=Bt(),r=new TextEncoder().encode(e),x=Rs(),{cid:o,size:i}=await s.putFile(r);if(t){const a=await s.setEntry(t,x,n,o,i);Q0(a)}else if(!await Us([{name:n,cid:o,size:i}]))return;Oa(new Set([n])),Ka(n)}async function Za(){const n=Cs();if(!n)return;const e=X0();if(e.path.length===0)return;const t=e.path[e.path.length-1],s=e.path.slice(0,-1),x=await Bt().removeEntry(n,s,t);Q0(x);const o=Mx(e.npub,e.treeName,s,void 0,e.linkKey);I0(o)}const z8=Object.freeze(Object.defineProperty({__proto__:null,buildRouteUrl:Mx,createDocument:Nx,createFile:Xa,createFolder:Lx,createTree:Kx,deleteCurrentFolder:Za,forkTree:zx,getCurrentPathFromUrl:Rs,getCurrentRootCid:Cs,initVirtualTree:Us,updateRoute:Ka},Symbol.toStringTag,{value:"Module"}));var K8=U('<span class="i-lucide-pencil text-xs text-text-3"></span>'),$8=U('<span class="text-xs px-2 py-0.5 rounded bg-surface-2 text-text-3">Read-only</span>'),O8=U('<span class="text-xs px-2 py-0.5 rounded bg-success/20 text-success" title="You are an editor - edits save to your tree">Editor</span>'),H8=U('<span class="i-lucide-loader-2 animate-spin"></span> <span>Saving...</span>',1),j8=U('<span class="text-xs"> </span>'),q8=U('<span class="text-xs bg-surface-2 px-1.5 rounded-full"> </span>'),V8=U('<button class="btn-ghost text-danger" title="Delete document">Delete</button>'),G8=U('<div class="flex items-center justify-center gap-1 px-4 py-2 border-b border-surface-3 bg-surface-1 shrink-0 flex-wrap"><button title="Bold (Ctrl+B)"><span class="i-lucide-bold svelte-1oj2amf"></span></button> <button title="Italic (Ctrl+I)"><span class="i-lucide-italic svelte-1oj2amf"></span></button> <button title="Strikethrough"><span class="i-lucide-strikethrough svelte-1oj2amf"></span></button> <button title="Inline Code"><span class="i-lucide-code svelte-1oj2amf"></span></button> <div class="w-px h-5 bg-surface-3 mx-1"></div> <button title="Heading 1"><span class="i-lucide-heading-1 svelte-1oj2amf"></span></button> <button title="Heading 2"><span class="i-lucide-heading-2 svelte-1oj2amf"></span></button> <button title="Heading 3"><span class="i-lucide-heading-3 svelte-1oj2amf"></span></button> <div class="w-px h-5 bg-surface-3 mx-1"></div> <button title="Bullet List"><span class="i-lucide-list svelte-1oj2amf"></span></button> <button title="Numbered List"><span class="i-lucide-list-ordered svelte-1oj2amf"></span></button> <div class="w-px h-5 bg-surface-3 mx-1"></div> <button title="Quote"><span class="i-lucide-quote svelte-1oj2amf"></span></button> <button title="Code Block"><span class="i-lucide-file-code svelte-1oj2amf"></span></button> <button class="toolbar-btn svelte-1oj2amf" title="Horizontal Rule"><span class="i-lucide-minus svelte-1oj2amf"></span></button> <div class="w-px h-5 bg-surface-3 mx-1"></div> <button class="toolbar-btn disabled:opacity-30 svelte-1oj2amf" title="Undo (Ctrl+Z)"><span class="i-lucide-undo svelte-1oj2amf"></span></button> <button class="toolbar-btn disabled:opacity-30 svelte-1oj2amf" title="Redo (Ctrl+Shift+Z)"><span class="i-lucide-redo svelte-1oj2amf"></span></button></div>'),W8=U('<div class="flex-1 flex items-center justify-center text-text-3"><span class="i-lucide-loader-2 animate-spin mr-2"></span> Loading document...</div>'),Y8=U('<div class="flex-1 flex flex-col min-h-0 bg-surface-0"><div class="shrink-0 px-4 py-2 border-b border-surface-3 flex flex-wrap items-center justify-between gap-2 bg-surface-1 text-sm"><div class="flex items-center gap-2 min-w-0"><a href="#/" class="btn-ghost p-1" title="Back to home"><span class="i-lucide-chevron-left text-lg"></span></a> <!> <span class="i-lucide-file-text text-text-2 shrink-0"></span> <span class="font-medium text-text-1 truncate"> </span> <!> <!> <!> <!></div> <div class="flex items-center gap-2 shrink-0"><div class="flex items-center gap-2 text-text-3"><!></div> <button class="btn-ghost" title="Share document"><span class="i-lucide-share"></span></button> <button class="btn-ghost" title="Push to Blossom"><span class="i-lucide-upload-cloud"></span></button> <button class="btn-ghost flex items-center gap-1"><span class="i-lucide-users"></span> <!></button> <button class="btn-ghost flex items-center gap-1" title="Fork document as new tree"><span class="i-lucide-git-fork"></span> Fork</button> <!></div></div> <!> <div><div class="a4-page bg-[#1a1a24] svelte-1oj2amf"><div class="ProseMirror-container prose prose-sm max-w-none min-h-full"></div></div></div> <!></div>');function Q8(n,e){Oe(e,!0);const t=()=>_e(w0,"$routeStore",s),[s,r]=mt(),x="deltas",o="state.yjs";let i=L(t),a=L(()=>Nt.getState()),d=L(()=>c(a).npub),l=L(()=>c(i).npub),u=ee(void 0),f=ee(void 0),h=ee(void 0),B=ee("idle"),A=ee(null),D,v=ee(!0),m=ee(t0([])),C=L(()=>!c(l)||c(l)===c(d)),E=L(()=>c(d)?c(m).includes(c(d)):!1),F=L(()=>c(C)||c(E)),g=L(()=>c(l)||c(d)),p=L(()=>c(g)?bs(c(g)):null),y=L(()=>c(l)||c(d)),w=L(()=>Rx(c(y))),_=ee(t0([]));$e(()=>c(w).subscribe(fe=>{T(_,fe,!0)}));let S=L(()=>c(i).treeName?c(_).find(N=>N.name===c(i).treeName):null),P=L(()=>{var N;return((N=c(S))==null?void 0:N.visibility)||"public"}),I=L(()=>e.entries.find(N=>N.name===".yjs")),R="";$e(()=>{const N=c(m).join(",");N!==R&&c(h)&&c(m).length>0&&(R=N,j(c(m)))}),$e(()=>{c(f)&&c(f).isEditable!==c(F)&&c(f).setEditable(c(F))});async function z(N){const ne=Bt(),fe=[],We=N.find(ve=>ve.name===o&&ve.type!==te.Dir);if(We){const ve=await ne.readFile(We.cid);ve&&fe.push(ve)}const rt=N.find(ve=>ve.name===x&&ve.type===te.Dir);if(rt)try{const Ue=(await ne.listDirectory(rt.cid)).filter(qe=>qe.type!==te.Dir).sort((qe,nt)=>qe.name.localeCompare(nt.name,void 0,{numeric:!0}));for(const qe of Ue){const nt=await ne.readFile(qe.cid);nt&&fe.push(nt)}}catch(ve){console.error("[YjsDoc] loadDeltasFromEntries error:",ve)}return fe}async function K(N){const ne=Bt(),fe=Y0(),We=c(i).path.join("/"),rt=c(i).treeName;if(!rt)return;const ve=N.filter(Ue=>Ue!==c(i).npub);for(const Ue of ve)try{const qe=`${Ue}/${rt}`,nt=await new Promise(ut=>{let yt=!1,Ze=null;const jt=()=>{Ze&&Ze()};Ze=fe.subscribe(qe,r0=>{yt||(yt=!0,queueMicrotask(jt),ut(r0))}),setTimeout(()=>{yt||(yt=!0,jt(),ut(null))},5e3)});if(!nt)continue;const zt=await ne.resolvePath(nt,We);if(!zt||!await ne.isDirectory(zt.cid))continue;const s0=await ne.listDirectory(zt.cid),It=await z(s0);for(const ut of It)c(h)&&Gr(c(h),ut,"remote")}catch(qe){console.warn(`[YjsDoc] Failed to load deltas from collaborator ${Ue}:`,qe)}}let O=[];function j(N){if(O.forEach(ve=>ve()),O=[],N.length===0||!c(i).treeName)return;const ne=Y0(),fe=Bt(),We=c(i).path.join("/"),rt=c(l)||c(d);for(const ve of N){const Ue=`${ve}/${c(i).treeName}`,qe=ne.subscribe(Ue,async nt=>{if(nt&&se(nt.hash),!(!nt||!c(h)))try{const zt=nt,Ht=await fe.resolvePath(zt,We);if(!Ht||!await fe.isDirectory(Ht.cid))return;const It=await fe.listDirectory(Ht.cid);if(ve===rt){const yt=It.find(Ze=>Ze.name===".yjs"&&Ze.type!==te.Dir);if(yt){const Ze=await fe.readFile(yt.cid);if(Ze){const jt=Qu(Ze);if(jt){const r0=jt.split(`
`).filter(h0=>h0.trim().startsWith("npub1"));JSON.stringify(r0)!==JSON.stringify(c(m))&&T(m,r0,!0)}}}}const ut=await z(It);for(const yt of ut)Gr(c(h),yt,"remote")}catch(zt){console.warn(`[YjsDoc] Failed to fetch updates from editor ${ve}:`,zt)}});O.push(qe)}}async function W(){const N=Bt();if(!c(h)||!c(d)||!c(i).treeName){console.warn("[YjsDoc] Missing ydoc, userNpub, or treeName, cannot save");return}let ne=ga(c(d),c(i).treeName);if(!ne){const{cid:fe}=await N.putDirectory([]);ne=fe}T(B,"saving");try{const fe=zc(c(h)),We=Date.now().toString(36),rt=Math.random().toString(36).slice(2,6),ve=`${We}-${rt}`,Ue=c(i).path,qe=[...Ue,"deltas"];for(let ut=0;ut<Ue.length;ut++){const yt=Ue.slice(0,ut),Ze=Ue[ut],jt=Ue.slice(0,ut+1).join("/");if(!await N.resolvePath(ne,jt)){const{cid:h0}=await N.putDirectory([]);ne=await N.setEntry(ne,yt,Ze,h0,0,te.Dir)}}const nt=await N.resolvePath(ne,Ue.join("/"));if(nt&&!(await N.listDirectory(nt.cid)).some(Ze=>Ze.name===".yjs"&&Ze.type!==te.Dir)){const Ze=c(m).join(`
`)+`
`,jt=new TextEncoder().encode(Ze),{cid:r0,size:h0}=await N.putFile(jt);ne=await N.setEntry(ne,Ue,".yjs",r0,h0,te.Blob)}if(!await N.resolvePath(ne,qe.join("/"))){const{cid:ut}=await N.putDirectory([]);ne=await N.setEntry(ne,Ue,"deltas",ut,0,te.Dir)}const{cid:Ht,size:s0}=await N.putFile(fe),It=await N.setEntry(ne,qe,ve,Ht,s0,te.Blob);c(C)?Q0(It):Aa(c(d),c(i).treeName,se(It.hash),It.key?se(It.key):void 0),T(B,"saved"),T(A,new Date,!0)}catch(fe){console.error("[YjsDoc] Failed to save state snapshot:",fe),T(B,"error")}}function J(){D&&clearTimeout(D),D=setTimeout(()=>W(),1e3)}async function G(){if(c(I),!c(I)){T(m,[],!0);return}try{const ne=await Bt().readFile(c(I).cid);if(ne){const fe=new TextDecoder().decode(ne);T(m,fe.split(`
`).filter(We=>We.trim().startsWith("npub1")),!0)}else T(m,[],!0)}catch(N){console.error("[YjsDoc] Failed to load editors:",N),T(m,[],!0)}}async function oe(N){const ne=Bt();let fe=Cs();if(!fe){console.warn("[YjsDoc] No rootCid, cannot save editors");return}try{const We=N.join(`
`)+`
`,rt=new TextEncoder().encode(We),{cid:ve,size:Ue}=await ne.putFile(rt),qe=await ne.setEntry(fe,c(i).path,".yjs",ve,Ue,!1);Q0(qe),T(m,N,!0)}catch(We){console.error("[YjsDoc] Failed to save editors:",We)}}function le(){Ha(window.location.href)}function re(){e.dirCid&&d8(e.dirCid,e.dirName)}function Se(){c(C)?Mo(c(m),oe):Mo(c(m))}function de(){confirm(`Delete document "${e.dirName}" and all its contents?`)&&Za()}Fr(async()=>{if(!c(u))return;await G(),T(h,new Ic,!0);const N=await z(e.entries);for(const ne of N)Gr(c(h),ne,"remote");c(m).length>0&&await K(c(m)),T(v,!1),T(f,new Rc({element:c(u),extensions:[Uc.configure({history:!1}),Lc.configure({placeholder:"Start typing..."}),Nc.configure({document:c(h)})],editable:c(F),editorProps:{attributes:{class:"prose prose-invert max-w-none focus:outline-none min-h-[200px] p-4"}}}),!0),c(m).length>0&&j(c(m)),c(h).on("update",(ne,fe)=>{fe!=="remote"&&J()})}),Ci(()=>{var N,ne;D&&clearTimeout(D),O.forEach(fe=>fe()),O=[],(N=c(f))==null||N.destroy(),(ne=c(h))==null||ne.destroy()});function ae(){var N;(N=c(f))==null||N.chain().focus().toggleBold().run()}function xe(){var N;(N=c(f))==null||N.chain().focus().toggleItalic().run()}function ue(){var N;(N=c(f))==null||N.chain().focus().toggleStrike().run()}function Ct(){var N;(N=c(f))==null||N.chain().focus().toggleCode().run()}function ft(){var N;(N=c(f))==null||N.chain().focus().toggleHeading({level:1}).run()}function St(){var N;(N=c(f))==null||N.chain().focus().toggleHeading({level:2}).run()}function ht(){var N;(N=c(f))==null||N.chain().focus().toggleHeading({level:3}).run()}function tt(){var N;(N=c(f))==null||N.chain().focus().toggleBulletList().run()}function at(){var N;(N=c(f))==null||N.chain().focus().toggleOrderedList().run()}function pt(){var N;(N=c(f))==null||N.chain().focus().toggleBlockquote().run()}function bt(){var N;(N=c(f))==null||N.chain().focus().toggleCodeBlock().run()}function gt(){var N;(N=c(f))==null||N.chain().focus().setHorizontalRule().run()}function be(){var N;(N=c(f))==null||N.chain().focus().undo().run()}function $t(){var N;(N=c(f))==null||N.chain().focus().redo().run()}var Xe=Y8(),pe=b(Xe),Re=b(pe),je=k(b(Re),2);{var At=N=>{Is(N,{get pubkey(){return c(p)},size:20})};$(je,N=>{c(p)&&N(At)})}var Z=k(je,4),X=b(Z),ke=k(Z,2);Ja(ke,{get visibility(){return c(P)},class:"text-text-2 text-sm"});var ct=k(ke,2);{var kt=N=>{var ne=K8();Q(()=>Ce(ne,"title",c(C)?"You can edit this document":"Editing as editor - saves to your tree")),M(N,ne)};$(ct,N=>{c(F)&&N(kt)})}var Ft=k(ct,2);{var Pe=N=>{var ne=$8();M(N,ne)};$(Ft,N=>{c(F)||N(Pe)})}var Fe=k(Ft,2);{var st=N=>{var ne=O8();M(N,ne)};$(Fe,N=>{c(E)&&!c(C)&&N(st)})}var lt=k(Re,2),vt=b(lt),Ot=b(vt);{var L0=N=>{var ne=H8();M(N,ne)},f0=N=>{var ne=Ie(),fe=ge(ne);{var We=rt=>{var ve=j8(),Ue=b(ve);Q(qe=>V(Ue,`Saved ${qe??""}`),[()=>c(A).toLocaleTimeString()]),M(rt,ve)};$(fe,rt=>{c(A)&&rt(We)},!0)}M(N,ne)};$(Ot,N=>{c(B)==="saving"?N(L0):N(f0,!1)})}var _0=k(vt,2);_0.__click=le;var N0=k(_0,2);N0.__click=()=>h8(e.dirCid,e.dirName,!0);var a0=k(N0,2);a0.__click=Se;var z0=k(b(a0),2);{var rs=N=>{var ne=q8(),fe=b(ne);Q(()=>V(fe,c(m).length)),M(N,ne)};$(z0,N=>{c(m).length>0&&N(rs)})}var ps=k(a0,2);ps.__click=re;var _r=k(ps,2);{var Ls=N=>{var ne=V8();ne.__click=de,M(N,ne)};$(_r,N=>{c(C)&&N(Ls)})}var Ns=k(pe,2);{var Sr=N=>{var ne=G8(),fe=b(ne);fe.__click=ae;var We=k(fe,2);We.__click=xe;var rt=k(We,2);rt.__click=ue;var ve=k(rt,2);ve.__click=Ct;var Ue=k(ve,4);Ue.__click=ft;var qe=k(Ue,2);qe.__click=St;var nt=k(qe,2);nt.__click=ht;var zt=k(nt,4);zt.__click=tt;var Ht=k(zt,2);Ht.__click=at;var s0=k(Ht,4);s0.__click=pt;var It=k(s0,2);It.__click=bt;var ut=k(It,2);ut.__click=gt;var yt=k(ut,4);yt.__click=be;var Ze=k(yt,2);Ze.__click=$t,Q((jt,r0,h0,Mr,Ir,$s,Rr,Os,Ur,Lr,Nr,zr,Kr)=>{Be(fe,1,`toolbar-btn ${jt??""}`,"svelte-1oj2amf"),Be(We,1,`toolbar-btn ${r0??""}`,"svelte-1oj2amf"),Be(rt,1,`toolbar-btn ${h0??""}`,"svelte-1oj2amf"),Be(ve,1,`toolbar-btn ${Mr??""}`,"svelte-1oj2amf"),Be(Ue,1,`toolbar-btn ${Ir??""}`,"svelte-1oj2amf"),Be(qe,1,`toolbar-btn ${$s??""}`,"svelte-1oj2amf"),Be(nt,1,`toolbar-btn ${Rr??""}`,"svelte-1oj2amf"),Be(zt,1,`toolbar-btn ${Os??""}`,"svelte-1oj2amf"),Be(Ht,1,`toolbar-btn ${Ur??""}`,"svelte-1oj2amf"),Be(s0,1,`toolbar-btn ${Lr??""}`,"svelte-1oj2amf"),Be(It,1,`toolbar-btn ${Nr??""}`,"svelte-1oj2amf"),yt.disabled=zr,Ze.disabled=Kr},[()=>c(f).isActive("bold")?"active":"",()=>c(f).isActive("italic")?"active":"",()=>c(f).isActive("strike")?"active":"",()=>c(f).isActive("code")?"active":"",()=>c(f).isActive("heading",{level:1})?"active":"",()=>c(f).isActive("heading",{level:2})?"active":"",()=>c(f).isActive("heading",{level:3})?"active":"",()=>c(f).isActive("bulletList")?"active":"",()=>c(f).isActive("orderedList")?"active":"",()=>c(f).isActive("blockquote")?"active":"",()=>c(f).isActive("codeBlock")?"active":"",()=>!c(f).can().undo(),()=>!c(f).can().redo()]),M(N,ne)};$(Ns,N=>{c(F)&&c(f)&&!c(v)&&N(Sr)})}var ns=k(Ns,2),zs=b(ns),Pr=b(zs);M0(Pr,N=>T(u,N),()=>c(u));var Ks=k(ns,2);{var Tr=N=>{var ne=W8();M(N,ne)};$(Ks,N=>{c(v)&&N(Tr)})}Q(()=>{V(X,e.dirName),Ce(a0,"title",c(C)?"Manage editors":"View editors"),Be(ns,1,`flex-1 overflow-auto bg-[#0d0d14] ${c(v)?"hidden":""}`)}),M(n,Xe),He(),r()}wt(["click"]);var J8=U('<div class="flex-1 flex items-center justify-center text-text-3"><span class="i-lucide-loader-2 animate-spin mr-2"></span> Loading document...</div>'),X8=U('<div class="flex-1 flex flex-col items-center justify-center text-text-3 p-6"><span class="i-lucide-file-x text-4xl mb-4"></span> <p class="text-lg mb-2"> </p> <a href="#/" class="text-accent hover:underline">Back to home</a></div>'),Z8=U(`<div class="flex-1 flex flex-col items-center justify-center text-text-3 p-6"><span class="i-lucide-file-question text-4xl mb-4"></span> <p class="text-lg mb-2">This is not a collaborative document</p> <p class="text-sm mb-4">It doesn't contain a .yjs configuration file</p> <a href="#/" class="text-accent hover:underline">Back to home</a></div>`);function Uo(n,e){Oe(e,!0);const t=()=>_e(w0,"$routeStore",r),s=()=>_e(g0,"$treeRootStore",r),[r,x]=mt();let o=L(t),i=L(s);function a(C,E){let F=null;try{const p=Ke.decode(C);p.type==="npub"&&(F=p.data)}catch{return}const g=ce.getState();if(F&&g.isLoggedIn&&g.pubkey===F){const p=g.selectedTree;(!p||p.name!==E)&&ce.setSelectedTree({id:"",name:E,pubkey:F,rootHash:(p==null?void 0:p.rootHash)||"",rootKey:p==null?void 0:p.rootKey,visibility:(p==null?void 0:p.visibility)??"public",created_at:Math.floor(Date.now()/1e3)})}}$e(()=>{const C=c(o).npub,E=c(o).treeName;C&&E&&a(C,E)});let d=ee(null),l=ee(""),u=ee(t0([])),f=ee(!0),h=ee(null),B=L(()=>c(u).some(C=>C.name===".yjs"));$e(()=>{const C=c(i),E=c(o).path;if(!C){T(f,!0);return}T(f,!0),T(h,null);const F=Bt(),g=E.join("/");(async()=>{try{let p;if(E.length===0)p=C,T(l,c(o).treeName||"Document",!0);else{const _=await F.resolvePath(C,g);if(!_){T(h,"Document not found"),T(f,!1);return}p=_.cid,T(l,E[E.length-1],!0)}if(!await F.isDirectory(p)){T(h,"Not a document directory"),T(f,!1);return}const w=await F.listDirectory(p);T(d,p,!0),T(u,w,!0),T(f,!1)}catch(p){console.error("[DocView] Error resolving path:",p),T(h,"Failed to load document"),T(f,!1)}})()});var A=Ie(),D=ge(A);{var v=C=>{var E=J8();M(C,E)},m=C=>{var E=Ie(),F=ge(E);{var g=y=>{var w=X8(),_=k(b(w),2),S=b(_);Q(()=>V(S,c(h))),M(y,w)},p=y=>{var w=Ie(),_=ge(w);{var S=I=>{Q8(I,{get dirCid(){return c(d)},get dirName(){return c(l)},get entries(){return c(u)}})},P=I=>{var R=Ie(),z=ge(R);{var K=O=>{var j=Z8();M(O,j)};$(z,O=>{c(d)&&O(K)},!0)}M(I,R)};$(_,I=>{c(B)&&c(d)?I(S):I(P,!1)},!0)}M(y,w)};$(F,y=>{c(h)?y(g):y(p,!1)},!0)}M(C,E)};$(D,C=>{c(f)?C(v):C(m,!1)})}M(n,A),He(),x()}var ef=U("<span> </span>"),tf=U('<button type="button"><span class="i-lucide-chevron-left"></span> <!></button>');function sf(n,e){Oe(e,!0);let t=it(e,"href",3,"/"),s=it(e,"useHistory",3,!1),r=it(e,"class",3,"");function x(){e.onclick?e.onclick():s()&&window.history.length>1?window.history.back():I0(t())}var o=tf();o.__click=x;var i=k(b(o),2);{var a=d=>{var l=ef(),u=b(l);Q(()=>V(u,e.label)),M(d,l)};$(i,d=>{e.label&&d(a)})}Q(()=>Be(o,1,`btn-ghost flex items-center gap-1 ${r()??""}`)),M(n,o),He()}wt(["click"]);wt(["click"]);var rf=U('<button class="btn-ghost p-1 text-danger" title="Remove relay"><span class="i-lucide-x text-sm"></span></button>'),nf=U('<span class="text-xs text-text-3"> </span>'),xf=U('<div class="flex items-center gap-2 p-3 text-sm"><span></span> <span class="text-text-1 truncate flex-1"> </span> <!></div>'),of=U('<div class="mt-2 flex gap-2"><input type="text" placeholder="wss://relay.example.com" class="flex-1 input text-sm"/> <button class="btn-primary text-sm">Add</button></div> <button class="btn-ghost mt-2 text-xs text-text-3">Reset to defaults</button>',1),af=U('<div class="flex items-center gap-2 p-3 text-sm"><span></span> <span class="text-text-1 truncate flex-1"> </span> <span class="text-xs text-text-3"> </span></div>'),cf=U('<div class="divide-y divide-surface-3"></div>'),lf=U('<div class="bg-surface-2 rounded mt-1"><button class="btn-ghost b-0 flex items-center gap-1 p-3 text-sm text-text-1 w-full"><span></span> </button> <!></div>'),uf=U('<button class="btn-ghost p-1 text-danger" title="Remove server"><span class="i-lucide-x text-sm"></span></button>'),df=U('<div class="flex items-center gap-2 p-3 text-sm"><span class="i-lucide-server text-text-3 shrink-0"></span> <span class="text-text-1 truncate flex-1"> </span> <label class="flex items-center gap-1 text-xs text-text-3 cursor-pointer" title="Allow reads from this server"><input type="checkbox" class="accent-accent"/> read</label> <label class="flex items-center gap-1 text-xs text-text-3 cursor-pointer" title="Allow uploads to this server"><input type="checkbox" class="accent-accent"/> write</label> <!></div>'),ff=U('<div class="p-3 text-sm text-text-3">No servers configured</div>'),hf=U('<div class="mt-2 flex gap-2"><input type="text" placeholder="https://blossom.example.com" class="flex-1 input text-sm"/> <button class="btn-primary text-sm">Add</button></div> <button class="btn-ghost mt-2 text-xs text-text-3">Reset to defaults</button>',1),Ef=U('<span class="text-text-3"> </span>'),Bf=U("<span> </span>"),Cf=U('<div><span class="text-text-3"> </span> <span> </span> <span class="text-text-2"> </span> <span class="text-text-3"> </span> <!></div>'),pf=U('<div class="mt-3"><div class="flex items-center justify-between mb-1"><span class="text-xs text-text-3">Recent activity</span> <button class="btn-ghost text-xs text-text-3">Clear</button></div> <div class="bg-surface-3 rounded text-xs font-mono max-h-32 overflow-y-auto overflow-x-auto p-2 space-y-1"></div></div>'),gf=U('<div class="flex justify-between col-span-2"><span class="text-text-3">Blossom fetches</span> <span class="text-text-1 font-mono"> </span></div>'),Af=U('<div class="flex justify-between col-span-2"><span class="text-danger">Receive errors</span> <span class="text-danger font-mono"> </span></div>'),Ff=U('<div class="bg-surface-2 rounded p-3 mb-3"><div class="grid grid-cols-2 gap-x-4 gap-y-2 text-xs"><div class="flex justify-between"><span class="text-text-3">Reqs sent</span> <span class="text-text-1 font-mono"> </span></div> <div class="flex justify-between"><span class="text-text-3">Reqs received</span> <span class="text-text-1 font-mono"> </span></div> <div class="flex justify-between"><span class="text-text-3">Res sent</span> <span class="text-text-1 font-mono"> </span></div> <div class="flex justify-between"><span class="text-text-3">Res received</span> <span class="text-text-1 font-mono"> </span></div> <!> <!></div></div>'),vf=U('<div class="text-xs text-muted mb-2 font-mono"> </div>'),yf=U('<div class="bg-surface-2 rounded p-3 text-sm text-muted">Login to connect with peers</div>'),Df=U('<div class="bg-surface-2 rounded p-3 text-sm text-muted">No peers connected</div>'),mf=U('<span title="Receive errors from this peer" class="text-danger"><span class="i-lucide-alert-triangle inline-block align-middle mr-0.5"></span> </span>'),wf=U('<div class="mt-2 ml-4 flex flex-wrap gap-x-3 gap-y-1 text-xs text-text-3"><span title="Requests sent to this peer"><span class="i-lucide-arrow-up-right inline-block align-middle mr-0.5"></span> </span> <span title="Requests received from this peer"><span class="i-lucide-arrow-down-left inline-block align-middle mr-0.5"></span> </span> <span title="Responses sent to this peer"><span class="i-lucide-upload inline-block align-middle mr-0.5"></span> </span> <span title="Responses received from this peer"><span class="i-lucide-download inline-block align-middle mr-0.5"></span> </span> <!></div>'),bf=U('<a class="flex flex-col p-3 hover:bg-surface-3 transition-colors no-underline"><div class="flex items-center gap-2 text-sm"><span class="w-2 h-2 rounded-full shrink-0"></span> <!> <span class="text-xs text-muted font-mono shrink-0"> </span></div> <!></a>'),kf=U('<div class="bg-surface-2 rounded divide-y divide-surface-3"></div>'),_f=U('<span class="text-xs text-accent animate-pulse">crawling...</span>'),Sf=U('<span class="flex-1 text-muted truncate"> </span>'),Pf=U('<span class="text-xs text-accent">(you)</span>'),Tf=U('<a class="flex items-center gap-2 p-3 text-sm hover:bg-surface-3 transition-colors"><!> <span class="text-xs text-muted shrink-0"> </span> <!></a>'),Mf=U('<p class="text-xs text-text-3 mt-2">No synced trees yet</p>'),If=U('<span class="i-lucide-check text-success"></span> <span>Copied!</span>',1),Rf=U('<span class="i-lucide-key"></span> <span>Copy secret key</span>',1),Uf=U('<div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-3">Account</h3> <div class="bg-surface-2 rounded p-3"><button class="btn-ghost flex items-center gap-2 text-sm w-full justify-start" data-testid="copy-secret-key"><!></button></div></div>'),Lf=U('<div class="flex-1 flex flex-col min-h-0 bg-surface-0"><div class="border-b border-surface-3 shrink-0"><div class="h-12 px-4 flex items-center gap-3 w-full max-w-2xl mx-auto"><!> <span class="font-semibold text-text-1">Settings</span></div></div> <div class="flex-1 overflow-y-auto p-4 space-y-6 w-full max-w-2xl mx-auto"><div><div class="flex items-center justify-between mb-1"><h3 class="text-xs font-medium text-muted uppercase tracking-wide"> </h3> <button class="btn-ghost text-xs text-accent"> </button></div> <p class="text-xs text-text-3 mb-3">Nostr servers used to find peers and npub/path directories</p> <div class="bg-surface-2 rounded divide-y divide-surface-3"></div> <!> <!></div> <div><div class="flex items-center justify-between mb-1"><h3 class="text-xs font-medium text-muted uppercase tracking-wide"> </h3> <button class="btn-ghost text-xs text-accent"> </button></div> <p class="text-xs text-text-3 mb-3">Fallback servers for file storage</p> <div class="bg-surface-2 rounded divide-y divide-surface-3"></div> <!> <!></div> <div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-1">WebRTC Pools</h3> <p class="text-xs text-text-3 mb-3">Max peer connections by category</p> <div class="bg-surface-2 rounded divide-y divide-surface-3"><div class="p-3"><div class="flex items-center justify-between mb-2"><span class="text-sm text-text-1">Follows</span> <span class="text-xs text-text-3">Peers you follow</span></div> <div class="grid grid-cols-2 gap-3 text-sm"><label class="flex flex-col gap-1"><span class="text-xs text-text-3">Max</span> <input type="number" min="1" max="100" class="input text-sm"/></label> <label class="flex flex-col gap-1"><span class="text-xs text-text-3">Satisfied</span> <input type="number" min="1" max="100" class="input text-sm"/></label></div></div> <div class="p-3"><div class="flex items-center justify-between mb-2"><span class="text-sm text-text-1">Others</span> <span class="text-xs text-text-3">Other peers</span></div> <div class="grid grid-cols-2 gap-3 text-sm"><label class="flex flex-col gap-1"><span class="text-xs text-text-3">Max</span> <input type="number" min="0" max="100" class="input text-sm"/></label> <label class="flex flex-col gap-1"><span class="text-xs text-text-3">Satisfied</span> <input type="number" min="0" max="100" class="input text-sm"/></label></div></div></div> <button class="btn-ghost mt-2 text-xs text-text-3">Reset to defaults</button></div> <div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-1"> </h3> <p class="text-xs text-text-3 mb-3">WebRTC connections for file exchange</p> <!> <!> <!></div> <div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-1 flex items-center gap-2">Social Graph <!></h3> <p class="text-xs text-text-3 mb-3">Follow network used for trust indicators</p> <div class="bg-surface-2 rounded p-3 text-sm space-y-2"><div class="flex justify-between"><span class="text-muted">Users in graph</span> <span class="text-text-1"> </span></div> <div class="flex justify-between"><span class="text-muted">Following</span> <span class="text-text-1"> </span></div></div></div> <div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-3">Local Storage</h3> <div class="bg-surface-2 rounded p-3 text-sm space-y-2"><div class="flex justify-between"><span class="text-muted">Items</span> <span class="text-text-1"> </span></div> <div class="flex justify-between"><span class="text-muted">Size</span> <span class="text-text-1"> </span></div></div></div> <div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-1">Synced Storage</h3> <p class="text-xs text-text-3 mb-3"> </p> <div class="bg-surface-2 rounded divide-y divide-surface-3" data-testid="synced-storage"></div> <!></div> <!> <div><h3 class="text-xs font-medium text-muted uppercase tracking-wide mb-3">About</h3> <p class="text-sm text-text-2 mb-3">hashtree - Content-addressed filesystem on Nostr</p> <div class="bg-surface-2 rounded p-3 text-sm space-y-3"><div class="flex justify-between items-center"><span class="text-muted">Build</span> <span class="text-text-1 font-mono text-xs"> </span></div> <a href="#/npub1g53mukxnjkcmr94fhryzkqutdz2ukq4ks0gvy5af25rgmwsl4ngq43drvk/hashtree-ts" class="btn-ghost w-full flex items-center justify-center gap-2 no-underline"><span class="i-lucide-code text-sm"></span> <span>hashtree-ts</span> <span class="text-text-3 text-xs no-underline">(TypeScript library & this app)</span></a> <a href="#/npub1g53mukxnjkcmr94fhryzkqutdz2ukq4ks0gvy5af25rgmwsl4ngq43drvk/hashtree-rs" class="btn-ghost w-full flex items-center justify-center gap-2 no-underline"><span class="i-lucide-terminal text-sm"></span> <span>hashtree-rs</span> <span class="text-text-3 text-xs no-underline">(Rust CLI & P2P daemon)</span></a> <button class="btn-ghost w-full flex items-center justify-center gap-2"><span class="i-lucide-refresh-cw text-sm"></span> <span>Refresh App</span></button></div></div></div></div>');function Nf(n,e){Oe(e,!0);const t=()=>_e(Ba,"$syncedStorageStore",a),s=()=>_e(ce,"$nostrStore",a),r=()=>_e(Le,"$settingsStore",a),x=()=>_e(ur,"$blossomLogStore",a),o=()=>_e(D0,"$socialGraphStore",a),i=()=>_e(e0,"$appStore",a),[a,d]=mt();let l=L(Hn),u=ee(!1);async function f(){const H=Hn();if(H)try{await navigator.clipboard.writeText(H),T(u,!0),setTimeout(()=>T(u,!1),2e3)}catch(Y){console.error("Failed to copy:",Y)}}let h=L(t),B=L(()=>c(h).reduce((H,Y)=>H+Y.bytes,0)),A=L(()=>s().relayStatuses),D=L(()=>s().discoveredRelays),v=L(()=>s().isLoggedIn),m=L(()=>s().pubkey),C=ee(!1),E=L(()=>r().network),F=ee(""),g=ee(""),p=ee(!1),y=ee(!1),w=L(()=>r().pools),_=L(x);function S(){const H=c(F).trim();if(H){try{if(new URL(H),!H.startsWith("wss://")&&!H.startsWith("ws://"))return}catch{return}c(E).relays.includes(H)||Le.setNetworkSettings({relays:[...c(E).relays,H]}),T(F,"")}}function P(H){Le.setNetworkSettings({relays:c(E).relays.filter(Y=>Y!==H)})}function I(){Le.setNetworkSettings({relays:Ut.relays}),T(p,!1)}function R(){const H=c(g).trim();if(H){try{if(new URL(H),!H.startsWith("https://")&&!H.startsWith("http://"))return}catch{return}c(E).blossomServers.some(Y=>Y.url===H)||Le.setNetworkSettings({blossomServers:[...c(E).blossomServers,{url:H,read:!0,write:!1}]}),T(g,"")}}function z(H){Le.setNetworkSettings({blossomServers:c(E).blossomServers.filter(Y=>Y.url!==H)})}function K(H){Le.setNetworkSettings({blossomServers:c(E).blossomServers.map(Y=>Y.url===H?{...Y,read:!Y.read}:Y)})}function O(H){Le.setNetworkSettings({blossomServers:c(E).blossomServers.map(Y=>Y.url===H?{...Y,write:!Y.write}:Y)})}function j(){Le.setNetworkSettings({blossomServers:Ut.blossomServers}),T(y,!1)}let W=L(()=>o().isRecrawling),J=L(()=>(o().version,$u())),G=L(()=>(o().version,c(m)?ia(c(m)).size:0));function oe(H){switch(H){case"connected":return"bg-success";case"connecting":return"bg-warning";case"error":return"bg-danger";default:return"bg-text-3"}}function le(H){const Y=H.replace(/\/$/,"");return c(A).get(Y)||c(A).get(H)||"disconnected"}let re=L(i),Se=L(()=>c(re).peers),de=L(()=>c(re).stats),ae=L(()=>c(re).myPeerId),xe=L(()=>c(re).webrtcStats),ue=L(()=>c(re).perPeerStats);Fr(()=>{Yu(),Ca(),fo();const H=setInterval(fo,1e3);return()=>clearInterval(H)});function Ct(H){return H.split(":")[1]||H}function ft(H){switch(H){case"connected":return"#3fb950";case"connecting":return"#d29922";case"failed":return"#f85149";default:return"#8b949e"}}function St(H){var Y,Ae;return(Ae=(Y=c(ue))==null?void 0:Y.get(H))==null?void 0:Ae.stats}var ht=Lf(),tt=b(ht),at=b(tt),pt=b(at);sf(pt,{href:"/",useHistory:!0});var bt=k(tt,2),gt=b(bt),be=b(gt),$t=b(be),Xe=b($t),pe=k($t,2);pe.__click=()=>T(p,!c(p));var Re=b(pe),je=k(be,4);Tt(je,21,()=>c(E).relays,Qt,(H,Y)=>{const Ae=L(()=>le(c(Y)));var me=xf(),Ye=b(me),Me=k(Ye,2),he=b(Me),Ve=k(Me,2);{var Te=Ne=>{var Ee=rf();Ee.__click=()=>P(c(Y)),M(Ne,Ee)},xt=Ne=>{var Ee=nf(),et=b(Ee);Q(Kt=>V(et,Kt),[()=>c(Ae).charAt(0).toUpperCase()+c(Ae).slice(1)]),M(Ne,Ee)};$(Ve,Ne=>{c(p)?Ne(Te):Ne(xt,!1)})}Q((Ne,Ee)=>{Be(Ye,1,`w-2 h-2 rounded-full ${Ne??""} shrink-0`),V(he,Ee)},[()=>oe(c(Ae)),()=>(()=>{try{return new URL(c(Y)).hostname}catch{return c(Y)}})()]),M(H,me)});var At=k(je,2);{var Z=H=>{var Y=of(),Ae=ge(Y),me=b(Ae);me.__keydown=he=>he.key==="Enter"&&S();var Ye=k(me,2);Ye.__click=S;var Me=k(Ae,2);Me.__click=I,fs(me,()=>c(F),he=>T(F,he)),M(H,Y)};$(At,H=>{c(p)&&H(Z)})}var X=k(At,2);{var ke=H=>{var Y=lf(),Ae=b(Y);Ae.__click=()=>T(C,!c(C));var me=b(Ae),Ye=k(me),Me=k(Ae,2);{var he=Ve=>{var Te=cf();Tt(Te,21,()=>c(D),Qt,(xt,Ne)=>{var Ee=af(),et=b(Ee),Kt=k(et,2),E0=b(Kt),B0=k(Kt,2),K0=b(B0);Q(($0,qt,Pt)=>{Be(et,1,`w-2 h-2 rounded-full ${$0??""} shrink-0`),V(E0,qt),V(K0,Pt)},[()=>oe(c(Ne).status),()=>(()=>{try{return new URL(c(Ne).url).hostname}catch{return c(Ne).url}})(),()=>c(Ne).status.charAt(0).toUpperCase()+c(Ne).status.slice(1)]),M(xt,Ee)}),M(Ve,Te)};$(Me,Ve=>{c(C)&&Ve(he)})}Q(()=>{Be(me,1,`i-lucide-chevron-right text-sm transition-transform ${c(C)?"rotate-90":""}`),V(Ye,` Discovered relays (${c(D).length??""})`)}),M(H,Y)};$(X,H=>{c(D).length>0&&H(ke)})}var ct=k(gt,2),kt=b(ct),Ft=b(kt),Pe=b(Ft),Fe=k(Ft,2);Fe.__click=()=>T(y,!c(y));var st=b(Fe),lt=k(kt,4);Tt(lt,21,()=>c(E).blossomServers,Qt,(H,Y)=>{var Ae=df(),me=k(b(Ae),2),Ye=b(me),Me=k(me,2),he=b(Me);he.__change=()=>K(c(Y).url);var Ve=k(Me,2),Te=b(Ve);Te.__change=()=>O(c(Y).url);var xt=k(Ve,2);{var Ne=Ee=>{var et=uf();et.__click=()=>z(c(Y).url),M(Ee,et)};$(xt,Ee=>{c(y)&&Ee(Ne)})}Q(Ee=>{V(Ye,Ee),Qx(he,c(Y).read),Qx(Te,c(Y).write)},[()=>(()=>{try{return new URL(c(Y).url).hostname}catch{return c(Y).url}})()]),M(H,Ae)},H=>{var Y=ff();M(H,Y)});var vt=k(lt,2);{var Ot=H=>{var Y=hf(),Ae=ge(Y),me=b(Ae);me.__keydown=he=>he.key==="Enter"&&R();var Ye=k(me,2);Ye.__click=R;var Me=k(Ae,2);Me.__click=j,fs(me,()=>c(g),he=>T(g,he)),M(H,Y)};$(vt,H=>{c(y)&&H(Ot)})}var L0=k(vt,2);{var f0=H=>{var Y=pf(),Ae=b(Y),me=k(b(Ae),2);me.__click=()=>ur.clear();var Ye=k(Ae,2);Tt(Ye,21,()=>c(_),Qt,(Me,he)=>{const Ve=L(()=>new Date(c(he).timestamp).toLocaleTimeString());var Te=Cf(),xt=b(Te),Ne=b(xt),Ee=k(xt,2),et=b(Ee),Kt=k(Ee,2),E0=b(Kt),B0=k(Kt,2),K0=b(B0),$0=k(B0,2);{var qt=Et=>{var Vt=Ef(),c0=b(Vt);Q(()=>V(c0,`${c(he).bytes??""}B`)),M(Et,Vt)},Pt=Et=>{var Vt=Ie(),c0=ge(Vt);{var $r=xs=>{var Hs=Bf(),js=b(Hs);Q(()=>V(js,c(he).error)),M(xs,Hs)};$(c0,xs=>{c(he).error&&xs($r)},!0)}M(Et,Vt)};$($0,Et=>{c(he).success&&c(he).bytes?Et(qt):Et(Pt,!1)})}Q((Et,Vt)=>{Be(Te,1,`flex items-center gap-2 whitespace-nowrap ${c(he).success?"text-success":"text-danger"}`),V(Ne,c(Ve)),V(et,Et),V(E0,c(he).server),V(K0,`${Vt??""}...`)},[()=>c(he).operation.toUpperCase(),()=>c(he).hash.slice(0,8)]),M(Me,Te)}),M(H,Y)};$(L0,H=>{c(_).length>0&&H(f0)})}var _0=k(ct,2),N0=k(b(_0),4),a0=b(N0),z0=k(b(a0),2),rs=b(z0),ps=k(b(rs),2);ps.__change=H=>Le.setPoolSettings({followsMax:parseInt(H.currentTarget.value)||20});var _r=k(rs,2),Ls=k(b(_r),2);Ls.__change=H=>Le.setPoolSettings({followsSatisfied:parseInt(H.currentTarget.value)||10});var Ns=k(a0,2),Sr=k(b(Ns),2),ns=b(Sr),zs=k(b(ns),2);zs.__change=H=>Le.setPoolSettings({otherMax:parseInt(H.currentTarget.value)||10});var Pr=k(ns,2),Ks=k(b(Pr),2);Ks.__change=H=>Le.setPoolSettings({otherSatisfied:parseInt(H.currentTarget.value)||5});var Tr=k(N0,2);Tr.__click=()=>Le.resetPoolSettings();var N=k(_0,2),ne=b(N),fe=b(ne),We=k(ne,4);{var rt=H=>{var Y=Ff(),Ae=b(Y),me=b(Ae),Ye=k(b(me),2),Me=b(Ye),he=k(me,2),Ve=k(b(he),2),Te=b(Ve),xt=k(he,2),Ne=k(b(xt),2),Ee=b(Ne),et=k(xt,2),Kt=k(b(et),2),E0=b(Kt),B0=k(et,2);{var K0=Pt=>{var Et=gf(),Vt=k(b(Et),2),c0=b(Vt);Q(()=>V(c0,c(xe).blossomFetches)),M(Pt,Et)};$(B0,Pt=>{c(xe).blossomFetches>0&&Pt(K0)})}var $0=k(B0,2);{var qt=Pt=>{var Et=Af(),Vt=k(b(Et),2),c0=b(Vt);Q(()=>V(c0,c(xe).receiveErrors)),M(Pt,Et)};$($0,Pt=>{c(xe).receiveErrors>0&&Pt(qt)})}Q(()=>{V(Me,c(xe).requestsSent),V(Te,c(xe).requestsReceived),V(Ee,c(xe).responsesSent),V(E0,c(xe).responsesReceived)}),M(H,Y)};$(We,H=>{c(xe)&&c(v)&&H(rt)})}var ve=k(We,2);{var Ue=H=>{var Y=vf(),Ae=b(Y);Q(()=>V(Ae,`Your ID: ${c(ae)??""}`)),M(H,Y)};$(ve,H=>{c(ae)&&H(Ue)})}var qe=k(ve,2);{var nt=H=>{var Y=yf();M(H,Y)},zt=H=>{var Y=Ie(),Ae=ge(Y);{var me=Me=>{var he=Df();M(Me,he)},Ye=Me=>{var he=kf();Tt(he,21,()=>c(Se),Qt,(Ve,Te)=>{const xt=L(()=>St(c(Te).peerId));var Ne=bf(),Ee=b(Ne),et=b(Ee),Kt=k(et,2);{let qt=L(()=>c(Te).isSelf?"You":`${c(Te).state}${c(Te).pool==="follows"?" (follow)":""}`);q0(Kt,{get pubkey(){return c(Te).pubkey},get description(){return c(qt)},avatarSize:32,showBadge:!0,class:"flex-1 min-w-0"})}var E0=k(Kt,2),B0=b(E0),K0=k(Ee,2);{var $0=qt=>{var Pt=wf(),Et=b(Pt),Vt=k(b(Et),1,!0),c0=k(Et,2),$r=k(b(c0),1,!0),xs=k(c0,2),Hs=k(b(xs),1,!0),js=k(xs,2),Ec=k(b(js),1,!0),Bc=k(js,2);{var Cc=Or=>{var Gx=mf(),pc=k(b(Gx),1,!0);Q(()=>V(pc,c(xt).receiveErrors)),M(Or,Gx)};$(Bc,Or=>{c(xt).receiveErrors>0&&Or(Cc)})}Q(()=>{V(Vt,c(xt).requestsSent),V($r,c(xt).requestsReceived),V(Hs,c(xt).responsesSent),V(Ec,c(xt).responsesReceived)}),M(qt,Pt)};$(K0,qt=>{c(xt)&&c(Te).state==="connected"&&qt($0)})}Q((qt,Pt,Et)=>{Ce(Ne,"href",`#/${qt??""}`),ds(et,`background: ${Pt??""}`),V(B0,Et)},[()=>Ke.npubEncode(c(Te).pubkey),()=>ft(c(Te).state),()=>Ct(c(Te).peerId).slice(0,8)]),M(Ve,Ne)}),M(Me,he)};$(Ae,Me=>{c(Se).length===0?Me(me):Me(Ye,!1)},!0)}M(H,Y)};$(qe,H=>{c(v)?H(zt,!1):H(nt)})}var Ht=k(N,2),s0=b(Ht),It=k(b(s0));{var ut=H=>{var Y=_f();M(H,Y)};$(It,H=>{c(W)&&H(ut)})}var yt=k(s0,4),Ze=b(yt),jt=k(b(Ze),2),r0=b(jt),h0=k(Ze,2),Mr=k(b(h0),2),Ir=b(Mr),$s=k(Ht,2),Rr=k(b($s),2),Os=b(Rr),Ur=k(b(Os),2),Lr=b(Ur),Nr=k(Os,2),zr=k(b(Nr),2),Kr=b(zr),Ox=k($s,2),Hx=k(b(Ox),2),oc=b(Hx),jx=k(Hx,2);Tt(jx,21,()=>c(h),Qt,(H,Y)=>{const Ae=L(()=>(()=>{try{return Ke.decode(c(Y).npub).data}catch{return""}})());var me=Tf(),Ye=b(me);{var Me=Ee=>{{let et=L(()=>`${c(Y).treeCount} tree${c(Y).treeCount>1?"s":""}`);q0(Ee,{get pubkey(){return c(Ae)},get description(){return c(et)},avatarSize:28,showBadge:!0,class:"flex-1 min-w-0"})}},he=Ee=>{var et=Sf(),Kt=b(et);Q(E0=>V(Kt,`${E0??""}...`),[()=>c(Y).npub.slice(0,16)]),M(Ee,et)};$(Ye,Ee=>{c(Ae)?Ee(Me):Ee(he,!1)})}var Ve=k(Ye,2),Te=b(Ve),xt=k(Ve,2);{var Ne=Ee=>{var et=Pf();M(Ee,et)};$(xt,Ee=>{c(Y).isOwn&&Ee(Ne)})}Q(Ee=>{Ce(me,"href",`#/${c(Y).npub??""}`),V(Te,Ee)},[()=>Zr(c(Y).bytes)]),M(H,me)});var ic=k(jx,2);{var ac=H=>{var Y=Mf();M(H,Y)};$(ic,H=>{c(h).length===0&&H(ac)})}var qx=k(Ox,2);{var cc=H=>{var Y=Uf(),Ae=k(b(Y),2),me=b(Ae);me.__click=f;var Ye=b(me);{var Me=Ve=>{var Te=If();M(Ve,Te)},he=Ve=>{var Te=Rf();M(Ve,Te)};$(Ye,Ve=>{c(u)?Ve(Me):Ve(he,!1)})}M(H,Y)};$(qx,H=>{c(l)&&H(cc)})}var lc=k(qx,2),uc=k(b(lc),4),Vx=b(uc),dc=k(b(Vx),2),fc=b(dc),hc=k(Vx,6);hc.__click=()=>window.location.reload(),Q((H,Y,Ae,me,Ye,Me)=>{V(Xe,`Relays (${c(E).relays.length??""})`),V(Re,c(p)?"Done":"Edit"),V(Pe,`Blossom Servers (${c(E).blossomServers.length??""})`),V(st,c(y)?"Done":"Edit"),as(ps,c(w).followsMax),as(Ls,c(w).followsSatisfied),as(zs,c(w).otherMax),as(Ks,c(w).otherSatisfied),V(fe,`Peers (${c(Se).length??""})`),V(r0,H),V(Ir,Y),V(Lr,Ae),V(Kr,me),V(oc,`Autosynced trees (${Ye??""} total)`),V(fc,Me)},[()=>c(J).toLocaleString(),()=>c(G).toLocaleString(),()=>c(de).items.toLocaleString(),()=>Zr(c(de).bytes),()=>Zr(c(B)),()=>(()=>{const H="2025-12-14T16:37:56.396Z";try{return new Date(H).toLocaleString()}catch{return H}})()]),M(n,ht),He(),d()}wt(["click","keydown","change"]);var zf=U('<span class="i-lucide-check text-success text-xs mr-1 inline-block align-middle"></span>'),Kf=U('<span class="i-lucide-copy text-xs mr-1 inline-block align-middle"></span>'),$f=U('<button title="Copy"><!> <span class="font-mono break-all"> </span></button>');function ec(n,e){let t=it(e,"class",3,""),s=ee(!1);async function r(){try{await navigator.clipboard.writeText(e.text),T(s,!0),setTimeout(()=>T(s,!1),2e3)}catch(f){console.error("Failed to copy:",f)}}let x=L(()=>{let f=e.displayText??e.text;if(e.truncate&&f.length>e.truncate){const h=Math.floor((e.truncate-3)/2);f=f.slice(0,h)+"..."+f.slice(-h)}return f});var o=$f();o.__click=r;var i=b(o);{var a=f=>{var h=zf();M(f,h)},d=f=>{var h=Kf();M(f,h)};$(i,f=>{c(s)?f(a):f(d,!1)})}var l=k(i,2),u=b(l);Q(()=>{Be(o,1,`inline text-text-2 hover:text-text-1 bg-transparent border-none cursor-pointer p-0 text-left ${t()??""}`),Ce(o,"data-testid",e.testId),V(u,c(x))}),M(n,o)}wt(["click"]);var Of=U('<img alt="" class="w-full h-full object-cover"/>'),Hf=U('<span class="shrink-0 text-xs text-blue-500 flex items-center gap-1"><!> You</span>'),jf=U('<span class="shrink-0 text-xs text-blue-500 flex items-center gap-1"><!> Following</span>'),qf=U('<span class="shrink-0 text-xs bg-surface-2 text-text-2 px-2 py-0.5 rounded">Follows you</span>'),Vf=U('<button class="btn-ghost" title="Switch user">Switch User</button> <button class="btn-ghost">Edit Profile</button>',1),Gf=U("<button> </button>"),Wf=U('<div class="text-sm text-accent mt-1"> </div>'),Yf=U('<p class="text-sm text-text-2 mt-3 whitespace-pre-wrap break-words"> </p>'),Qf=U('<a target="_blank" rel="noopener noreferrer" class="text-sm text-accent mt-3 inline-block hover:underline"> </a>'),Jf=U('<div class="flex-1 flex flex-col min-h-0 bg-surface-0 overflow-y-auto"><div class="h-32 md:h-40 bg-surface-2 relative shrink-0"><!></div> <div class="px-4 pb-4 -mt-12 relative"><div class="mb-3"><!></div> <div class="flex items-center justify-between gap-2"><div class="flex items-center gap-2 min-w-0"><h1 class="text-xl font-bold text-text-1 m-0 truncate"><!></h1> <!> <!></div> <div class="flex items-center gap-2 shrink-0"><!> <!> <button class="btn-ghost" title="Share"><span class="i-lucide-share text-base"></span></button></div></div> <!> <!> <!> <!> <div class="flex gap-4 mt-4 text-sm"><a class="text-text-2 hover:text-text-1"><span class="font-bold text-text-1"> </span> Following</a> <a class="text-text-2 hover:text-text-1"><span class="font-bold text-text-1"> </span> Known Followers</a></div> <!></div></div>');function Xf(n,e){Oe(e,!0);const t=()=>_e(ce,"$nostrStore",r),s=()=>_e(D0,"$socialGraphStore",r),[r,x]=mt();let o=L(()=>t().pubkey),i=L(()=>t().isLoggedIn),a=L(()=>{try{return Ke.decode(e.npub).data}catch{return""}}),d=L(()=>c(o)===c(a)),l=L(()=>Sx(e.npub)),u=ee(null);$e(()=>c(l).subscribe(ke=>{T(u,ke,!0)}));let f=L(()=>c(o)?dr(c(o)):null),h=ee(t0([]));$e(()=>{if(!c(f)){T(h,[],!0);return}const Z=c(f).subscribe(X=>{T(h,(X==null?void 0:X.follows)||[],!0)});return()=>{var X;Z(),(X=c(f))==null||X.destroy()}});let B=L(()=>c(a)?dr(c(a)):null),A=ee(t0([]));$e(()=>{if(!c(B)){T(A,[],!0);return}const Z=c(B).subscribe(X=>{T(A,(X==null?void 0:X.follows)||[],!0)});return()=>{var X;Z(),(X=c(B))==null||X.destroy()}});let D=L(()=>s().version),v=L(()=>(c(D),c(h).includes(c(a)))),m=L(()=>(c(D),zu(c(a)))),C=L(()=>(c(D),Ku(c(a)))),E=ee(!1),F=ee(!1);function g(Z){window.location.hash=Z}async function p(){T(F,!0),c(v)?await ed(c(a)):await Zu(c(a)),T(F,!1)}var y=Jf(),w=b(y),_=b(w);{var S=Z=>{var X=Of();Q(()=>Ce(X,"src",c(u).banner)),T0("error",X,()=>T(E,!0)),M(Z,X)};$(_,Z=>{var X;(X=c(u))!=null&&X.banner&&!c(E)&&Z(S)})}var P=k(w,2),I=b(P),R=b(I);Is(R,{get pubkey(){return c(a)},size:80,class:"border-4 border-surface-0"});var z=k(I,2),K=b(z),O=b(K),j=b(O);Px(j,{get pubkey(){return c(a)}});var W=k(O,2);{var J=Z=>{var X=Hf(),ke=b(X);Gn(ke,{get pubKeyHex(){return c(a)},size:"sm"}),M(Z,X)},G=Z=>{var X=Ie(),ke=ge(X);{var ct=kt=>{var Ft=jf(),Pe=b(Ft);Gn(Pe,{get pubKeyHex(){return c(a)},size:"sm"}),M(kt,Ft)};$(ke,kt=>{c(v)&&kt(ct)},!0)}M(Z,X)};$(W,Z=>{c(d)?Z(J):Z(G,!1)})}var oe=k(W,2);{var le=Z=>{var X=qf();M(Z,X)};$(oe,Z=>{!c(d)&&c(m)&&Z(le)})}var re=k(K,2),Se=b(re);{var de=Z=>{var X=Vf(),ke=ge(X);ke.__click=()=>g("/users");var ct=k(ke,2);ct.__click=()=>g(`/${e.npub}/edit`),M(Z,X)};$(Se,Z=>{c(i)&&c(d)&&Z(de)})}var ae=k(Se,2);{var xe=Z=>{var X=Gf();X.__click=p;var ke=b(X);Q(()=>{X.disabled=c(F),Be(X,1,pi(c(v)?"btn-ghost":"btn-success")),V(ke,c(F)?"...":c(v)?"Unfollow":"Follow")}),M(Z,X)};$(ae,Z=>{c(i)&&!c(d)&&Z(xe)})}var ue=k(ae,2);ue.__click=()=>Ha(window.location.href);var Ct=k(z,2);{let Z=L(()=>e.npub.slice(0,8)+"..."+e.npub.slice(-4));ec(Ct,{get text(){return e.npub},get displayText(){return c(Z)},class:"text-sm mt-1",testId:"copy-npub"})}var ft=k(Ct,2);{var St=Z=>{var X=Wf(),ke=b(X);Q(()=>V(ke,c(u).nip05)),M(Z,X)};$(ft,Z=>{var X;(X=c(u))!=null&&X.nip05&&Z(St)})}var ht=k(ft,2);{var tt=Z=>{t9(Z,{get pubkey(){return c(a)},class:"mt-2"})};$(ht,Z=>{!c(d)&&c(a)&&Z(tt)})}var at=k(ht,2);{var pt=Z=>{var X=Yf(),ke=b(X);Q(()=>V(ke,c(u).about)),M(Z,X)};$(at,Z=>{var X;(X=c(u))!=null&&X.about&&Z(pt)})}var bt=k(at,2),gt=b(bt),be=b(gt),$t=b(be),Xe=k(gt,2),pe=b(Xe),Re=b(pe),je=k(bt,2);{var At=Z=>{var X=Qf(),ke=b(X);Q(ct=>{Ce(X,"href",ct),V(ke,c(u).website)},[()=>c(u).website.startsWith("http")?c(u).website:`https://${c(u).website}`]),M(Z,X)};$(je,Z=>{var X;(X=c(u))!=null&&X.website&&Z(At)})}Q(()=>{Ce(gt,"href",`#/${e.npub??""}/follows`),V($t,c(A).length),Ce(Xe,"href",`#/${e.npub??""}/followers`),V(Re,c(C).size)}),M(n,y),He(),x()}wt(["click"]);function Zf(n,e){Oe(e,!0);const t=[{pattern:"/",component:ln},{pattern:"/settings",component:Nf},{pattern:"/:npub/profile",component:Xf},{pattern:"/:npub/:treeName/*",component:Uo},{pattern:"/:npub/:treeName",component:Uo},{pattern:"/:npub",component:ln}];let s=L(()=>{for(const o of t){const i=Oc(o.pattern,e.currentPath);if(i.matched)return{component:o.component,params:i.params}}return{component:ln,params:{}}});var r=Ie(),x=ge(r);mc(x,()=>c(s).component,(o,i)=>{i(o,wc(()=>c(s).params))}),M(n,r),He()}var is={},un,Lo;function eh(){return Lo||(Lo=1,un=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),un}var dn={},S0={},No;function ts(){if(No)return S0;No=1;let n;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return S0.getSymbolSize=function(s){if(!s)throw new Error('"version" cannot be null or undefined');if(s<1||s>40)throw new Error('"version" should be in range from 1 to 40');return s*4+17},S0.getSymbolTotalCodewords=function(s){return e[s]},S0.getBCHDigit=function(t){let s=0;for(;t!==0;)s++,t>>>=1;return s},S0.setToSJISFunction=function(s){if(typeof s!="function")throw new Error('"toSJISFunc" is not a valid function.');n=s},S0.isKanjiModeEnabled=function(){return typeof n<"u"},S0.toSJIS=function(s){return n(s)},S0}var fn={},zo;function $x(){return zo||(zo=1,(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+t)}}n.isValid=function(s){return s&&typeof s.bit<"u"&&s.bit>=0&&s.bit<4},n.from=function(s,r){if(n.isValid(s))return s;try{return e(s)}catch{return r}}})(fn)),fn}var hn,Ko;function th(){if(Ko)return hn;Ko=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let s=0;s<t;s++)this.putBit((e>>>t-s-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},hn=n,hn}var En,$o;function sh(){if($o)return En;$o=1;function n(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return n.prototype.set=function(e,t,s,r){const x=e*this.size+t;this.data[x]=s,r&&(this.reservedBit[x]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,s){this.data[e*this.size+t]^=s},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},En=n,En}var Bn={},Oo;function rh(){return Oo||(Oo=1,(function(n){const e=ts().getSymbolSize;n.getRowColCoords=function(s){if(s===1)return[];const r=Math.floor(s/7)+2,x=e(s),o=x===145?26:Math.ceil((x-13)/(2*r-2))*2,i=[x-7];for(let a=1;a<r-1;a++)i[a]=i[a-1]-o;return i.push(6),i.reverse()},n.getPositions=function(s){const r=[],x=n.getRowColCoords(s),o=x.length;for(let i=0;i<o;i++)for(let a=0;a<o;a++)i===0&&a===0||i===0&&a===o-1||i===o-1&&a===0||r.push([x[i],x[a]]);return r}})(Bn)),Bn}var Cn={},Ho;function nh(){if(Ho)return Cn;Ho=1;const n=ts().getSymbolSize,e=7;return Cn.getPositions=function(s){const r=n(s);return[[0,0],[r-e,0],[0,r-e]]},Cn}var pn={},jo;function xh(){return jo||(jo=1,(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};n.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},n.from=function(r){return n.isValid(r)?parseInt(r,10):void 0},n.getPenaltyN1=function(r){const x=r.size;let o=0,i=0,a=0,d=null,l=null;for(let u=0;u<x;u++){i=a=0,d=l=null;for(let f=0;f<x;f++){let h=r.get(u,f);h===d?i++:(i>=5&&(o+=e.N1+(i-5)),d=h,i=1),h=r.get(f,u),h===l?a++:(a>=5&&(o+=e.N1+(a-5)),l=h,a=1)}i>=5&&(o+=e.N1+(i-5)),a>=5&&(o+=e.N1+(a-5))}return o},n.getPenaltyN2=function(r){const x=r.size;let o=0;for(let i=0;i<x-1;i++)for(let a=0;a<x-1;a++){const d=r.get(i,a)+r.get(i,a+1)+r.get(i+1,a)+r.get(i+1,a+1);(d===4||d===0)&&o++}return o*e.N2},n.getPenaltyN3=function(r){const x=r.size;let o=0,i=0,a=0;for(let d=0;d<x;d++){i=a=0;for(let l=0;l<x;l++)i=i<<1&2047|r.get(d,l),l>=10&&(i===1488||i===93)&&o++,a=a<<1&2047|r.get(l,d),l>=10&&(a===1488||a===93)&&o++}return o*e.N3},n.getPenaltyN4=function(r){let x=0;const o=r.data.length;for(let a=0;a<o;a++)x+=r.data[a];return Math.abs(Math.ceil(x*100/o/5)-10)*e.N4};function t(s,r,x){switch(s){case n.Patterns.PATTERN000:return(r+x)%2===0;case n.Patterns.PATTERN001:return r%2===0;case n.Patterns.PATTERN010:return x%3===0;case n.Patterns.PATTERN011:return(r+x)%3===0;case n.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(x/3))%2===0;case n.Patterns.PATTERN101:return r*x%2+r*x%3===0;case n.Patterns.PATTERN110:return(r*x%2+r*x%3)%2===0;case n.Patterns.PATTERN111:return(r*x%3+(r+x)%2)%2===0;default:throw new Error("bad maskPattern:"+s)}}n.applyMask=function(r,x){const o=x.size;for(let i=0;i<o;i++)for(let a=0;a<o;a++)x.isReserved(a,i)||x.xor(a,i,t(r,a,i))},n.getBestMask=function(r,x){const o=Object.keys(n.Patterns).length;let i=0,a=1/0;for(let d=0;d<o;d++){x(d),n.applyMask(d,r);const l=n.getPenaltyN1(r)+n.getPenaltyN2(r)+n.getPenaltyN3(r)+n.getPenaltyN4(r);n.applyMask(d,r),l<a&&(a=l,i=d)}return i}})(pn)),pn}var er={},qo;function tc(){if(qo)return er;qo=1;const n=$x(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],t=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return er.getBlocksCount=function(r,x){switch(x){case n.L:return e[(r-1)*4+0];case n.M:return e[(r-1)*4+1];case n.Q:return e[(r-1)*4+2];case n.H:return e[(r-1)*4+3];default:return}},er.getTotalCodewordsCount=function(r,x){switch(x){case n.L:return t[(r-1)*4+0];case n.M:return t[(r-1)*4+1];case n.Q:return t[(r-1)*4+2];case n.H:return t[(r-1)*4+3];default:return}},er}var gn={},ys={},Vo;function oh(){if(Vo)return ys;Vo=1;const n=new Uint8Array(512),e=new Uint8Array(256);return(function(){let s=1;for(let r=0;r<255;r++)n[r]=s,e[s]=r,s<<=1,s&256&&(s^=285);for(let r=255;r<512;r++)n[r]=n[r-255]})(),ys.log=function(s){if(s<1)throw new Error("log("+s+")");return e[s]},ys.exp=function(s){return n[s]},ys.mul=function(s,r){return s===0||r===0?0:n[e[s]+e[r]]},ys}var Go;function ih(){return Go||(Go=1,(function(n){const e=oh();n.mul=function(s,r){const x=new Uint8Array(s.length+r.length-1);for(let o=0;o<s.length;o++)for(let i=0;i<r.length;i++)x[o+i]^=e.mul(s[o],r[i]);return x},n.mod=function(s,r){let x=new Uint8Array(s);for(;x.length-r.length>=0;){const o=x[0];for(let a=0;a<r.length;a++)x[a]^=e.mul(r[a],o);let i=0;for(;i<x.length&&x[i]===0;)i++;x=x.slice(i)}return x},n.generateECPolynomial=function(s){let r=new Uint8Array([1]);for(let x=0;x<s;x++)r=n.mul(r,new Uint8Array([1,e.exp(x)]));return r}})(gn)),gn}var An,Wo;function ah(){if(Wo)return An;Wo=1;const n=ih();function e(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(s){this.degree=s,this.genPoly=n.generateECPolynomial(this.degree)},e.prototype.encode=function(s){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(s.length+this.degree);r.set(s);const x=n.mod(r,this.genPoly),o=this.degree-x.length;if(o>0){const i=new Uint8Array(this.degree);return i.set(x,o),i}return x},An=e,An}var Fn={},vn={},yn={},Yo;function sc(){return Yo||(Yo=1,yn.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),yn}var l0={},Qo;function rc(){if(Qo)return l0;Qo=1;const n="[0-9]+",e="[A-Z $%*+\\-./:]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const s="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+`)(?:.|[\r
]))+`;l0.KANJI=new RegExp(t,"g"),l0.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),l0.BYTE=new RegExp(s,"g"),l0.NUMERIC=new RegExp(n,"g"),l0.ALPHANUMERIC=new RegExp(e,"g");const r=new RegExp("^"+t+"$"),x=new RegExp("^"+n+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return l0.testKanji=function(a){return r.test(a)},l0.testNumeric=function(a){return x.test(a)},l0.testAlphanumeric=function(a){return o.test(a)},l0}var Jo;function ss(){return Jo||(Jo=1,(function(n){const e=sc(),t=rc();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(x,o){if(!x.ccBits)throw new Error("Invalid mode: "+x);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?x.ccBits[0]:o<27?x.ccBits[1]:x.ccBits[2]},n.getBestModeForData=function(x){return t.testNumeric(x)?n.NUMERIC:t.testAlphanumeric(x)?n.ALPHANUMERIC:t.testKanji(x)?n.KANJI:n.BYTE},n.toString=function(x){if(x&&x.id)return x.id;throw new Error("Invalid mode")},n.isValid=function(x){return x&&x.bit&&x.ccBits};function s(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+r)}}n.from=function(x,o){if(n.isValid(x))return x;try{return s(x)}catch{return o}}})(vn)),vn}var Xo;function ch(){return Xo||(Xo=1,(function(n){const e=ts(),t=tc(),s=$x(),r=ss(),x=sc(),o=7973,i=e.getBCHDigit(o);function a(f,h,B){for(let A=1;A<=40;A++)if(h<=n.getCapacity(A,B,f))return A}function d(f,h){return r.getCharCountIndicator(f,h)+4}function l(f,h){let B=0;return f.forEach(function(A){const D=d(A.mode,h);B+=D+A.getBitsLength()}),B}function u(f,h){for(let B=1;B<=40;B++)if(l(f,B)<=n.getCapacity(B,h,r.MIXED))return B}n.from=function(h,B){return x.isValid(h)?parseInt(h,10):B},n.getCapacity=function(h,B,A){if(!x.isValid(h))throw new Error("Invalid QR Code version");typeof A>"u"&&(A=r.BYTE);const D=e.getSymbolTotalCodewords(h),v=t.getTotalCodewordsCount(h,B),m=(D-v)*8;if(A===r.MIXED)return m;const C=m-d(A,h);switch(A){case r.NUMERIC:return Math.floor(C/10*3);case r.ALPHANUMERIC:return Math.floor(C/11*2);case r.KANJI:return Math.floor(C/13);case r.BYTE:default:return Math.floor(C/8)}},n.getBestVersionForData=function(h,B){let A;const D=s.from(B,s.M);if(Array.isArray(h)){if(h.length>1)return u(h,D);if(h.length===0)return 1;A=h[0]}else A=h;return a(A.mode,A.getLength(),D)},n.getEncodedBits=function(h){if(!x.isValid(h)||h<7)throw new Error("Invalid QR Code version");let B=h<<12;for(;e.getBCHDigit(B)-i>=0;)B^=o<<e.getBCHDigit(B)-i;return h<<12|B}})(Fn)),Fn}var Dn={},Zo;function lh(){if(Zo)return Dn;Zo=1;const n=ts(),e=1335,t=21522,s=n.getBCHDigit(e);return Dn.getEncodedBits=function(x,o){const i=x.bit<<3|o;let a=i<<10;for(;n.getBCHDigit(a)-s>=0;)a^=e<<n.getBCHDigit(a)-s;return(i<<10|a)^t},Dn}var mn={},wn,ei;function uh(){if(ei)return wn;ei=1;const n=ss();function e(t){this.mode=n.NUMERIC,this.data=t.toString()}return e.getBitsLength=function(s){return 10*Math.floor(s/3)+(s%3?s%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(s){let r,x,o;for(r=0;r+3<=this.data.length;r+=3)x=this.data.substr(r,3),o=parseInt(x,10),s.put(o,10);const i=this.data.length-r;i>0&&(x=this.data.substr(r),o=parseInt(x,10),s.put(o,i*3+1))},wn=e,wn}var bn,ti;function dh(){if(ti)return bn;ti=1;const n=ss(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function t(s){this.mode=n.ALPHANUMERIC,this.data=s}return t.getBitsLength=function(r){return 11*Math.floor(r/2)+6*(r%2)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(r){let x;for(x=0;x+2<=this.data.length;x+=2){let o=e.indexOf(this.data[x])*45;o+=e.indexOf(this.data[x+1]),r.put(o,11)}this.data.length%2&&r.put(e.indexOf(this.data[x]),6)},bn=t,bn}var kn,si;function fh(){if(si)return kn;si=1;const n=ss();function e(t){this.mode=n.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}return e.getBitsLength=function(s){return s*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(t){for(let s=0,r=this.data.length;s<r;s++)t.put(this.data[s],8)},kn=e,kn}var _n,ri;function hh(){if(ri)return _n;ri=1;const n=ss(),e=ts();function t(s){this.mode=n.KANJI,this.data=s}return t.getBitsLength=function(r){return r*13},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(s){let r;for(r=0;r<this.data.length;r++){let x=e.toSJIS(this.data[r]);if(x>=33088&&x<=40956)x-=33088;else if(x>=57408&&x<=60351)x-=49472;else throw new Error("Invalid SJIS character: "+this.data[r]+`
Make sure your charset is UTF-8`);x=(x>>>8&255)*192+(x&255),s.put(x,13)}},_n=t,_n}var Sn={exports:{}},ni;function Eh(){return ni||(ni=1,(function(n){var e={single_source_shortest_paths:function(t,s,r){var x={},o={};o[s]=0;var i=e.PriorityQueue.make();i.push(s,0);for(var a,d,l,u,f,h,B,A,D;!i.empty();){a=i.pop(),d=a.value,u=a.cost,f=t[d]||{};for(l in f)f.hasOwnProperty(l)&&(h=f[l],B=u+h,A=o[l],D=typeof o[l]>"u",(D||A>B)&&(o[l]=B,i.push(l,B),x[l]=d))}if(typeof r<"u"&&typeof o[r]>"u"){var v=["Could not find a path from ",s," to ",r,"."].join("");throw new Error(v)}return x},extract_shortest_path_from_predecessor_list:function(t,s){for(var r=[],x=s;x;)r.push(x),t[x],x=t[x];return r.reverse(),r},find_path:function(t,s,r){var x=e.single_source_shortest_paths(t,s,r);return e.extract_shortest_path_from_predecessor_list(x,r)},PriorityQueue:{make:function(t){var s=e.PriorityQueue,r={},x;t=t||{};for(x in s)s.hasOwnProperty(x)&&(r[x]=s[x]);return r.queue=[],r.sorter=t.sorter||s.default_sorter,r},default_sorter:function(t,s){return t.cost-s.cost},push:function(t,s){var r={value:t,cost:s};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=e})(Sn)),Sn.exports}var xi;function Bh(){return xi||(xi=1,(function(n){const e=ss(),t=uh(),s=dh(),r=fh(),x=hh(),o=rc(),i=ts(),a=Eh();function d(v){return unescape(encodeURIComponent(v)).length}function l(v,m,C){const E=[];let F;for(;(F=v.exec(C))!==null;)E.push({data:F[0],index:F.index,mode:m,length:F[0].length});return E}function u(v){const m=l(o.NUMERIC,e.NUMERIC,v),C=l(o.ALPHANUMERIC,e.ALPHANUMERIC,v);let E,F;return i.isKanjiModeEnabled()?(E=l(o.BYTE,e.BYTE,v),F=l(o.KANJI,e.KANJI,v)):(E=l(o.BYTE_KANJI,e.BYTE,v),F=[]),m.concat(C,E,F).sort(function(p,y){return p.index-y.index}).map(function(p){return{data:p.data,mode:p.mode,length:p.length}})}function f(v,m){switch(m){case e.NUMERIC:return t.getBitsLength(v);case e.ALPHANUMERIC:return s.getBitsLength(v);case e.KANJI:return x.getBitsLength(v);case e.BYTE:return r.getBitsLength(v)}}function h(v){return v.reduce(function(m,C){const E=m.length-1>=0?m[m.length-1]:null;return E&&E.mode===C.mode?(m[m.length-1].data+=C.data,m):(m.push(C),m)},[])}function B(v){const m=[];for(let C=0;C<v.length;C++){const E=v[C];switch(E.mode){case e.NUMERIC:m.push([E,{data:E.data,mode:e.ALPHANUMERIC,length:E.length},{data:E.data,mode:e.BYTE,length:E.length}]);break;case e.ALPHANUMERIC:m.push([E,{data:E.data,mode:e.BYTE,length:E.length}]);break;case e.KANJI:m.push([E,{data:E.data,mode:e.BYTE,length:d(E.data)}]);break;case e.BYTE:m.push([{data:E.data,mode:e.BYTE,length:d(E.data)}])}}return m}function A(v,m){const C={},E={start:{}};let F=["start"];for(let g=0;g<v.length;g++){const p=v[g],y=[];for(let w=0;w<p.length;w++){const _=p[w],S=""+g+w;y.push(S),C[S]={node:_,lastCount:0},E[S]={};for(let P=0;P<F.length;P++){const I=F[P];C[I]&&C[I].node.mode===_.mode?(E[I][S]=f(C[I].lastCount+_.length,_.mode)-f(C[I].lastCount,_.mode),C[I].lastCount+=_.length):(C[I]&&(C[I].lastCount=_.length),E[I][S]=f(_.length,_.mode)+4+e.getCharCountIndicator(_.mode,m))}}F=y}for(let g=0;g<F.length;g++)E[F[g]].end=0;return{map:E,table:C}}function D(v,m){let C;const E=e.getBestModeForData(v);if(C=e.from(m,E),C!==e.BYTE&&C.bit<E.bit)throw new Error('"'+v+'" cannot be encoded with mode '+e.toString(C)+`.
 Suggested mode is: `+e.toString(E));switch(C===e.KANJI&&!i.isKanjiModeEnabled()&&(C=e.BYTE),C){case e.NUMERIC:return new t(v);case e.ALPHANUMERIC:return new s(v);case e.KANJI:return new x(v);case e.BYTE:return new r(v)}}n.fromArray=function(m){return m.reduce(function(C,E){return typeof E=="string"?C.push(D(E,null)):E.data&&C.push(D(E.data,E.mode)),C},[])},n.fromString=function(m,C){const E=u(m,i.isKanjiModeEnabled()),F=B(E),g=A(F,C),p=a.find_path(g.map,"start","end"),y=[];for(let w=1;w<p.length-1;w++)y.push(g.table[p[w]].node);return n.fromArray(h(y))},n.rawSplit=function(m){return n.fromArray(u(m,i.isKanjiModeEnabled()))}})(mn)),mn}var oi;function Ch(){if(oi)return dn;oi=1;const n=ts(),e=$x(),t=th(),s=sh(),r=rh(),x=nh(),o=xh(),i=tc(),a=ah(),d=ch(),l=lh(),u=ss(),f=Bh();function h(g,p){const y=g.size,w=x.getPositions(p);for(let _=0;_<w.length;_++){const S=w[_][0],P=w[_][1];for(let I=-1;I<=7;I++)if(!(S+I<=-1||y<=S+I))for(let R=-1;R<=7;R++)P+R<=-1||y<=P+R||(I>=0&&I<=6&&(R===0||R===6)||R>=0&&R<=6&&(I===0||I===6)||I>=2&&I<=4&&R>=2&&R<=4?g.set(S+I,P+R,!0,!0):g.set(S+I,P+R,!1,!0))}}function B(g){const p=g.size;for(let y=8;y<p-8;y++){const w=y%2===0;g.set(y,6,w,!0),g.set(6,y,w,!0)}}function A(g,p){const y=r.getPositions(p);for(let w=0;w<y.length;w++){const _=y[w][0],S=y[w][1];for(let P=-2;P<=2;P++)for(let I=-2;I<=2;I++)P===-2||P===2||I===-2||I===2||P===0&&I===0?g.set(_+P,S+I,!0,!0):g.set(_+P,S+I,!1,!0)}}function D(g,p){const y=g.size,w=d.getEncodedBits(p);let _,S,P;for(let I=0;I<18;I++)_=Math.floor(I/3),S=I%3+y-8-3,P=(w>>I&1)===1,g.set(_,S,P,!0),g.set(S,_,P,!0)}function v(g,p,y){const w=g.size,_=l.getEncodedBits(p,y);let S,P;for(S=0;S<15;S++)P=(_>>S&1)===1,S<6?g.set(S,8,P,!0):S<8?g.set(S+1,8,P,!0):g.set(w-15+S,8,P,!0),S<8?g.set(8,w-S-1,P,!0):S<9?g.set(8,15-S-1+1,P,!0):g.set(8,15-S-1,P,!0);g.set(w-8,8,1,!0)}function m(g,p){const y=g.size;let w=-1,_=y-1,S=7,P=0;for(let I=y-1;I>0;I-=2)for(I===6&&I--;;){for(let R=0;R<2;R++)if(!g.isReserved(_,I-R)){let z=!1;P<p.length&&(z=(p[P]>>>S&1)===1),g.set(_,I-R,z),S--,S===-1&&(P++,S=7)}if(_+=w,_<0||y<=_){_-=w,w=-w;break}}}function C(g,p,y){const w=new t;y.forEach(function(R){w.put(R.mode.bit,4),w.put(R.getLength(),u.getCharCountIndicator(R.mode,g)),R.write(w)});const _=n.getSymbolTotalCodewords(g),S=i.getTotalCodewordsCount(g,p),P=(_-S)*8;for(w.getLengthInBits()+4<=P&&w.put(0,4);w.getLengthInBits()%8!==0;)w.putBit(0);const I=(P-w.getLengthInBits())/8;for(let R=0;R<I;R++)w.put(R%2?17:236,8);return E(w,g,p)}function E(g,p,y){const w=n.getSymbolTotalCodewords(p),_=i.getTotalCodewordsCount(p,y),S=w-_,P=i.getBlocksCount(p,y),I=w%P,R=P-I,z=Math.floor(w/P),K=Math.floor(S/P),O=K+1,j=z-K,W=new a(j);let J=0;const G=new Array(P),oe=new Array(P);let le=0;const re=new Uint8Array(g.buffer);for(let ue=0;ue<P;ue++){const Ct=ue<R?K:O;G[ue]=re.slice(J,J+Ct),oe[ue]=W.encode(G[ue]),J+=Ct,le=Math.max(le,Ct)}const Se=new Uint8Array(w);let de=0,ae,xe;for(ae=0;ae<le;ae++)for(xe=0;xe<P;xe++)ae<G[xe].length&&(Se[de++]=G[xe][ae]);for(ae=0;ae<j;ae++)for(xe=0;xe<P;xe++)Se[de++]=oe[xe][ae];return Se}function F(g,p,y,w){let _;if(Array.isArray(g))_=f.fromArray(g);else if(typeof g=="string"){let z=p;if(!z){const K=f.rawSplit(g);z=d.getBestVersionForData(K,y)}_=f.fromString(g,z||40)}else throw new Error("Invalid data");const S=d.getBestVersionForData(_,y);if(!S)throw new Error("The amount of data is too big to be stored in a QR Code");if(!p)p=S;else if(p<S)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+S+`.
`);const P=C(p,y,_),I=n.getSymbolSize(p),R=new s(I);return h(R,p),B(R),A(R,p),v(R,y,0),p>=7&&D(R,p),m(R,P),isNaN(w)&&(w=o.getBestMask(R,v.bind(null,R,y))),o.applyMask(w,R),v(R,y,w),{modules:R,version:p,errorCorrectionLevel:y,maskPattern:w,segments:_}}return dn.create=function(p,y){if(typeof p>"u"||p==="")throw new Error("No input text");let w=e.M,_,S;return typeof y<"u"&&(w=e.from(y.errorCorrectionLevel,e.M),_=d.from(y.version),S=o.from(y.maskPattern),y.toSJISFunc&&n.setToSJISFunction(y.toSJISFunc)),F(p,_,w,S)},dn}var Pn={},Tn={},ii;function nc(){return ii||(ii=1,(function(n){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let s=t.slice().replace("#","").split("");if(s.length<3||s.length===5||s.length>8)throw new Error("Invalid hex color: "+t);(s.length===3||s.length===4)&&(s=Array.prototype.concat.apply([],s.map(function(x){return[x,x]}))),s.length===6&&s.push("F","F");const r=parseInt(s.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+s.slice(0,6).join("")}}n.getOptions=function(s){s||(s={}),s.color||(s.color={});const r=typeof s.margin>"u"||s.margin===null||s.margin<0?4:s.margin,x=s.width&&s.width>=21?s.width:void 0,o=s.scale||4;return{width:x,scale:x?4:o,margin:r,color:{dark:e(s.color.dark||"#000000ff"),light:e(s.color.light||"#ffffffff")},type:s.type,rendererOpts:s.rendererOpts||{}}},n.getScale=function(s,r){return r.width&&r.width>=s+r.margin*2?r.width/(s+r.margin*2):r.scale},n.getImageWidth=function(s,r){const x=n.getScale(s,r);return Math.floor((s+r.margin*2)*x)},n.qrToImageData=function(s,r,x){const o=r.modules.size,i=r.modules.data,a=n.getScale(o,x),d=Math.floor((o+x.margin*2)*a),l=x.margin*a,u=[x.color.light,x.color.dark];for(let f=0;f<d;f++)for(let h=0;h<d;h++){let B=(f*d+h)*4,A=x.color.light;if(f>=l&&h>=l&&f<d-l&&h<d-l){const D=Math.floor((f-l)/a),v=Math.floor((h-l)/a);A=u[i[D*o+v]?1:0]}s[B++]=A.r,s[B++]=A.g,s[B++]=A.b,s[B]=A.a}}})(Tn)),Tn}var ai;function ph(){return ai||(ai=1,(function(n){const e=nc();function t(r,x,o){r.clearRect(0,0,x.width,x.height),x.style||(x.style={}),x.height=o,x.width=o,x.style.height=o+"px",x.style.width=o+"px"}function s(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(x,o,i){let a=i,d=o;typeof a>"u"&&(!o||!o.getContext)&&(a=o,o=void 0),o||(d=s()),a=e.getOptions(a);const l=e.getImageWidth(x.modules.size,a),u=d.getContext("2d"),f=u.createImageData(l,l);return e.qrToImageData(f.data,x,a),t(u,d,l),u.putImageData(f,0,0),d},n.renderToDataURL=function(x,o,i){let a=i;typeof a>"u"&&(!o||!o.getContext)&&(a=o,o=void 0),a||(a={});const d=n.render(x,o,a),l=a.type||"image/png",u=a.rendererOpts||{};return d.toDataURL(l,u.quality)}})(Pn)),Pn}var Mn={},ci;function gh(){if(ci)return Mn;ci=1;const n=nc();function e(r,x){const o=r.a/255,i=x+'="'+r.hex+'"';return o<1?i+" "+x+'-opacity="'+o.toFixed(2).slice(1)+'"':i}function t(r,x,o){let i=r+x;return typeof o<"u"&&(i+=" "+o),i}function s(r,x,o){let i="",a=0,d=!1,l=0;for(let u=0;u<r.length;u++){const f=Math.floor(u%x),h=Math.floor(u/x);!f&&!d&&(d=!0),r[u]?(l++,u>0&&f>0&&r[u-1]||(i+=d?t("M",f+o,.5+h+o):t("m",a,0),a=0,d=!1),f+1<x&&r[u+1]||(i+=t("h",l),l=0)):a++}return i}return Mn.render=function(x,o,i){const a=n.getOptions(o),d=x.modules.size,l=x.modules.data,u=d+a.margin*2,f=a.color.light.a?"<path "+e(a.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",h="<path "+e(a.color.dark,"stroke")+' d="'+s(l,d,a.margin)+'"/>',B='viewBox="0 0 '+u+" "+u+'"',D='<svg xmlns="http://www.w3.org/2000/svg" '+(a.width?'width="'+a.width+'" height="'+a.width+'" ':"")+B+' shape-rendering="crispEdges">'+f+h+`</svg>
`;return typeof i=="function"&&i(null,D),D},Mn}var li;function Ah(){if(li)return is;li=1;const n=eh(),e=Ch(),t=ph(),s=gh();function r(x,o,i,a,d){const l=[].slice.call(arguments,1),u=l.length,f=typeof l[u-1]=="function";if(!f&&!n())throw new Error("Callback required as last argument");if(f){if(u<2)throw new Error("Too few arguments provided");u===2?(d=i,i=o,o=a=void 0):u===3&&(o.getContext&&typeof d>"u"?(d=a,a=void 0):(d=a,a=i,i=o,o=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(i=o,o=a=void 0):u===2&&!o.getContext&&(a=i,i=o,o=void 0),new Promise(function(h,B){try{const A=e.create(i,a);h(x(A,o,a))}catch(A){B(A)}})}try{const h=e.create(i,a);d(null,x(h,o,a))}catch(h){d(h)}}return is.create=e.create,is.toCanvas=r.bind(null,t.render),is.toDataURL=r.bind(null,t.renderToDataURL),is.toString=r.bind(null,function(x,o,i){return s.render(x,i)}),is}var Fh=Ah();const vh=Ai(Fh);var yh=U('<img alt="QR Code" class="w-full max-h-screen object-contain bg-white" data-testid="share-qr-code"/>'),Dh=U('<div class="w-full aspect-square max-h-screen bg-surface-2 flex-center"><span class="i-lucide-loader-2 animate-spin text-2xl text-text-3"></span></div>'),mh=U('<div class="px-4 pb-4 pt-2"><button class="btn-ghost w-full flex items-center justify-center gap-2"><span class="i-lucide-share"></span> Share via...</button></div>'),wh=U('<div class="fixed inset-0 bg-black/70 flex-center z-1000 overflow-auto" data-testid="share-modal-backdrop"><div class="bg-surface-1 sm:rounded-lg overflow-auto w-screen sm:w-96 sm:border border-surface-3 max-h-full my-auto" data-testid="share-modal"><div class="cursor-pointer"><!></div> <div class="bg-surface-2 p-3 m-4 mb-2 rounded"><!></div> <!></div></div>');function bh(n,e){Oe(e,!0);const t=()=>_e(_t,"$modalsStore",s),[s,r]=mt();let x=L(()=>t().showShareModal),o=L(()=>t().shareUrl),i=ee(null);$e(()=>{if(!c(x)||!c(o)){T(i,null);return}d(c(o)).then(h=>T(i,h,!0))}),$e(()=>{if(!c(x))return;const h=B=>{var A;B.key==="Escape"&&((A=document.activeElement)==null||A.blur(),vs())};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)});async function a(){if(navigator.share&&c(o))try{await navigator.share({url:c(o)})}catch(h){h.name!=="AbortError"&&console.error("Share failed:",h)}}async function d(h){return vh.toDataURL(h,{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}})}var l=Ie(),u=ge(l);{var f=h=>{var B=wh();B.__click=y=>{y.target===y.currentTarget&&vs()};var A=b(B),D=b(A);D.__click=function(...y){vs==null||vs.apply(this,y)};var v=b(D);{var m=y=>{var w=yh();Q(()=>Ce(w,"src",c(i))),M(y,w)},C=y=>{var w=Dh();M(y,w)};$(v,y=>{c(i)?y(m):y(C,!1)})}var E=k(D,2),F=b(E);ec(F,{get text(){return c(o)},truncate:80,class:"text-sm",testId:"share-copy-url"});var g=k(E,2);{var p=y=>{var w=mh(),_=b(w);_.__click=a,M(y,w)};$(g,y=>{typeof navigator<"u"&&"share"in navigator&&y(p)})}M(h,B)};$(u,h=>{c(x)&&c(o)&&h(f)})}M(n,l),He(),r()}wt(["click"]);var xr={exports:{}},kh=xr.exports,ui;function _h(){return ui||(ui=1,(function(n,e){(function(s,r){n.exports=r()})(typeof self<"u"?self:kh,function(){return(function(t){var s={};function r(x){if(s[x])return s[x].exports;var o=s[x]={i:x,l:!1,exports:{}};return t[x].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=s,r.d=function(x,o,i){r.o(x,o)||Object.defineProperty(x,o,{configurable:!1,enumerable:!0,get:i})},r.n=function(x){var o=x&&x.__esModule?function(){return x.default}:function(){return x};return r.d(o,"a",o),o},r.o=function(x,o){return Object.prototype.hasOwnProperty.call(x,o)},r.p="",r(r.s=3)})([(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=(function(){function o(i,a){this.width=a,this.height=i.length/a,this.data=i}return o.createEmpty=function(i,a){return new o(new Uint8ClampedArray(i*a),i)},o.prototype.get=function(i,a){return i<0||i>=this.width||a<0||a>=this.height?!1:!!this.data[a*this.width+i]},o.prototype.set=function(i,a,d){this.data[a*this.width+i]=d?1:0},o.prototype.setRegion=function(i,a,d,l,u){for(var f=a;f<a+l;f++)for(var h=i;h<i+d;h++)this.set(h,f,!!u)},o})();s.BitMatrix=x}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(2);function o(a,d){return a^d}s.addOrSubtractGF=o;var i=(function(){function a(d,l,u){this.primitive=d,this.size=l,this.generatorBase=u,this.expTable=new Array(this.size),this.logTable=new Array(this.size);for(var f=1,h=0;h<this.size;h++)this.expTable[h]=f,f=f*2,f>=this.size&&(f=(f^this.primitive)&this.size-1);for(var h=0;h<this.size-1;h++)this.logTable[this.expTable[h]]=h;this.zero=new x.default(this,Uint8ClampedArray.from([0])),this.one=new x.default(this,Uint8ClampedArray.from([1]))}return a.prototype.multiply=function(d,l){return d===0||l===0?0:this.expTable[(this.logTable[d]+this.logTable[l])%(this.size-1)]},a.prototype.inverse=function(d){if(d===0)throw new Error("Can't invert 0");return this.expTable[this.size-this.logTable[d]-1]},a.prototype.buildMonomial=function(d,l){if(d<0)throw new Error("Invalid monomial degree less than 0");if(l===0)return this.zero;var u=new Uint8ClampedArray(d+1);return u[0]=l,new x.default(this,u)},a.prototype.log=function(d){if(d===0)throw new Error("Can't take log(0)");return this.logTable[d]},a.prototype.exp=function(d){return this.expTable[d]},a})();s.default=i}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(1),o=(function(){function i(a,d){if(d.length===0)throw new Error("No coefficients.");this.field=a;var l=d.length;if(l>1&&d[0]===0){for(var u=1;u<l&&d[u]===0;)u++;if(u===l)this.coefficients=a.zero.coefficients;else{this.coefficients=new Uint8ClampedArray(l-u);for(var f=0;f<this.coefficients.length;f++)this.coefficients[f]=d[u+f]}}else this.coefficients=d}return i.prototype.degree=function(){return this.coefficients.length-1},i.prototype.isZero=function(){return this.coefficients[0]===0},i.prototype.getCoefficient=function(a){return this.coefficients[this.coefficients.length-1-a]},i.prototype.addOrSubtract=function(a){var d;if(this.isZero())return a;if(a.isZero())return this;var l=this.coefficients,u=a.coefficients;l.length>u.length&&(d=[u,l],l=d[0],u=d[1]);for(var f=new Uint8ClampedArray(u.length),h=u.length-l.length,B=0;B<h;B++)f[B]=u[B];for(var B=h;B<u.length;B++)f[B]=x.addOrSubtractGF(l[B-h],u[B]);return new i(this.field,f)},i.prototype.multiply=function(a){if(a===0)return this.field.zero;if(a===1)return this;for(var d=this.coefficients.length,l=new Uint8ClampedArray(d),u=0;u<d;u++)l[u]=this.field.multiply(this.coefficients[u],a);return new i(this.field,l)},i.prototype.multiplyPoly=function(a){if(this.isZero()||a.isZero())return this.field.zero;for(var d=this.coefficients,l=d.length,u=a.coefficients,f=u.length,h=new Uint8ClampedArray(l+f-1),B=0;B<l;B++)for(var A=d[B],D=0;D<f;D++)h[B+D]=x.addOrSubtractGF(h[B+D],this.field.multiply(A,u[D]));return new i(this.field,h)},i.prototype.multiplyByMonomial=function(a,d){if(a<0)throw new Error("Invalid degree less than 0");if(d===0)return this.field.zero;for(var l=this.coefficients.length,u=new Uint8ClampedArray(l+a),f=0;f<l;f++)u[f]=this.field.multiply(this.coefficients[f],d);return new i(this.field,u)},i.prototype.evaluateAt=function(a){var d=0;if(a===0)return this.getCoefficient(0);var l=this.coefficients.length;if(a===1)return this.coefficients.forEach(function(f){d=x.addOrSubtractGF(d,f)}),d;d=this.coefficients[0];for(var u=1;u<l;u++)d=x.addOrSubtractGF(this.field.multiply(a,d),this.coefficients[u]);return d},i})();s.default=o}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(4),o=r(5),i=r(11),a=r(12);function d(f){var h=a.locate(f);if(!h)return null;for(var B=0,A=h;B<A.length;B++){var D=A[B],v=i.extract(f,D),m=o.decode(v.matrix);if(m)return{binaryData:m.bytes,data:m.text,chunks:m.chunks,version:m.version,location:{topRightCorner:v.mappingFunction(D.dimension,0),topLeftCorner:v.mappingFunction(0,0),bottomRightCorner:v.mappingFunction(D.dimension,D.dimension),bottomLeftCorner:v.mappingFunction(0,D.dimension),topRightFinderPattern:D.topRight,topLeftFinderPattern:D.topLeft,bottomLeftFinderPattern:D.bottomLeft,bottomRightAlignmentPattern:D.alignmentPattern}}}return null}var l={inversionAttempts:"attemptBoth"};function u(f,h,B,A){A===void 0&&(A={});var D=l;Object.keys(D||{}).forEach(function(p){D[p]=A[p]||D[p]});var v=D.inversionAttempts==="attemptBoth"||D.inversionAttempts==="invertFirst",m=D.inversionAttempts==="onlyInvert"||D.inversionAttempts==="invertFirst",C=x.binarize(f,h,B,v),E=C.binarized,F=C.inverted,g=d(m?F:E);return!g&&(D.inversionAttempts==="attemptBoth"||D.inversionAttempts==="invertFirst")&&(g=d(m?E:F)),g}u.default=u,s.default=u}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(0),o=8,i=24;function a(u,f,h){return u<f?f:u>h?h:u}var d=(function(){function u(f,h){this.width=f,this.data=new Uint8ClampedArray(f*h)}return u.prototype.get=function(f,h){return this.data[h*this.width+f]},u.prototype.set=function(f,h,B){this.data[h*this.width+f]=B},u})();function l(u,f,h,B){if(u.length!==f*h*4)throw new Error("Malformed data passed to binarizer.");for(var A=new d(f,h),D=0;D<f;D++)for(var v=0;v<h;v++){var m=u[(v*f+D)*4+0],C=u[(v*f+D)*4+1],E=u[(v*f+D)*4+2];A.set(D,v,.2126*m+.7152*C+.0722*E)}for(var F=Math.ceil(f/o),g=Math.ceil(h/o),p=new d(F,g),y=0;y<g;y++)for(var w=0;w<F;w++){for(var _=0,S=1/0,P=0,v=0;v<o;v++)for(var D=0;D<o;D++){var I=A.get(w*o+D,y*o+v);_+=I,S=Math.min(S,I),P=Math.max(P,I)}var R=_/Math.pow(o,2);if(P-S<=i&&(R=S/2,y>0&&w>0)){var z=(p.get(w,y-1)+2*p.get(w-1,y)+p.get(w-1,y-1))/4;S<z&&(R=z)}p.set(w,y,R)}var K=x.BitMatrix.createEmpty(f,h),O=null;B&&(O=x.BitMatrix.createEmpty(f,h));for(var y=0;y<g;y++)for(var w=0;w<F;w++){for(var j=a(w,2,F-3),W=a(y,2,g-3),_=0,J=-2;J<=2;J++)for(var G=-2;G<=2;G++)_+=p.get(j+J,W+G);for(var oe=_/25,J=0;J<o;J++)for(var G=0;G<o;G++){var D=w*o+J,v=y*o+G,le=A.get(D,v);K.set(D,v,le<=oe),B&&O.set(D,v,!(le<=oe))}}return B?{binarized:K,inverted:O}:{binarized:K}}s.binarize=l}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(0),o=r(6),i=r(9),a=r(10);function d(E,F){for(var g=E^F,p=0;g;)p++,g&=g-1;return p}function l(E,F){return F<<1|E}var u=[{bits:21522,formatInfo:{errorCorrectionLevel:1,dataMask:0}},{bits:20773,formatInfo:{errorCorrectionLevel:1,dataMask:1}},{bits:24188,formatInfo:{errorCorrectionLevel:1,dataMask:2}},{bits:23371,formatInfo:{errorCorrectionLevel:1,dataMask:3}},{bits:17913,formatInfo:{errorCorrectionLevel:1,dataMask:4}},{bits:16590,formatInfo:{errorCorrectionLevel:1,dataMask:5}},{bits:20375,formatInfo:{errorCorrectionLevel:1,dataMask:6}},{bits:19104,formatInfo:{errorCorrectionLevel:1,dataMask:7}},{bits:30660,formatInfo:{errorCorrectionLevel:0,dataMask:0}},{bits:29427,formatInfo:{errorCorrectionLevel:0,dataMask:1}},{bits:32170,formatInfo:{errorCorrectionLevel:0,dataMask:2}},{bits:30877,formatInfo:{errorCorrectionLevel:0,dataMask:3}},{bits:26159,formatInfo:{errorCorrectionLevel:0,dataMask:4}},{bits:25368,formatInfo:{errorCorrectionLevel:0,dataMask:5}},{bits:27713,formatInfo:{errorCorrectionLevel:0,dataMask:6}},{bits:26998,formatInfo:{errorCorrectionLevel:0,dataMask:7}},{bits:5769,formatInfo:{errorCorrectionLevel:3,dataMask:0}},{bits:5054,formatInfo:{errorCorrectionLevel:3,dataMask:1}},{bits:7399,formatInfo:{errorCorrectionLevel:3,dataMask:2}},{bits:6608,formatInfo:{errorCorrectionLevel:3,dataMask:3}},{bits:1890,formatInfo:{errorCorrectionLevel:3,dataMask:4}},{bits:597,formatInfo:{errorCorrectionLevel:3,dataMask:5}},{bits:3340,formatInfo:{errorCorrectionLevel:3,dataMask:6}},{bits:2107,formatInfo:{errorCorrectionLevel:3,dataMask:7}},{bits:13663,formatInfo:{errorCorrectionLevel:2,dataMask:0}},{bits:12392,formatInfo:{errorCorrectionLevel:2,dataMask:1}},{bits:16177,formatInfo:{errorCorrectionLevel:2,dataMask:2}},{bits:14854,formatInfo:{errorCorrectionLevel:2,dataMask:3}},{bits:9396,formatInfo:{errorCorrectionLevel:2,dataMask:4}},{bits:8579,formatInfo:{errorCorrectionLevel:2,dataMask:5}},{bits:11994,formatInfo:{errorCorrectionLevel:2,dataMask:6}},{bits:11245,formatInfo:{errorCorrectionLevel:2,dataMask:7}}],f=[function(E){return(E.y+E.x)%2===0},function(E){return E.y%2===0},function(E){return E.x%3===0},function(E){return(E.y+E.x)%3===0},function(E){return(Math.floor(E.y/2)+Math.floor(E.x/3))%2===0},function(E){return E.x*E.y%2+E.x*E.y%3===0},function(E){return(E.y*E.x%2+E.y*E.x%3)%2===0},function(E){return((E.y+E.x)%2+E.y*E.x%3)%2===0}];function h(E){var F=17+4*E.versionNumber,g=x.BitMatrix.createEmpty(F,F);g.setRegion(0,0,9,9,!0),g.setRegion(F-8,0,8,9,!0),g.setRegion(0,F-8,9,8,!0);for(var p=0,y=E.alignmentPatternCenters;p<y.length;p++)for(var w=y[p],_=0,S=E.alignmentPatternCenters;_<S.length;_++){var P=S[_];w===6&&P===6||w===6&&P===F-7||w===F-7&&P===6||g.setRegion(w-2,P-2,5,5,!0)}return g.setRegion(6,9,1,F-17,!0),g.setRegion(9,6,F-17,1,!0),E.versionNumber>6&&(g.setRegion(F-11,0,3,6,!0),g.setRegion(0,F-11,6,3,!0)),g}function B(E,F,g){for(var p=f[g.dataMask],y=E.height,w=h(F),_=[],S=0,P=0,I=!0,R=y-1;R>0;R-=2){R===6&&R--;for(var z=0;z<y;z++)for(var K=I?y-1-z:z,O=0;O<2;O++){var j=R-O;if(!w.get(j,K)){P++;var W=E.get(j,K);p({y:K,x:j})&&(W=!W),S=l(W,S),P===8&&(_.push(S),P=0,S=0)}}I=!I}return _}function A(E){var F=E.height,g=Math.floor((F-17)/4);if(g<=6)return a.VERSIONS[g-1];for(var p=0,y=5;y>=0;y--)for(var w=F-9;w>=F-11;w--)p=l(E.get(w,y),p);for(var _=0,w=5;w>=0;w--)for(var y=F-9;y>=F-11;y--)_=l(E.get(w,y),_);for(var S=1/0,P,I=0,R=a.VERSIONS;I<R.length;I++){var z=R[I];if(z.infoBits===p||z.infoBits===_)return z;var K=d(p,z.infoBits);K<S&&(P=z,S=K),K=d(_,z.infoBits),K<S&&(P=z,S=K)}if(S<=3)return P}function D(E){for(var F=0,g=0;g<=8;g++)g!==6&&(F=l(E.get(g,8),F));for(var p=7;p>=0;p--)p!==6&&(F=l(E.get(8,p),F));for(var y=E.height,w=0,p=y-1;p>=y-7;p--)w=l(E.get(8,p),w);for(var g=y-8;g<y;g++)w=l(E.get(g,8),w);for(var _=1/0,S=null,P=0,I=u;P<I.length;P++){var R=I[P],z=R.bits,K=R.formatInfo;if(z===F||z===w)return K;var O=d(F,z);O<_&&(S=K,_=O),F!==w&&(O=d(w,z),O<_&&(S=K,_=O))}return _<=3?S:null}function v(E,F,g){var p=F.errorCorrectionLevels[g],y=[],w=0;if(p.ecBlocks.forEach(function(W){for(var J=0;J<W.numBlocks;J++)y.push({numDataCodewords:W.dataCodewordsPerBlock,codewords:[]}),w+=W.dataCodewordsPerBlock+p.ecCodewordsPerBlock}),E.length<w)return null;E=E.slice(0,w);for(var _=p.ecBlocks[0].dataCodewordsPerBlock,S=0;S<_;S++)for(var P=0,I=y;P<I.length;P++){var R=I[P];R.codewords.push(E.shift())}if(p.ecBlocks.length>1)for(var z=p.ecBlocks[0].numBlocks,K=p.ecBlocks[1].numBlocks,S=0;S<K;S++)y[z+S].codewords.push(E.shift());for(;E.length>0;)for(var O=0,j=y;O<j.length;O++){var R=j[O];R.codewords.push(E.shift())}return y}function m(E){var F=A(E);if(!F)return null;var g=D(E);if(!g)return null;var p=B(E,F,g),y=v(p,F,g.errorCorrectionLevel);if(!y)return null;for(var w=y.reduce(function(O,j){return O+j.numDataCodewords},0),_=new Uint8ClampedArray(w),S=0,P=0,I=y;P<I.length;P++){var R=I[P],z=i.decode(R.codewords,R.codewords.length-R.numDataCodewords);if(!z)return null;for(var K=0;K<R.numDataCodewords;K++)_[S++]=z[K]}try{return o.decode(_,F.versionNumber)}catch{return null}}function C(E){if(E==null)return null;var F=m(E);if(F)return F;for(var g=0;g<E.width;g++)for(var p=g+1;p<E.height;p++)E.get(g,p)!==E.get(p,g)&&(E.set(g,p,!E.get(g,p)),E.set(p,g,!E.get(p,g)));return m(E)}s.decode=C}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(7),o=r(8),i;(function(A){A.Numeric="numeric",A.Alphanumeric="alphanumeric",A.Byte="byte",A.Kanji="kanji",A.ECI="eci"})(i=s.Mode||(s.Mode={}));var a;(function(A){A[A.Terminator=0]="Terminator",A[A.Numeric=1]="Numeric",A[A.Alphanumeric=2]="Alphanumeric",A[A.Byte=4]="Byte",A[A.Kanji=8]="Kanji",A[A.ECI=7]="ECI"})(a||(a={}));function d(A,D){for(var v=[],m="",C=[10,12,14][D],E=A.readBits(C);E>=3;){var F=A.readBits(10);if(F>=1e3)throw new Error("Invalid numeric value above 999");var g=Math.floor(F/100),p=Math.floor(F/10)%10,y=F%10;v.push(48+g,48+p,48+y),m+=g.toString()+p.toString()+y.toString(),E-=3}if(E===2){var F=A.readBits(7);if(F>=100)throw new Error("Invalid numeric value above 99");var g=Math.floor(F/10),p=F%10;v.push(48+g,48+p),m+=g.toString()+p.toString()}else if(E===1){var F=A.readBits(4);if(F>=10)throw new Error("Invalid numeric value above 9");v.push(48+F),m+=F.toString()}return{bytes:v,text:m}}var l=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function u(A,D){for(var v=[],m="",C=[9,11,13][D],E=A.readBits(C);E>=2;){var F=A.readBits(11),g=Math.floor(F/45),p=F%45;v.push(l[g].charCodeAt(0),l[p].charCodeAt(0)),m+=l[g]+l[p],E-=2}if(E===1){var g=A.readBits(6);v.push(l[g].charCodeAt(0)),m+=l[g]}return{bytes:v,text:m}}function f(A,D){for(var v=[],m="",C=[8,16,16][D],E=A.readBits(C),F=0;F<E;F++){var g=A.readBits(8);v.push(g)}try{m+=decodeURIComponent(v.map(function(p){return"%"+("0"+p.toString(16)).substr(-2)}).join(""))}catch{}return{bytes:v,text:m}}function h(A,D){for(var v=[],m="",C=[8,10,12][D],E=A.readBits(C),F=0;F<E;F++){var g=A.readBits(13),p=Math.floor(g/192)<<8|g%192;p<7936?p+=33088:p+=49472,v.push(p>>8,p&255),m+=String.fromCharCode(o.shiftJISTable[p])}return{bytes:v,text:m}}function B(A,D){for(var v,m,C,E,F=new x.BitStream(A),g=D<=9?0:D<=26?1:2,p={text:"",bytes:[],chunks:[],version:D};F.available()>=4;){var y=F.readBits(4);if(y===a.Terminator)return p;if(y===a.ECI)F.readBits(1)===0?p.chunks.push({type:i.ECI,assignmentNumber:F.readBits(7)}):F.readBits(1)===0?p.chunks.push({type:i.ECI,assignmentNumber:F.readBits(14)}):F.readBits(1)===0?p.chunks.push({type:i.ECI,assignmentNumber:F.readBits(21)}):p.chunks.push({type:i.ECI,assignmentNumber:-1});else if(y===a.Numeric){var w=d(F,g);p.text+=w.text,(v=p.bytes).push.apply(v,w.bytes),p.chunks.push({type:i.Numeric,text:w.text})}else if(y===a.Alphanumeric){var _=u(F,g);p.text+=_.text,(m=p.bytes).push.apply(m,_.bytes),p.chunks.push({type:i.Alphanumeric,text:_.text})}else if(y===a.Byte){var S=f(F,g);p.text+=S.text,(C=p.bytes).push.apply(C,S.bytes),p.chunks.push({type:i.Byte,bytes:S.bytes,text:S.text})}else if(y===a.Kanji){var P=h(F,g);p.text+=P.text,(E=p.bytes).push.apply(E,P.bytes),p.chunks.push({type:i.Kanji,bytes:P.bytes,text:P.text})}}if(F.available()===0||F.readBits(F.available())===0)return p}s.decode=B}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=(function(){function o(i){this.byteOffset=0,this.bitOffset=0,this.bytes=i}return o.prototype.readBits=function(i){if(i<1||i>32||i>this.available())throw new Error("Cannot read "+i.toString()+" bits");var a=0;if(this.bitOffset>0){var d=8-this.bitOffset,l=i<d?i:d,u=d-l,f=255>>8-l<<u;a=(this.bytes[this.byteOffset]&f)>>u,i-=l,this.bitOffset+=l,this.bitOffset===8&&(this.bitOffset=0,this.byteOffset++)}if(i>0){for(;i>=8;)a=a<<8|this.bytes[this.byteOffset]&255,this.byteOffset++,i-=8;if(i>0){var u=8-i,f=255>>u<<u;a=a<<i|(this.bytes[this.byteOffset]&f)>>u,this.bitOffset+=i}}return a},o.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},o})();s.BitStream=x}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.shiftJISTable={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:165,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:8254,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:92,33120:12316,33121:8214,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:8722,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:162,33170:163,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:172,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081}}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(1),o=r(2);function i(u,f,h,B){var A;f.degree()<h.degree()&&(A=[h,f],f=A[0],h=A[1]);for(var D=f,v=h,m=u.zero,C=u.one;v.degree()>=B/2;){var E=D,F=m;if(D=v,m=C,D.isZero())return null;v=E;for(var g=u.zero,p=D.getCoefficient(D.degree()),y=u.inverse(p);v.degree()>=D.degree()&&!v.isZero();){var w=v.degree()-D.degree(),_=u.multiply(v.getCoefficient(v.degree()),y);g=g.addOrSubtract(u.buildMonomial(w,_)),v=v.addOrSubtract(D.multiplyByMonomial(w,_))}if(C=g.multiplyPoly(m).addOrSubtract(F),v.degree()>=D.degree())return null}var S=C.getCoefficient(0);if(S===0)return null;var P=u.inverse(S);return[C.multiply(P),v.multiply(P)]}function a(u,f){var h=f.degree();if(h===1)return[f.getCoefficient(1)];for(var B=new Array(h),A=0,D=1;D<u.size&&A<h;D++)f.evaluateAt(D)===0&&(B[A]=u.inverse(D),A++);return A!==h?null:B}function d(u,f,h){for(var B=h.length,A=new Array(B),D=0;D<B;D++){for(var v=u.inverse(h[D]),m=1,C=0;C<B;C++)D!==C&&(m=u.multiply(m,x.addOrSubtractGF(1,u.multiply(h[C],v))));A[D]=u.multiply(f.evaluateAt(v),u.inverse(m)),u.generatorBase!==0&&(A[D]=u.multiply(A[D],v))}return A}function l(u,f){var h=new Uint8ClampedArray(u.length);h.set(u);for(var B=new x.default(285,256,0),A=new o.default(B,h),D=new Uint8ClampedArray(f),v=!1,m=0;m<f;m++){var C=A.evaluateAt(B.exp(m+B.generatorBase));D[D.length-1-m]=C,C!==0&&(v=!0)}if(!v)return h;var E=new o.default(B,D),F=i(B,B.buildMonomial(f,1),E,f);if(F===null)return null;var g=a(B,F[0]);if(g==null)return null;for(var p=d(B,F[1],g),y=0;y<g.length;y++){var w=h.length-1-B.log(g[y]);if(w<0)return null;h[w]=x.addOrSubtractGF(h[w],p[y])}return h}s.decode=l}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.VERSIONS=[{infoBits:null,versionNumber:1,alignmentPatternCenters:[],errorCorrectionLevels:[{ecCodewordsPerBlock:7,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:13,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:13}]},{ecCodewordsPerBlock:17,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:2,alignmentPatternCenters:[6,18],errorCorrectionLevels:[{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:34}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:28}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]}]},{infoBits:null,versionNumber:3,alignmentPatternCenters:[6,22],errorCorrectionLevels:[{ecCodewordsPerBlock:15,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:55}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:13}]}]},{infoBits:null,versionNumber:4,alignmentPatternCenters:[6,26],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:80}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:32}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:5,alignmentPatternCenters:[6,30],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:43}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:11},{numBlocks:2,dataCodewordsPerBlock:12}]}]},{infoBits:null,versionNumber:6,alignmentPatternCenters:[6,34],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:27}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:31892,versionNumber:7,alignmentPatternCenters:[6,22,38],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:78}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:31}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:13},{numBlocks:1,dataCodewordsPerBlock:14}]}]},{infoBits:34236,versionNumber:8,alignmentPatternCenters:[6,24,42],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:97}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:38},{numBlocks:2,dataCodewordsPerBlock:39}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:18},{numBlocks:2,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:14},{numBlocks:2,dataCodewordsPerBlock:15}]}]},{infoBits:39577,versionNumber:9,alignmentPatternCenters:[6,26,46],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:12},{numBlocks:4,dataCodewordsPerBlock:13}]}]},{infoBits:42195,versionNumber:10,alignmentPatternCenters:[6,28,50],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68},{numBlocks:2,dataCodewordsPerBlock:69}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:43},{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]}]},{infoBits:48118,versionNumber:11,alignmentPatternCenters:[6,30,54],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:81}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:50},{numBlocks:4,dataCodewordsPerBlock:51}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:22},{numBlocks:4,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:12},{numBlocks:8,dataCodewordsPerBlock:13}]}]},{infoBits:51042,versionNumber:12,alignmentPatternCenters:[6,32,58],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:92},{numBlocks:2,dataCodewordsPerBlock:93}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:20},{numBlocks:6,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:55367,versionNumber:13,alignmentPatternCenters:[6,34,62],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:37},{numBlocks:1,dataCodewordsPerBlock:38}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:20},{numBlocks:4,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:11},{numBlocks:4,dataCodewordsPerBlock:12}]}]},{infoBits:58893,versionNumber:14,alignmentPatternCenters:[6,26,46,66],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:40},{numBlocks:5,dataCodewordsPerBlock:41}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:16},{numBlocks:5,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:5,dataCodewordsPerBlock:13}]}]},{infoBits:63784,versionNumber:15,alignmentPatternCenters:[6,26,48,70],errorCorrectionLevels:[{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:87},{numBlocks:1,dataCodewordsPerBlock:88}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:41},{numBlocks:5,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:7,dataCodewordsPerBlock:13}]}]},{infoBits:68472,versionNumber:16,alignmentPatternCenters:[6,26,50,74],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:98},{numBlocks:1,dataCodewordsPerBlock:99}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:70749,versionNumber:17,alignmentPatternCenters:[6,30,54,78],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:1,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22},{numBlocks:15,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:17,dataCodewordsPerBlock:15}]}]},{infoBits:76311,versionNumber:18,alignmentPatternCenters:[6,30,56,82],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:120},{numBlocks:1,dataCodewordsPerBlock:121}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:43},{numBlocks:4,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:1,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:19,dataCodewordsPerBlock:15}]}]},{infoBits:79154,versionNumber:19,alignmentPatternCenters:[6,30,58,86],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:113},{numBlocks:4,dataCodewordsPerBlock:114}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:44},{numBlocks:11,dataCodewordsPerBlock:45}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:21},{numBlocks:4,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:13},{numBlocks:16,dataCodewordsPerBlock:14}]}]},{infoBits:84390,versionNumber:20,alignmentPatternCenters:[6,34,62,90],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:41},{numBlocks:13,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:5,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:15},{numBlocks:10,dataCodewordsPerBlock:16}]}]},{infoBits:87683,versionNumber:21,alignmentPatternCenters:[6,28,50,72,94],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:116},{numBlocks:4,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:16},{numBlocks:6,dataCodewordsPerBlock:17}]}]},{infoBits:92361,versionNumber:22,alignmentPatternCenters:[6,26,50,74,98],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:111},{numBlocks:7,dataCodewordsPerBlock:112}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:13}]}]},{infoBits:96236,versionNumber:23,alignmentPatternCenters:[6,30,54,74,102],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:121},{numBlocks:5,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:47},{numBlocks:14,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:16,dataCodewordsPerBlock:15},{numBlocks:14,dataCodewordsPerBlock:16}]}]},{infoBits:102084,versionNumber:24,alignmentPatternCenters:[6,28,54,80,106],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:45},{numBlocks:14,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:30,dataCodewordsPerBlock:16},{numBlocks:2,dataCodewordsPerBlock:17}]}]},{infoBits:102881,versionNumber:25,alignmentPatternCenters:[6,32,58,84,110],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:106},{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:47},{numBlocks:13,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:110507,versionNumber:26,alignmentPatternCenters:[6,30,58,86,114],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:114},{numBlocks:2,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:46},{numBlocks:4,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:28,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:33,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]}]},{infoBits:110734,versionNumber:27,alignmentPatternCenters:[6,34,62,90,118],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:23},{numBlocks:26,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:117786,versionNumber:28,alignmentPatternCenters:[6,26,50,74,98,122],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:117},{numBlocks:10,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:45},{numBlocks:23,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:24},{numBlocks:31,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:31,dataCodewordsPerBlock:16}]}]},{infoBits:119615,versionNumber:29,alignmentPatternCenters:[6,30,54,78,102,126],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:116},{numBlocks:7,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:21,dataCodewordsPerBlock:45},{numBlocks:7,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:23},{numBlocks:37,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:26,dataCodewordsPerBlock:16}]}]},{infoBits:126325,versionNumber:30,alignmentPatternCenters:[6,26,52,78,104,130],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:115},{numBlocks:10,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:47},{numBlocks:10,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:25,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:25,dataCodewordsPerBlock:16}]}]},{infoBits:127568,versionNumber:31,alignmentPatternCenters:[6,30,56,82,108,134],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:3,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:46},{numBlocks:29,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:24},{numBlocks:1,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:133589,versionNumber:32,alignmentPatternCenters:[6,34,60,86,112,138],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:24},{numBlocks:35,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:35,dataCodewordsPerBlock:16}]}]},{infoBits:136944,versionNumber:33,alignmentPatternCenters:[6,30,58,86,114,142],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:21,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:24},{numBlocks:19,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:141498,versionNumber:34,alignmentPatternCenters:[6,34,62,90,118,146],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:6,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:44,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:59,dataCodewordsPerBlock:16},{numBlocks:1,dataCodewordsPerBlock:17}]}]},{infoBits:145311,versionNumber:35,alignmentPatternCenters:[6,30,54,78,102,126,150],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:121},{numBlocks:7,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:47},{numBlocks:26,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:39,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:41,dataCodewordsPerBlock:16}]}]},{infoBits:150283,versionNumber:36,alignmentPatternCenters:[6,24,50,76,102,128,154],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:121},{numBlocks:14,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:47},{numBlocks:34,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:46,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:64,dataCodewordsPerBlock:16}]}]},{infoBits:152622,versionNumber:37,alignmentPatternCenters:[6,28,54,80,106,132,158],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:46},{numBlocks:14,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:49,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:24,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:158308,versionNumber:38,alignmentPatternCenters:[6,32,58,84,110,136,162],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:122},{numBlocks:18,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:46},{numBlocks:32,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:48,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:15},{numBlocks:32,dataCodewordsPerBlock:16}]}]},{infoBits:161089,versionNumber:39,alignmentPatternCenters:[6,26,54,82,110,138,166],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:40,dataCodewordsPerBlock:47},{numBlocks:7,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:43,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:15},{numBlocks:67,dataCodewordsPerBlock:16}]}]},{infoBits:167017,versionNumber:40,alignmentPatternCenters:[6,30,58,86,114,142,170],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:118},{numBlocks:6,dataCodewordsPerBlock:119}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:18,dataCodewordsPerBlock:47},{numBlocks:31,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:24},{numBlocks:34,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:15},{numBlocks:61,dataCodewordsPerBlock:16}]}]}]}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=r(0);function o(l,u,f,h){var B=l.x-u.x+f.x-h.x,A=l.y-u.y+f.y-h.y;if(B===0&&A===0)return{a11:u.x-l.x,a12:u.y-l.y,a13:0,a21:f.x-u.x,a22:f.y-u.y,a23:0,a31:l.x,a32:l.y,a33:1};var D=u.x-f.x,v=h.x-f.x,m=u.y-f.y,C=h.y-f.y,E=D*C-v*m,F=(B*C-v*A)/E,g=(D*A-B*m)/E;return{a11:u.x-l.x+F*u.x,a12:u.y-l.y+F*u.y,a13:F,a21:h.x-l.x+g*h.x,a22:h.y-l.y+g*h.y,a23:g,a31:l.x,a32:l.y,a33:1}}function i(l,u,f,h){var B=o(l,u,f,h);return{a11:B.a22*B.a33-B.a23*B.a32,a12:B.a13*B.a32-B.a12*B.a33,a13:B.a12*B.a23-B.a13*B.a22,a21:B.a23*B.a31-B.a21*B.a33,a22:B.a11*B.a33-B.a13*B.a31,a23:B.a13*B.a21-B.a11*B.a23,a31:B.a21*B.a32-B.a22*B.a31,a32:B.a12*B.a31-B.a11*B.a32,a33:B.a11*B.a22-B.a12*B.a21}}function a(l,u){return{a11:l.a11*u.a11+l.a21*u.a12+l.a31*u.a13,a12:l.a12*u.a11+l.a22*u.a12+l.a32*u.a13,a13:l.a13*u.a11+l.a23*u.a12+l.a33*u.a13,a21:l.a11*u.a21+l.a21*u.a22+l.a31*u.a23,a22:l.a12*u.a21+l.a22*u.a22+l.a32*u.a23,a23:l.a13*u.a21+l.a23*u.a22+l.a33*u.a23,a31:l.a11*u.a31+l.a21*u.a32+l.a31*u.a33,a32:l.a12*u.a31+l.a22*u.a32+l.a32*u.a33,a33:l.a13*u.a31+l.a23*u.a32+l.a33*u.a33}}function d(l,u){for(var f=i({x:3.5,y:3.5},{x:u.dimension-3.5,y:3.5},{x:u.dimension-6.5,y:u.dimension-6.5},{x:3.5,y:u.dimension-3.5}),h=o(u.topLeft,u.topRight,u.alignmentPattern,u.bottomLeft),B=a(h,f),A=x.BitMatrix.createEmpty(u.dimension,u.dimension),D=function(g,p){var y=B.a13*g+B.a23*p+B.a33;return{x:(B.a11*g+B.a21*p+B.a31)/y,y:(B.a12*g+B.a22*p+B.a32)/y}},v=0;v<u.dimension;v++)for(var m=0;m<u.dimension;m++){var C=m+.5,E=v+.5,F=D(C,E);A.set(m,v,l.get(Math.floor(F.x),Math.floor(F.y)))}return{matrix:A,mappingFunction:D}}s.extract=d}),(function(t,s,r){Object.defineProperty(s,"__esModule",{value:!0});var x=4,o=.5,i=1.5,a=function(C,E){return Math.sqrt(Math.pow(E.x-C.x,2)+Math.pow(E.y-C.y,2))};function d(C){return C.reduce(function(E,F){return E+F})}function l(C,E,F){var g,p,y,w,_=a(C,E),S=a(E,F),P=a(C,F),I,R,z;return S>=_&&S>=P?(g=[E,C,F],I=g[0],R=g[1],z=g[2]):P>=S&&P>=_?(p=[C,E,F],I=p[0],R=p[1],z=p[2]):(y=[C,F,E],I=y[0],R=y[1],z=y[2]),(z.x-R.x)*(I.y-R.y)-(z.y-R.y)*(I.x-R.x)<0&&(w=[z,I],I=w[0],z=w[1]),{bottomLeft:I,topLeft:R,topRight:z}}function u(C,E,F,g){var p=(d(h(C,F,g,5))/7+d(h(C,E,g,5))/7+d(h(F,C,g,5))/7+d(h(E,C,g,5))/7)/4;if(p<1)throw new Error("Invalid module size");var y=Math.round(a(C,E)/p),w=Math.round(a(C,F)/p),_=Math.floor((y+w)/2)+7;switch(_%4){case 0:_++;break;case 2:_--;break}return{dimension:_,moduleSize:p}}function f(C,E,F,g){var p=[{x:Math.floor(C.x),y:Math.floor(C.y)}],y=Math.abs(E.y-C.y)>Math.abs(E.x-C.x),w,_,S,P;y?(w=Math.floor(C.y),_=Math.floor(C.x),S=Math.floor(E.y),P=Math.floor(E.x)):(w=Math.floor(C.x),_=Math.floor(C.y),S=Math.floor(E.x),P=Math.floor(E.y));for(var I=Math.abs(S-w),R=Math.abs(P-_),z=Math.floor(-I/2),K=w<S?1:-1,O=_<P?1:-1,j=!0,W=w,J=_;W!==S+K;W+=K){var G=y?J:W,oe=y?W:J;if(F.get(G,oe)!==j&&(j=!j,p.push({x:G,y:oe}),p.length===g+1))break;if(z+=R,z>0){if(J===P)break;J+=O,z-=I}}for(var le=[],re=0;re<g;re++)p[re]&&p[re+1]?le.push(a(p[re],p[re+1])):le.push(0);return le}function h(C,E,F,g){var p,y=E.y-C.y,w=E.x-C.x,_=f(C,E,F,Math.ceil(g/2)),S=f(C,{x:C.x-w,y:C.y-y},F,Math.ceil(g/2)),P=_.shift()+S.shift()-1;return(p=S.concat(P)).concat.apply(p,_)}function B(C,E){var F=d(C)/d(E),g=0;return E.forEach(function(p,y){g+=Math.pow(C[y]-p*F,2)}),{averageSize:F,error:g}}function A(C,E,F){try{var g=h(C,{x:-1,y:C.y},F,E.length),p=h(C,{x:C.x,y:-1},F,E.length),y={x:Math.max(0,C.x-C.y)-1,y:Math.max(0,C.y-C.x)-1},w=h(C,y,F,E.length),_={x:Math.min(F.width,C.x+C.y)+1,y:Math.min(F.height,C.y+C.x)+1},S=h(C,_,F,E.length),P=B(g,E),I=B(p,E),R=B(w,E),z=B(S,E),K=Math.sqrt(P.error*P.error+I.error*I.error+R.error*R.error+z.error*z.error),O=(P.averageSize+I.averageSize+R.averageSize+z.averageSize)/4,j=(Math.pow(P.averageSize-O,2)+Math.pow(I.averageSize-O,2)+Math.pow(R.averageSize-O,2)+Math.pow(z.averageSize-O,2))/O;return K+j}catch{return 1/0}}function D(C,E){for(var F=Math.round(E.x);C.get(F,Math.round(E.y));)F--;for(var g=Math.round(E.x);C.get(g,Math.round(E.y));)g++;for(var p=(F+g)/2,y=Math.round(E.y);C.get(Math.round(p),y);)y--;for(var w=Math.round(E.y);C.get(Math.round(p),w);)w++;var _=(y+w)/2;return{x:p,y:_}}function v(C){for(var E=[],F=[],g=[],p=[],y=function(G){for(var oe=0,le=!1,re=[0,0,0,0,0],Se=function(ae){var xe=C.get(ae,G);if(xe===le)oe++;else{re=[re[1],re[2],re[3],re[4],oe],oe=1,le=xe;var ue=d(re)/7,Ct=Math.abs(re[0]-ue)<ue&&Math.abs(re[1]-ue)<ue&&Math.abs(re[2]-3*ue)<3*ue&&Math.abs(re[3]-ue)<ue&&Math.abs(re[4]-ue)<ue&&!xe,ft=d(re.slice(-3))/3,St=Math.abs(re[2]-ft)<ft&&Math.abs(re[3]-ft)<ft&&Math.abs(re[4]-ft)<ft&&xe;if(Ct){var ht=ae-re[3]-re[4],tt=ht-re[2],at={startX:tt,endX:ht,y:G},pt=F.filter(function(be){return tt>=be.bottom.startX&&tt<=be.bottom.endX||ht>=be.bottom.startX&&tt<=be.bottom.endX||tt<=be.bottom.startX&&ht>=be.bottom.endX&&re[2]/(be.bottom.endX-be.bottom.startX)<i&&re[2]/(be.bottom.endX-be.bottom.startX)>o});pt.length>0?pt[0].bottom=at:F.push({top:at,bottom:at})}if(St){var bt=ae-re[4],gt=bt-re[3],at={startX:gt,y:G,endX:bt},pt=p.filter(function(Xe){return gt>=Xe.bottom.startX&&gt<=Xe.bottom.endX||bt>=Xe.bottom.startX&&gt<=Xe.bottom.endX||gt<=Xe.bottom.startX&&bt>=Xe.bottom.endX&&re[2]/(Xe.bottom.endX-Xe.bottom.startX)<i&&re[2]/(Xe.bottom.endX-Xe.bottom.startX)>o});pt.length>0?pt[0].bottom=at:p.push({top:at,bottom:at})}}},de=-1;de<=C.width;de++)Se(de);E.push.apply(E,F.filter(function(ae){return ae.bottom.y!==G&&ae.bottom.y-ae.top.y>=2})),F=F.filter(function(ae){return ae.bottom.y===G}),g.push.apply(g,p.filter(function(ae){return ae.bottom.y!==G})),p=p.filter(function(ae){return ae.bottom.y===G})},w=0;w<=C.height;w++)y(w);E.push.apply(E,F.filter(function(G){return G.bottom.y-G.top.y>=2})),g.push.apply(g,p);var _=E.filter(function(G){return G.bottom.y-G.top.y>=2}).map(function(G){var oe=(G.top.startX+G.top.endX+G.bottom.startX+G.bottom.endX)/4,le=(G.top.y+G.bottom.y+1)/2;if(C.get(Math.round(oe),Math.round(le))){var re=[G.top.endX-G.top.startX,G.bottom.endX-G.bottom.startX,G.bottom.y-G.top.y+1],Se=d(re)/re.length,de=A({x:Math.round(oe),y:Math.round(le)},[1,1,3,1,1],C);return{score:de,x:oe,y:le,size:Se}}}).filter(function(G){return!!G}).sort(function(G,oe){return G.score-oe.score}).map(function(G,oe,le){if(oe>x)return null;var re=le.filter(function(de,ae){return oe!==ae}).map(function(de){return{x:de.x,y:de.y,score:de.score+Math.pow(de.size-G.size,2)/G.size,size:de.size}}).sort(function(de,ae){return de.score-ae.score});if(re.length<2)return null;var Se=G.score+re[0].score+re[1].score;return{points:[G].concat(re.slice(0,2)),score:Se}}).filter(function(G){return!!G}).sort(function(G,oe){return G.score-oe.score});if(_.length===0)return null;var S=l(_[0].points[0],_[0].points[1],_[0].points[2]),P=S.topRight,I=S.topLeft,R=S.bottomLeft,z=m(C,g,P,I,R),K=[];z&&K.push({alignmentPattern:{x:z.alignmentPattern.x,y:z.alignmentPattern.y},bottomLeft:{x:R.x,y:R.y},dimension:z.dimension,topLeft:{x:I.x,y:I.y},topRight:{x:P.x,y:P.y}});var O=D(C,P),j=D(C,I),W=D(C,R),J=m(C,g,O,j,W);return J&&K.push({alignmentPattern:{x:J.alignmentPattern.x,y:J.alignmentPattern.y},bottomLeft:{x:W.x,y:W.y},topLeft:{x:j.x,y:j.y},topRight:{x:O.x,y:O.y},dimension:J.dimension}),K.length===0?null:K}s.locate=v;function m(C,E,F,g,p){var y,w,_;try{y=u(g,F,p,C),w=y.dimension,_=y.moduleSize}catch{return null}var S={x:F.x-g.x+p.x,y:F.y-g.y+p.y},P=(a(g,p)+a(g,F))/2/_,I=1-3/P,R={x:g.x+I*(S.x-g.x),y:g.y+I*(S.y-g.y)},z=E.map(function(O){var j=(O.top.startX+O.top.endX+O.bottom.startX+O.bottom.endX)/4,W=(O.top.y+O.bottom.y+1)/2;if(C.get(Math.floor(j),Math.floor(W))){var J=[O.top.endX-O.top.startX,O.bottom.endX-O.bottom.startX,O.bottom.y-O.top.y+1];d(J)/J.length;var G=A({x:Math.floor(j),y:Math.floor(W)},[1,1,1],C),oe=G+a({x:j,y:W},R);return{x:j,y:W,score:oe}}}).filter(function(O){return!!O}).sort(function(O,j){return O.score-j.score}),K=P>=15&&z.length?z[0]:R;return{alignmentPattern:K,dimension:w}}})]).default})})(xr)),xr.exports}var Sh=_h();const Ph=Ai(Sh);var Th=U('<div class="flex items-center justify-center h-full p-4"><p class="text-danger text-center"> </p></div>'),Mh=U('<video class="w-full h-full object-cover" playsinline=""></video> <canvas class="hidden"></canvas> <div class="absolute inset-0 flex items-center justify-center pointer-events-none"><div class="w-2/3 h-2/3 relative"><div class="absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-accent"></div> <div class="absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-accent"></div> <div class="absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-accent"></div> <div class="absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-accent"></div></div></div>',3),Ih=U('<div class="fixed inset-0 bg-black/90 flex items-center justify-center z-[1010]"><div class="relative w-full max-w-md mx-4"><button class="absolute -top-12 right-0 text-white hover:text-accent" aria-label="Close scanner"><span class="i-lucide-x text-2xl"></span></button> <div class="bg-surface-1 rounded-lg overflow-hidden"><div class="p-3 border-b border-surface-3"><h3 class="text-lg font-semibold">Scan QR Code</h3> <p class="text-sm text-text-3">Point camera at a QR code containing an npub</p></div> <div class="relative aspect-square"><!></div> <div class="p-3 border-t border-surface-3"><button class="btn-ghost w-full">Cancel</button></div></div></div></div>');function Rh(n,e){Oe(e,!0);let t=ee(void 0),s=ee(void 0),r=ee(null),x=ee(null),o=ee("");function i(){var F;if(!c(s)||!c(t))return;const E=c(s).getContext("2d",{willReadFrequently:!0});if(E){if(!((F=navigator.mediaDevices)!=null&&F.getUserMedia)){T(o,"Camera access not supported in this browser");return}navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(g=>{T(r,g,!0),c(t)&&(c(t).srcObject=g,c(t).play());const p=()=>{if(!(!c(t)||!c(s)||!E)){if(c(t).readyState===c(t).HAVE_ENOUGH_DATA){c(s).height=c(t).videoHeight,c(s).width=c(t).videoWidth,E.drawImage(c(t),0,0,c(s).width,c(s).height);const y=E.getImageData(0,0,c(s).width,c(s).height),w=Ph(y.data,y.width,y.height,{inversionAttempts:"dontInvert"});if(w){const _=w.data;e.onScanSuccess(_);return}}T(x,requestAnimationFrame(p),!0)}};p()}).catch(g=>{console.error("Error accessing camera:",g),T(o,"Unable to access camera. Please make sure you have granted camera permissions.")})}}function a(){c(x)!==null&&(cancelAnimationFrame(c(x)),T(x,null)),c(r)&&(c(r).getTracks().forEach(E=>E.stop()),T(r,null))}Fr(()=>{i()}),Ci(()=>{a()});function d(){a(),e.onClose()}var l=Ih(),u=b(l),f=b(u);f.__click=d;var h=k(f,2),B=k(b(h),2),A=b(B);{var D=E=>{var F=Th(),g=b(F),p=b(g);Q(()=>V(p,c(o))),M(E,F)},v=E=>{var F=Mh(),g=ge(F);M0(g,y=>T(t,y),()=>c(t));var p=k(g,2);M0(p,y=>T(s,y),()=>c(s)),M(E,F)};$(A,E=>{c(o)?E(D):E(v,!1)})}var m=k(B,2),C=b(m);C.__click=d,M(n,l),He()}wt(["click"]);var Uh=U('<span class="i-lucide-user text-text-3"></span> <span class="flex-1 text-sm font-mono truncate"> </span>',1),Lh=U('<button class="btn-ghost p-1 text-danger shrink-0" title="Remove editor"><span class="i-lucide-x"></span></button>'),Nh=U('<li class="flex items-center gap-2 bg-surface-2 rounded px-3 py-2"><!> <!></li>'),zh=U('<div class="space-y-2"><label class="text-sm font-medium">Current editors:</label> <ul class="space-y-1 list-none m-0 p-0"></ul></div>'),Kh=U('<div class="text-sm text-text-3 bg-surface-2 rounded px-3 py-2">No editors yet.<!></div>'),$h=U('<span class="text-text-3 text-sm">Invalid npub</span>'),Oh=U('<div class="space-y-2"><label class="text-sm font-medium">Add this editor?</label> <div class="bg-surface-2 rounded p-3 space-y-3"><div class="flex items-center gap-3"><!></div> <div class="flex gap-2"><button class="btn-ghost flex-1 text-sm">Cancel</button> <button class="btn-success flex-1 text-sm">Add User</button></div></div></div>'),Hh=U('<span class="text-text-3 text-sm">Invalid npub</span>'),jh=U('<div class="space-y-2"><label class="text-sm font-medium">Add this editor?</label> <div class="bg-surface-2 rounded p-3 space-y-3"><div class="flex items-center gap-3"><!></div> <div class="flex gap-2"><button class="btn-ghost flex-1 text-sm">Cancel</button> <button class="btn-success flex-1 text-sm">Add User</button></div></div></div>'),qh=U('<button class="w-full px-3 py-2 hover:bg-surface-3 text-left"><!></button>'),Vh=U('<div class="absolute top-full left-0 right-0 mt-1 bg-surface-2 rounded border border-surface-3 shadow-lg z-10 max-h-48 overflow-auto"></div>'),Gh=U('<div class="relative"><div class="flex gap-2"><div class="relative flex-1"><span class="i-lucide-search absolute left-3 top-1/2 -translate-y-1/2 text-text-3 text-sm"></span> <input type="text" placeholder="Search followed users..." class="input w-full pl-9 text-sm"/></div></div> <!></div>'),Wh=U('<div class="flex items-center gap-2 text-xs text-text-3"><span class="flex-1 h-px bg-surface-3"></span> <span>or paste npub</span> <span class="flex-1 h-px bg-surface-3"></span></div>'),Yh=U('<div class="flex gap-2"><input type="text" placeholder="npub1..." class="input flex-1 font-mono text-sm"/> <button class="btn-ghost px-2" title="Scan QR code"><span class="i-lucide-qr-code text-lg"></span></button> <button class="btn-success px-3">Add</button></div>'),Qh=U('<p class="text-sm text-danger"> </p>'),Jh=U('<div class="space-y-2"><label class="text-sm font-medium">Add editor:</label> <!> <!> <!> <!></div>'),Xh=U('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70" data-modal-backdrop=""><div class="bg-surface-1 rounded-lg shadow-lg w-full max-w-md mx-4 border border-surface-3"><div class="flex items-center justify-between px-4 py-3 b-b-1 b-b-solid b-b-surface-3"><h2 class="text-lg font-semibold"> </h2> <button class="btn-ghost p-1" aria-label="Close"><span class="i-lucide-x text-lg"></span></button></div> <div class="p-4 space-y-4"><p class="text-sm text-text-3"> </p> <!> <!> <!> <!></div> <div class="flex justify-end gap-2 px-4 py-3 b-t-1 b-t-solid b-t-surface-3"><button class="btn-ghost">Close</button></div></div></div> <!>',1);function Zh(n,e){Oe(e,!0);const t=()=>_e(_t,"$modalsStore",s),[s,r]=mt();let x=L(()=>t().showCollaboratorsModal),o=L(()=>t().collaboratorsTarget),i=ee(t0([])),a=ee(""),d=ee(null),l=ee(null),u=ee(!1),f=ee(""),h=ee(!1),B=L(()=>Nt.getState()),A=L(()=>c(B).pubkey),D=L(()=>dr(c(A))),v=ee(t0([]));$e(()=>{if(!c(D)){T(v,[],!0);return}const j=c(D).subscribe(W=>{T(v,(W==null?void 0:W.follows)||[],!0)});return()=>{j(),c(D).destroy()}});let m=L(()=>{if(c(v).length===0)return null;const j=[];for(const W of c(v))try{const J=Ke.npubEncode(W);j.push({pubkey:W,npub:J})}catch{}return new es(j,{keys:["npub","pubkey"],includeScore:!0,threshold:.4})}),C=L(()=>!c(m)||!c(f).trim()?[]:c(m).search(c(f).trim(),{limit:6}).map(W=>W.item).filter(W=>!c(i).includes(W.npub)));$e(()=>{c(x)&&c(o)&&(T(i,[...c(o).npubs],!0),T(a,""),T(d,null),T(l,null),T(u,!1),T(f,""),T(h,!1))});let E=L(()=>{var j;return!!((j=c(o))!=null&&j.onSave)});function F(j){if(!j.trim())return{valid:!1,error:"Please enter an npub"};if(!j.startsWith("npub1")||j.length!==63)return{valid:!1,error:"Invalid npub format. Must start with npub1 and be 63 characters."};try{return Ke.decode(j).type!=="npub"?{valid:!1,error:"Invalid npub format"}:{valid:!0}}catch{return{valid:!1,error:"Invalid npub"}}}function g(j){const W=j.trim();if(W.startsWith("npub1")&&W.length===63)return W;const J=W.match(/npub1[a-z0-9]{58}/i);if(J)return J[0].toLowerCase();if(/^[a-f0-9]{64}$/i.test(W))try{return Ke.npubEncode(W)}catch{return null}return null}let p=L(()=>{if(c(l))return null;const j=c(a).trim();return!j||!j.startsWith("npub1")||j.length!==63||c(i).includes(j)?null:j});function y(){const j=c(a).trim(),W=F(j);if(!W.valid){T(d,W.error||"Invalid npub",!0);return}if(c(i).includes(j)){T(d,"This npub is already in the list.");return}T(l,j,!0),T(a,""),T(d,null),T(h,!1)}function w(){var W;if(!c(l)||!((W=c(o))!=null&&W.onSave))return;const j=[...c(i),c(l)];T(i,j,!0),T(l,null),c(o).onSave(j)}function _(j){var J;const W=c(i).filter((G,oe)=>oe!==j);T(i,W,!0),(J=c(o))!=null&&J.onSave&&c(o).onSave(W)}function S(j){const W=g(j);if(T(u,!1),W){if(c(i).includes(W)){T(d,"This npub is already in the list.");return}T(l,W,!0),T(d,null)}else T(d,"Could not find an npub in the scanned QR code.")}function P(j){if(c(i).includes(j.npub)){T(d,"This npub is already in the list.");return}T(l,j.npub,!0),T(f,""),T(h,!1),T(d,null)}function I(){f8()}function R(j){j.key==="Escape"&&(j.preventDefault(),c(u)?T(u,!1):c(l)?T(l,null):I())}$e(()=>{if(c(x))return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)});var z=Ie(),K=ge(z);{var O=j=>{var W=Xh(),J=ge(W);J.__click=I;var G=b(J);G.__click=pe=>pe.stopPropagation();var oe=b(G),le=b(oe),re=b(le),Se=k(le,2);Se.__click=I;var de=k(oe,2),ae=b(de),xe=b(ae),ue=k(ae,2);{var Ct=pe=>{var Re=zh(),je=k(b(Re),2);Tt(je,21,()=>c(i),Qt,(At,Z,X)=>{const ke=L(()=>bs(c(Z)));var ct=Nh(),kt=b(ct);{var Ft=lt=>{q0(lt,{get pubkey(){return c(ke)},avatarSize:32,class:"flex-1 min-w-0"})},Pe=lt=>{var vt=Uh(),Ot=k(ge(vt),2),L0=b(Ot);Q(()=>V(L0,c(Z))),M(lt,vt)};$(kt,lt=>{c(ke)?lt(Ft):lt(Pe,!1)})}var Fe=k(kt,2);{var st=lt=>{var vt=Lh();vt.__click=()=>_(X),M(lt,vt)};$(Fe,lt=>{c(E)&&lt(st)})}M(At,ct)}),M(pe,Re)},ft=pe=>{var Re=Kh(),je=k(b(Re));{var At=Z=>{var X=bc("Add one below.");M(Z,X)};$(je,Z=>{c(E)&&Z(At)})}M(pe,Re)};$(ue,pe=>{c(i).length>0?pe(Ct):pe(ft,!1)})}var St=k(ue,2);{var ht=pe=>{const Re=L(()=>bs(c(l)));var je=Oh(),At=k(b(je),2),Z=b(At),X=b(Z);{var ke=Fe=>{q0(Fe,{get pubkey(){return c(Re)},avatarSize:40})},ct=Fe=>{var st=$h();M(Fe,st)};$(X,Fe=>{c(Re)?Fe(ke):Fe(ct,!1)})}var kt=k(Z,2),Ft=b(kt);Ft.__click=()=>T(l,null);var Pe=k(Ft,2);Pe.__click=w,Q(()=>Pe.disabled=!c(Re)),M(pe,je)};$(St,pe=>{c(l)&&c(E)&&pe(ht)})}var tt=k(St,2);{var at=pe=>{const Re=L(()=>bs(c(p)));var je=jh(),At=k(b(je),2),Z=b(At),X=b(Z);{var ke=Fe=>{q0(Fe,{get pubkey(){return c(Re)},avatarSize:40})},ct=Fe=>{var st=Hh();M(Fe,st)};$(X,Fe=>{c(Re)?Fe(ke):Fe(ct,!1)})}var kt=k(Z,2),Ft=b(kt);Ft.__click=()=>T(a,"");var Pe=k(Ft,2);Pe.__click=()=>{var st;if(!c(p)||!((st=c(o))!=null&&st.onSave))return;const Fe=[...c(i),c(p)];T(i,Fe,!0),T(a,""),T(d,null),c(o).onSave(Fe)},Q(()=>Pe.disabled=!c(Re)),M(pe,je)};$(tt,pe=>{c(p)&&!c(l)&&c(E)&&pe(at)})}var pt=k(tt,2);{var bt=pe=>{var Re=Jh(),je=k(b(Re),2);{var At=Pe=>{var Fe=Gh(),st=b(Fe),lt=b(st),vt=k(b(lt),2);vt.__input=()=>{T(h,!0),T(d,null)};var Ot=k(st,2);{var L0=f0=>{var _0=Vh();Tt(_0,21,()=>c(C),Qt,(N0,a0)=>{var z0=qh();z0.__click=()=>P(c(a0));var rs=b(z0);q0(rs,{get pubkey(){return c(a0).pubkey},avatarSize:28}),M(N0,z0)}),M(f0,_0)};$(Ot,f0=>{c(h)&&c(C).length>0&&f0(L0)})}T0("focus",vt,()=>T(h,!0)),fs(vt,()=>c(f),f0=>T(f,f0)),M(Pe,Fe)};$(je,Pe=>{c(v).length>0&&Pe(At)})}var Z=k(je,2);{var X=Pe=>{var Fe=Wh();M(Pe,Fe)};$(Z,Pe=>{c(v).length>0&&Pe(X)})}var ke=k(Z,2);{var ct=Pe=>{var Fe=Yh(),st=b(Fe);st.__keydown=Ot=>Ot.key==="Enter"&&y();var lt=k(st,2);lt.__click=()=>T(u,!0);var vt=k(lt,2);vt.__click=y,Q(Ot=>vt.disabled=Ot,[()=>!c(a).trim()]),fs(st,()=>c(a),Ot=>T(a,Ot)),M(Pe,Fe)};$(ke,Pe=>{c(p)||Pe(ct)})}var kt=k(ke,2);{var Ft=Pe=>{var Fe=Qh(),st=b(Fe);Q(()=>V(st,c(d))),M(Pe,Fe)};$(kt,Pe=>{c(d)&&Pe(Ft)})}M(pe,Re)};$(pt,pe=>{c(E)&&!c(l)&&pe(bt)})}var gt=k(de,2),be=b(gt);be.__click=I;var $t=k(J,2);{var Xe=pe=>{Rh(pe,{onScanSuccess:S,onClose:()=>T(u,!1)})};$($t,pe=>{c(u)&&pe(Xe)})}Q(()=>{V(re,c(E)?"Manage Editors":"Editors"),V(xe,c(E)?"Add editors by their npub to merge their edits into this document.":"Users who can edit this document. Their changes will be merged.")}),M(j,W)};$(K,j=>{c(x)&&c(o)&&j(O)})}M(n,z),He(),r()}wt(["click","input","keydown"]);var eE=U('<button type="button"><span></span> <span class="text-sm capitalize"> </span></button>'),tE=U('<div><label class="text-sm text-text-2 mb-2 block">Visibility</label> <div class="flex gap-2"></div> <p class="text-xs text-text-3 mt-2"> </p></div>');function xc(n,e){Oe(e,!0);function t(a){switch(a){case"public":return"Anyone can browse this folder";case"unlisted":return"Only accessible with a special link";case"private":return"Only you can access this folder"}}function s(a){switch(a){case"public":return"i-lucide-globe";case"unlisted":return"i-lucide-link";case"private":return"i-lucide-lock"}}var r=tE(),x=k(b(r),2);Tt(x,20,()=>["public","unlisted","private"],Qt,(a,d)=>{var l=eE();l.__click=()=>e.onchange(d);var u=b(l),f=k(u,2),h=b(f);Q((B,A)=>{Be(l,1,`flex-1 flex items-center justify-center gap-2 py-2 px-3 btn-ghost ${e.value===d?"ring-2 ring-accent bg-surface-3":""}`),Ce(l,"title",B),Be(u,1,A),V(h,d)},[()=>t(d),()=>pi(s(d))]),M(a,l)});var o=k(x,2),i=b(o);Q(a=>V(i,a),[()=>t(e.value)]),M(n,r),He()}wt(["click"]);var sE=U('<p class="text-danger text-sm mb-4"> </p>'),rE=U('<span class="i-lucide-loader-2 animate-spin mr-2"></span> Forking...',1),nE=U('<span class="i-lucide-git-fork mr-2"></span> Fork',1),xE=U(`<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"><div class="bg-surface-1 rounded-lg shadow-lg p-6 w-full max-w-md mx-4"><h2 class="text-lg font-semibold mb-2">Fork as New Folder</h2> <p class="text-text-2 text-sm mb-4">Create a new top-level folder with a copy of this directory's contents.</p> <div class="mb-4"><label for="fork-name" class="block text-sm font-medium text-text-2 mb-1">Folder name</label> <input id="fork-name" type="text" placeholder="Enter folder name..." class="w-full px-3 py-2 bg-surface-2 border border-surface-3 rounded text-text-1 placeholder:text-text-3 focus:outline-none focus:border-accent"/></div> <div class="mb-4"><!></div> <!> <div class="flex justify-end gap-2"><button class="btn-ghost px-4 py-2">Cancel</button> <button class="btn-primary px-4 py-2"><!></button></div></div></div>`);function oE(n,e){Oe(e,!0);const t=()=>_e(_t,"$modalsStore",s),[s,r]=mt();let x=L(()=>t().showForkModal),o=L(()=>t().forkTarget),i=L(()=>t().modalInput),a=ee(!1),d=ee(""),l=ee(void 0),u=ee("public");$e(()=>{c(x)&&T(u,"public")}),$e(()=>{c(x)&&c(l)&&(c(l).focus(),c(l).select())});async function f(){if(!c(o)||!c(i).trim())return;const v=c(i).trim();if(!v){T(d,"Name is required");return}T(a,!0),T(d,"");try{(await zx(c(o).dirCid,v,c(u))).success?H0():T(d,"Failed to create fork. Please try again.")}catch(m){console.error("Fork error:",m),T(d,m instanceof Error?m.message:"Failed to create fork",!0)}finally{T(a,!1)}}function h(v){v.key==="Enter"&&!c(a)&&(v.preventDefault(),f())}var B=Ie(),A=ge(B);{var D=v=>{var m=xE();m.__click=function(...K){H0==null||H0.apply(this,K)};var C=b(m);C.__click=K=>K.stopPropagation();var E=k(b(C),4),F=k(b(E),2);F.__input=K=>ja(K.target.value),F.__keydown=h,M0(F,K=>T(l,K),()=>c(l));var g=k(E,2),p=b(g);xc(p,{get value(){return c(u)},onchange:K=>T(u,K,!0)});var y=k(g,2);{var w=K=>{var O=sE(),j=b(O);Q(()=>V(j,c(d))),M(K,O)};$(y,K=>{c(d)&&K(w)})}var _=k(y,2),S=b(_);S.__click=function(...K){H0==null||H0.apply(this,K)};var P=k(S,2);P.__click=f;var I=b(P);{var R=K=>{var O=rE();M(K,O)},z=K=>{var O=nE();M(K,O)};$(I,K=>{c(a)?K(R):K(z,!1)})}Q(K=>{as(F,c(i)),F.disabled=c(a),S.disabled=c(a),P.disabled=K},[()=>c(a)||!c(i).trim()]),M(v,m)};$(A,v=>{c(x)&&c(o)&&v(D)})}M(n,B),He(),r()}wt(["click","input","keydown"]);var iE=U('<button class="btn-ghost p-1"><span class="i-lucide-x"></span></button>'),aE=U('<p class="text-sm text-text-3 italic">No Blossom servers configured</p>'),cE=U('<label class="flex items-center gap-2 p-2 rounded bg-surface-2 cursor-pointer hover:bg-surface-3"><input type="checkbox" class="accent-accent"/> <span class="i-lucide-server text-text-3"></span> <span class="text-sm"> </span></label>'),lE=U('<div class="space-y-2"></div>'),uE=U('<div class="mb-4"><p class="text-sm text-text-3 mb-2">Push <span class="text-text-1 font-medium"> </span> </p> <!></div> <div class="flex justify-end gap-2"><button class="btn-ghost px-4 py-2">Cancel</button> <button class="btn-primary px-4 py-2 flex items-center gap-2" data-testid="start-push-btn"><span class="i-lucide-upload"></span> Push</button></div>',1),dE=U('<div class="space-y-4"><div class="flex items-center gap-2"><span class="i-lucide-loader-2 animate-spin text-accent"></span> <span class="text-sm">Pushing chunks...</span></div> <div class="bg-surface-2 rounded p-3"><div class="text-xs text-text-3 mb-1"> </div> <div class="h-2 bg-surface-3 rounded-full overflow-hidden"><div class="h-full bg-accent transition-all"></div></div> <div class="text-xs text-text-3 mt-1 truncate"> </div></div> <button class="btn-ghost text-danger w-full py-2">Cancel</button></div>'),fE=U('<div class="text-sm text-warning text-center">Push was cancelled</div>'),hE=U('<div class="text-xs text-danger truncate"> </div>'),EE=U('<div class="bg-surface-2 rounded p-2 max-h-40 overflow-auto"><div class="text-xs text-text-3 mb-1">Errors:</div> <!></div>'),BE=U('<div class="space-y-4"><div class="grid grid-cols-3 gap-2 text-center"><div class="bg-surface-2 rounded p-2"><div class="text-lg font-semibold text-success"> </div> <div class="text-xs text-text-3">Uploaded</div></div> <div class="bg-surface-2 rounded p-2"><div class="text-lg font-semibold text-text-3"> </div> <div class="text-xs text-text-3">Already exist</div></div> <div class="bg-surface-2 rounded p-2"><div class="text-lg font-semibold text-danger"> </div> <div class="text-xs text-text-3">Failed</div></div></div> <div class="text-sm text-text-3 text-center"> </div> <!> <!> <button class="btn-primary w-full py-2">Done</button></div>'),CE=U('<div class="fixed inset-0 bg-black/70 flex-center z-1000 overflow-auto" data-modal-backdrop="" data-testid="blossom-push-modal-backdrop"><div class="bg-surface-1 sm:rounded-lg overflow-hidden w-screen sm:w-[32rem] sm:max-w-[90vw] sm:border border-surface-3 max-h-[90vh] flex flex-col" data-testid="blossom-push-modal"><div class="p-4 border-b border-surface-3 flex items-center justify-between"><h2 class="text-lg font-semibold flex items-center gap-2"><span class="i-lucide-upload-cloud"></span> Push to Blossom</h2> <!></div> <div class="p-4 overflow-auto flex-1"><!></div></div></div>');function pE(n,e){Oe(e,!0);const t=()=>_e(_t,"$modalsStore",r),s=()=>_e(Le,"$settingsStore",r),[r,x]=mt();let o=L(()=>t().showBlossomPushModal),i=L(()=>t().blossomPushTarget),a=ee("select"),d=ee(t0([])),l=ee(t0([])),u=ee(""),f=ee(t0({current:0,total:0})),h=ee(!1);$e(()=>{var p,y;if(!c(o)){T(a,"select"),T(d,[],!0),T(l,[],!0),T(u,""),T(f,{current:0,total:0},!0),T(h,!1);return}const F=s(),g=((y=(p=F.network)==null?void 0:p.blossomServers)==null?void 0:y.length)>0?F.network.blossomServers:Ut.blossomServers;T(d,g.map(w=>({url:w.url,selected:w.write,write:w.write})),!0)}),$e(()=>{if(!c(o))return;const F=g=>{g.key==="Escape"&&(c(a)==="pushing"?T(h,!0):n0())};return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)});function B(){return async F=>await Ms({...F,pubkey:"",id:"",sig:""})}async function A(){if(!c(i))return;const F=c(d).filter(y=>y.selected);if(F.length===0){alert("Please select at least one server");return}T(a,"pushing"),T(h,!1),T(l,[],!0);const g=new ix({servers:F.map(y=>({url:y.url,write:!0})),signer:B()}),p=Bt();T(u,"Pushing..."),await p.push(c(i).cid,g,{onProgress:(y,w)=>{T(f,{current:y,total:w},!0)},onBlock:(y,w,_)=>{const S=se(y);T(l,[...c(l),{hash:S,name:S.slice(0,12)+"...",size:0,status:w==="error"?"error":w==="skipped"?"skipped":"success",error:_==null?void 0:_.message}],!0),T(u,S.slice(0,16)+"...")}}),T(a,"done"),T(u,"")}let D=L(()=>{const F=c(l).filter(w=>w.status==="success").length,g=c(l).filter(w=>w.status==="skipped").length,p=c(l).filter(w=>w.status==="error").length,y=c(l).filter(w=>w.status==="success"||w.status==="skipped").reduce((w,_)=>w+(_.size||0),0);return{success:F,skipped:g,errors:p,totalBytes:y}});function v(F){if(F===0)return"0 B";const g=1024,p=["B","KB","MB","GB"],y=Math.floor(Math.log(F)/Math.log(g));return parseFloat((F/Math.pow(g,y)).toFixed(1))+" "+p[y]}var m=Ie(),C=ge(m);{var E=F=>{var g=CE();g.__click=z=>{z.target===z.currentTarget&&c(a)!=="pushing"&&n0()};var p=b(g),y=b(p),w=k(b(y),2);{var _=z=>{var K=iE();K.__click=function(...O){n0==null||n0.apply(this,O)},M(z,K)};$(w,z=>{c(a)!=="pushing"&&z(_)})}var S=k(y,2),P=b(S);{var I=z=>{var K=uE(),O=ge(K),j=b(O),W=k(b(j)),J=b(W),G=k(W),oe=k(j,2);{var le=xe=>{var ue=aE();M(xe,ue)},re=xe=>{var ue=lE();Tt(ue,21,()=>c(d),Qt,(Ct,ft,St)=>{var ht=cE(),tt=b(ht),at=k(tt,4),pt=b(at);Q(()=>V(pt,new URL(c(ft).url).hostname)),kc(tt,()=>c(d)[St].selected,bt=>c(d)[St].selected=bt),M(Ct,ht)}),M(xe,ue)};$(oe,xe=>{c(d).length===0?xe(le):xe(re,!1)})}var Se=k(O,2),de=b(Se);de.__click=function(...xe){n0==null||n0.apply(this,xe)};var ae=k(de,2);ae.__click=A,Q(xe=>{V(J,c(i).name),V(G,` ${c(i).isDirectory?" (directory)":""} to:`),ae.disabled=xe},[()=>c(d).filter(xe=>xe.selected).length===0]),M(z,K)},R=z=>{var K=Ie(),O=ge(K);{var j=J=>{var G=dE(),oe=k(b(G),2),le=b(oe),re=b(le),Se=k(le,2),de=b(Se),ae=k(Se,2),xe=b(ae),ue=k(oe,2);ue.__click=()=>{T(h,!0)},Q(()=>{V(re,`${c(f).current??""} / ${c(f).total??""} chunks`),ds(de,`width: ${c(f).total>0?c(f).current/c(f).total*100:0}%`),V(xe,c(u))}),M(J,G)},W=J=>{var G=BE(),oe=b(G),le=b(oe),re=b(le),Se=b(re),de=k(le,2),ae=b(de),xe=b(ae),ue=k(de,2),Ct=b(ue),ft=b(Ct),St=k(oe,2),ht=b(St),tt=k(St,2);{var at=be=>{var $t=fE();M(be,$t)};$(tt,be=>{c(h)&&be(at)})}var pt=k(tt,2);{var bt=be=>{var $t=EE(),Xe=k(b($t),2);Tt(Xe,17,()=>c(l).filter(pe=>pe.status==="error"),Qt,(pe,Re)=>{var je=hE(),At=b(je);Q(()=>{Ce(je,"title",c(Re).error),V(At,`${c(Re).name??""}: ${c(Re).error??""}`)}),M(pe,je)}),M(be,$t)};$(pt,be=>{c(D).errors>0&&be(bt)})}var gt=k(pt,2);gt.__click=function(...be){n0==null||n0.apply(this,be)},Q(be=>{V(Se,c(D).success),V(xe,c(D).skipped),V(ft,c(D).errors),V(ht,`${be??""} total`)},[()=>v(c(D).totalBytes)]),M(J,G)};$(O,J=>{c(a)==="pushing"?J(j):J(W,!1)},!0)}M(z,K)};$(P,z=>{c(a)==="select"?z(I):z(R,!1)})}M(F,g)};$(C,F=>{c(o)&&c(i)&&F(E)})}M(n,m),He(),x()}wt(["click"]);var gE=U('<div class="mt-4 mb-4"><!></div>'),AE=U('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70"><div class="bg-surface-1 rounded-lg shadow-lg p-6 w-full max-w-md mx-4"><h2 class="text-lg font-semibold mb-4"> </h2> <form><input type="text" class="input w-full mb-4"/> <!> <div class="flex justify-end gap-2"><button type="button" class="btn-ghost">Cancel</button> <button type="submit" class="btn-success"> </button></div></form></div></div>');function FE(n,e){Oe(e,!0);const t=()=>_e(_t,"$modalsStore",r),s=()=>_e(w0,"$routeStore",r),[r,x]=mt();let o=L(()=>t().showCreateModal),i=L(()=>t().modalInput),a=L(()=>t().createModalType),d=L(()=>t().createTreeVisibility),l=L(s),u=ee(!1),f=ee(null);$e(()=>{c(o)&&c(f)&&c(f).focus()});let h=L(()=>c(a)==="folder"),B=L(()=>c(a)==="tree"),A=L(()=>c(a)==="document"),D=L(()=>c(B)?"New Folder":c(A)?"New Document":c(h)?"New Folder":"New File"),v=L(()=>c(A)?"Document name...":c(B)||c(h)?"Folder name...":"File name...");async function m(p){const y=c(i).trim();if(!(!y||c(u)))if(c(B))T(u,!0),await Kx(y,c(d)),T(u,!1),Zt();else if(c(A)){if(T(u,!0),c(l).npub&&c(l).treeName){await Nx(y),Zt();const w=[...c(l).path,y].map(encodeURIComponent).join("/"),_=c(l).linkKey?`?k=${c(l).linkKey}`:"";window.location.hash=`/${c(l).npub}/${c(l).treeName}/${w}${_}`}else{const{createDocumentTree:w}=await i0(async()=>{const{createDocumentTree:S}=await Promise.resolve().then(()=>N8);return{createDocumentTree:S}},void 0),_=await w(y,c(d));if(Zt(),_.npub&&_.treeName){const S=_.linkKey?`?k=${_.linkKey}`:"";I0(`/${_.npub}/${_.treeName}${S}`)}}T(u,!1)}else c(h)?(Lx(y),Zt()):(Xa(y,""),Zt())}function C(p){p.key==="Escape"&&Zt(),p.key==="Enter"&&m()}var E=Ie(),F=ge(E);{var g=p=>{var y=AE();y.__click=function(...J){Zt==null||Zt.apply(this,J)};var w=b(y);w.__click=J=>J.stopPropagation(),w.__keydown=C;var _=b(w),S=b(_),P=k(_,2),I=b(P);I.__input=J=>ja(J.target.value),M0(I,J=>T(f,J),()=>c(f));var R=k(I,2);{var z=J=>{var G=gE(),oe=b(G);xc(oe,{get value(){return c(d)},get onchange(){return u8}}),M(J,G)};$(R,J=>{(c(B)||c(A)&&!c(l).treeName)&&J(z)})}var K=k(R,2),O=b(K);O.__click=function(...J){Zt==null||Zt.apply(this,J)};var j=k(O,2),W=b(j);Q(()=>{V(S,c(D)),as(I,c(i)),Ce(I,"placeholder",c(v)),j.disabled=c(u),V(W,c(u)?"Creating...":"Create")}),T0("submit",P,J=>{J.preventDefault(),m()}),M(p,y)};$(F,p=>{c(o)&&p(g)})}M(n,E),He(),x()}wt(["click","keydown","input"]);var vE=U('<div class="h-full flex flex-col bg-surface-0"><header class="h-12 shrink-0 bg-surface-1 border-b border-surface-3 flex items-center justify-between px-3 md:px-4 gap-2 relative"><a href="#/" class="flex items-center gap-2 no-underline select-none"><img src="/iris-logo.png" alt="Iris" class="w-8 h-8" draggable="false"/> <span class="font-semibold text-text-1 hidden sm:inline"><span class="text-accent">Iris</span> Docs</span></a> <div class="flex items-center gap-2 md:gap-3"><!> <div class="hidden md:block"><!></div> <!> <!></div></header> <div class="flex-1 flex flex-col min-h-0"><!></div> <!> <!> <!> <!> <!> <!></div>');function yE(n,e){Oe(e,!0);const t=()=>_e(Kc,"$currentPath",s),[s,r]=mt();Fr(()=>{$c()});var x=vE(),o=b(x),i=k(b(o),2),a=b(i);x8(a,{});var d=k(a,2),l=b(d);Na(l,{});var u=k(d,2);f9(u,{});var f=k(u,2);l9(f,{});var h=k(o,2),B=b(h);Zf(B,{get currentPath(){return t()}});var A=k(h,2);FE(A,{});var D=k(A,2);bh(D,{});var v=k(D,2);Zh(v,{});var m=k(v,2);oE(m,{});var C=k(m,2);pE(C,{});var E=k(C,2);F8(E,{}),M(n,x),He(),r()}_c(yE,{target:document.getElementById("app")});
